








<!doctype html>
<html 
      lang="ja-x-mtfrom-en"
      dir="ltr">
  <head>
    <meta name="google-signin-client-id" content="721724668570-nbkv1cfusk7kk4eni4pjvepaus73b13t.apps.googleusercontent.com">
    <meta name="google-signin-scope"
          content="profile email https://www.googleapis.com/auth/developerprofiles https://www.googleapis.com/auth/developerprofiles.award">
    <meta property="og:site_name" content="Android Developers">
    <meta property="og:type" content="website"><meta name="theme-color" content="#34a853"><meta charset="utf-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    

    <link rel="manifest" href="/_pwa/android/manifest.json"
          crossorigin="use-credentials">
    <link rel="preconnect" href="//www.gstatic.com" crossorigin>
    <link rel="preconnect" href="//fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="//fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="//apis.google.com" crossorigin>
    <link rel="preconnect" href="//www.google-analytics.com" crossorigin><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Google+Sans:400,500,600,700|Google+Sans+Text:400,400italic,500,500italic,600,600italic,700,700italic|Roboto+Mono:400,500,700&display=swap">
      <link rel="stylesheet"
            href="//fonts.googleapis.com/css2?family=Material+Icons&family=Material+Symbols+Outlined&display=block"><link rel="stylesheet" href="//fonts.googleapis.com/earlyaccess/notosansjp.css"><link rel="stylesheet" href="https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/css/app.css">
      
        <link rel="stylesheet" href="https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/css/dark-theme.css" disabled>
      <link rel="shortcut icon" href="https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/images/favicon.svg">
    <link rel="apple-touch-icon" href="https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/images/touchicon-180.png"><link rel="canonical" href="https://developer.android.com/codelabs/health-connect?hl=ja"><link rel="search" type="application/opensearchdescription+xml"
            title="Android Developers" href="https://developer.android.com/s/opensearch.xml?hl=ja">
      <link rel="alternate" hreflang="en"
          href="https://developer.android.com/codelabs/health-connect" /><link rel="alternate" hreflang="x-default" href="https://developer.android.com/codelabs/health-connect" /><link rel="alternate" hreflang="zh-Hans"
          href="https://developer.android.com/codelabs/health-connect?hl=zh-cn" /><link rel="alternate" hreflang="zh-Hant"
          href="https://developer.android.com/codelabs/health-connect?hl=zh-tw" /><link rel="alternate" hreflang="fr"
          href="https://developer.android.com/codelabs/health-connect?hl=fr" /><link rel="alternate" hreflang="id"
          href="https://developer.android.com/codelabs/health-connect?hl=id" /><link rel="alternate" hreflang="ja"
          href="https://developer.android.com/codelabs/health-connect?hl=ja" /><link rel="alternate" hreflang="ko"
          href="https://developer.android.com/codelabs/health-connect?hl=ko" /><link rel="alternate" hreflang="pt-BR"
          href="https://developer.android.com/codelabs/health-connect?hl=pt-br" /><link rel="alternate" hreflang="es-419"
          href="https://developer.android.com/codelabs/health-connect?hl=es-419" /><link rel="alternate" hreflang="vi"
          href="https://developer.android.com/codelabs/health-connect?hl=vi" /><title>初めてのヘルスコネクト統合アプリ &nbsp;|&nbsp; Android Developers</title>

<meta property="og:title" content="初めてのヘルスコネクト統合アプリ &nbsp;|&nbsp; Android Developers"><meta name="description" content="この Codelab では、ヘルスコネクトに対する読み取りと書き込みをサポートする健康＆フィットネス アプリを作成します。">
  <meta property="og:description" content="この Codelab では、ヘルスコネクトに対する読み取りと書き込みをサポートする健康＆フィットネス アプリを作成します。"><meta property="og:url" content="https://developer.android.com/codelabs/health-connect?hl=ja"><meta property="og:locale" content="ja"><link rel="alternate machine-translated-from" hreflang="en"
        href="https://developer.android.com/codelabs/health-connect?hl=en">
  
    
    
    
    
    
    
    
    
    
    
  

    
      <link rel="stylesheet" href="/extras.css"></head>
  <body class=""
        template="codelab"
        theme="android-theme"
        type="codelab"
        
        
        appearance
        
        layout="docs"
        
        
        
        
        display-toc
        pending>
  
    <devsite-progress type="indeterminate" id="app-progress"></devsite-progress>
  
  
    <a href="#main-content" class="skip-link button">
      
      メイン コンテンツにスキップ
    </a>
    <section class="devsite-wrapper">
      <devsite-cookie-notification-bar></devsite-cookie-notification-bar><devsite-header role="banner">
  
    





















<div class="devsite-header--inner" data-nosnippet>
  <div class="devsite-top-logo-row-wrapper-wrapper">
    <div class="devsite-top-logo-row-wrapper">
      <div class="devsite-top-logo-row">
        <button type="button" id="devsite-hamburger-menu"
          class="devsite-header-icon-button button-flat material-icons gc-analytics-event"
          data-category="Site-Wide Custom Events"
          data-label="Navigation menu button"
          visually-hidden
          aria-label="メニューを開く">
        </button>
        
<div class="devsite-product-name-wrapper">

  <a href="/" class="devsite-site-logo-link gc-analytics-event"
   data-category="Site-Wide Custom Events" data-label="Site logo" track-type="globalNav"
   track-name="androidDevelopers" track-metadata-position="nav"
   track-metadata-eventDetail="nav">
  
  <picture>
    
    <source srcset="https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/images/lockup-dark-theme.png"
            media="(prefers-color-scheme: dark)"
            class="devsite-dark-theme">
    
    <img src="https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/images/lockup.png" class="devsite-site-logo" alt="Android Developers">
  </picture>
  
</a>



</div>
        <div class="devsite-top-logo-row-middle">
          <div class="devsite-header-upper-tabs">
            
           </div>
          
<devsite-search
    enable-signin
    enable-search
    enable-suggestions
      enable-query-completion
    
    enable-search-summaries
    
    tenant-name="Android Developers"
    
    
    
    
    
    >
  <form class="devsite-search-form" action="https://developer.android.com/s/results?hl=ja" method="GET">
    <div class="devsite-search-container">
      <button type="button"
              search-open
              class="devsite-search-button devsite-header-icon-button button-flat material-icons"
              
              aria-label="検索を開始"></button>
      <div class="devsite-searchbox">
        <input
          aria-activedescendant=""
          aria-autocomplete="list"
          
          aria-label="検索"
          aria-expanded="false"
          aria-haspopup="listbox"
          autocomplete="off"
          class="devsite-search-field devsite-search-query"
          name="q"
          
          placeholder="検索"
          role="combobox"
          type="text"
          value=""
          >
          <div class="devsite-search-image material-icons" aria-hidden="true">
            
              <svg class="devsite-search-ai-image" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <g clip-path="url(#clip0_6641_386)">
                    <path d="M19.6 21L13.3 14.7C12.8 15.1 12.225 15.4167 11.575 15.65C10.925 15.8833 10.2333 16 9.5 16C7.68333 16 6.14167 15.375 4.875 14.125C3.625 12.8583 3 11.3167 3 9.5C3 7.68333 3.625 6.15 4.875 4.9C6.14167 3.63333 7.68333 3 9.5 3C10.0167 3 10.5167 3.05833 11 3.175C11.4833 3.275 11.9417 3.43333 12.375 3.65L10.825 5.2C10.6083 5.13333 10.3917 5.08333 10.175 5.05C9.95833 5.01667 9.73333 5 9.5 5C8.25 5 7.18333 5.44167 6.3 6.325C5.43333 7.19167 5 8.25 5 9.5C5 10.75 5.43333 11.8167 6.3 12.7C7.18333 13.5667 8.25 14 9.5 14C10.6667 14 11.6667 13.625 12.5 12.875C13.35 12.1083 13.8417 11.15 13.975 10H15.975C15.925 10.6333 15.7833 11.2333 15.55 11.8C15.3333 12.3667 15.05 12.8667 14.7 13.3L21 19.6L19.6 21ZM17.5 12C17.5 10.4667 16.9667 9.16667 15.9 8.1C14.8333 7.03333 13.5333 6.5 12 6.5C13.5333 6.5 14.8333 5.96667 15.9 4.9C16.9667 3.83333 17.5 2.53333 17.5 0.999999C17.5 2.53333 18.0333 3.83333 19.1 4.9C20.1667 5.96667 21.4667 6.5 23 6.5C21.4667 6.5 20.1667 7.03333 19.1 8.1C18.0333 9.16667 17.5 10.4667 17.5 12Z" fill="#5F6368"/>
                  </g>
                <defs>
                <clipPath id="clip0_6641_386">
                <rect width="24" height="24" fill="white"/>
                </clipPath>
                </defs>
              </svg>
            
          </div>
          <div class="devsite-search-shortcut-icon-container" aria-hidden="true">
            <kbd class="devsite-search-shortcut-icon">/</kbd>
          </div>
      </div>
    </div>
  </form>
  <button type="button"
          search-close
          class="devsite-search-button devsite-header-icon-button button-flat material-icons"
          
          aria-label="検索を閉じる"></button>
</devsite-search>

        </div>

        

          

          

          <devsite-appearance-selector></devsite-appearance-selector>

          
<devsite-language-selector>
  <ul role="presentation">
    
    
    <li role="presentation">
      <a role="menuitem" lang="en"
        >English</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="de"
        >Deutsch</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="es_419"
        >Español – América Latina</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="fr"
        >Français</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="id"
        >Indonesia</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="pl"
        >Polski</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="pt_br"
        >Português – Brasil</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="vi"
        >Tiếng Việt</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="zh_cn"
        >中文 – 简体</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="zh_tw"
        >中文 – 繁體</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="ja"
        >日本語</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="ko"
        >한국어</a>
    </li>
    
  </ul>
</devsite-language-selector>


          
            <a class="devsite-header-link devsite-top-button button gc-analytics-event "
    href="https://developer.android.com/studio?hl=ja"
    data-category="Site-Wide Custom Events"
    data-label="Site header link: Android Studio"
    >
  Android Studio
</a>
          

        

        
          <devsite-user 
                        
                        
                          enable-profiles
                        
                        
                        id="devsite-user">
            
              
              <span class="button devsite-top-button" aria-hidden="true" visually-hidden>ログイン</span>
            
          </devsite-user>
        
        
        
      </div>
    </div>
  </div>



</div>



  
</devsite-header>
      <devsite-book-nav scrollbars hidden>
        
          





















<div class="devsite-book-nav-filter"
     hidden>
  <span class="filter-list-icon material-icons" aria-hidden="true"></span>
  <input type="text"
         placeholder="フィルタ"
         
         aria-label="フィルタ テキストを入力"
         role="searchbox">
  
  <span class="filter-clear-button hidden"
        data-title="フィルタをクリア"
        aria-label="フィルタをクリア"
        role="button"
        tabindex="0"></span>
</div>

<nav class="devsite-book-nav devsite-nav nocontent"
     aria-label="サイドメニュー">
  <div class="devsite-mobile-header">
    <button type="button"
            id="devsite-close-nav"
            class="devsite-header-icon-button button-flat material-icons gc-analytics-event"
            data-category="Site-Wide Custom Events"
            data-label="Close navigation"
            aria-label="ナビゲーションを閉じる">
    </button>
    <div class="devsite-product-name-wrapper">

  <a href="/" class="devsite-site-logo-link gc-analytics-event"
   data-category="Site-Wide Custom Events" data-label="Site logo" track-type="globalNav"
   track-name="androidDevelopers" track-metadata-position="nav"
   track-metadata-eventDetail="nav">
  
  <picture>
    
    <source srcset="https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/images/lockup-dark-theme.png"
            media="(prefers-color-scheme: dark)"
            class="devsite-dark-theme">
    
    <img src="https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/images/lockup.png" class="devsite-site-logo" alt="Android Developers">
  </picture>
  
</a>


</div>
  </div>

  <div class="devsite-book-nav-wrapper">
    <div class="devsite-mobile-nav-top">
      
        <ul class="devsite-nav-list">
          
          
    
    
<li class="devsite-nav-item">

  
  <a href="/studio"
    
       class="devsite-nav-title gc-analytics-event "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Android Studio"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      Android Studio
   </span>
    
  
  </a>
  

</li>

  
          
        </ul>
      
    </div>
    
  </div>
</nav>
        
      </devsite-book-nav>
      <section id="gc-wrapper">
        <main role="main" id="main-content" class="devsite-main-content"
            
              
              has-sidebar
            >
          <div class="devsite-sidebar">
            <div class="devsite-sidebar-content">
                
                <devsite-toc class="devsite-nav"
                            role="navigation"
                            aria-label="このページの内容"
                            depth="1"
                            scrollbars
                  ></devsite-toc>
                <devsite-recommendations-sidebar class="nocontent devsite-nav">
                </devsite-recommendations-sidebar>
            </div>
          </div>
          <devsite-content>
            
              












<article class="devsite-article"><style>
      body {
        transition: opacity ease-in 0.2s;
      }

      body[unresolved] {
        opacity: 0;
        display: block;
        overflow: hidden;
        position: relative;
      }
      </style>
  
  
  
  
  

  <div class="devsite-article-meta nocontent" role="navigation">
    
    
    <ul class="devsite-breadcrumb-list"
  >
  
</ul>
    
  </div>
  
    <h1 class="devsite-page-title" tabindex="-1">
      初めてのヘルスコネクト統合アプリ<div class="devsite-actions" hidden data-nosnippet><devsite-feature-tooltip
      ack-key="AckCollectionsBookmarkTooltipDismiss"
      analytics-category="Site-Wide Custom Events"
      analytics-action-show="Callout Profile displayed"
      analytics-action-close="Callout Profile dismissed"
      analytics-label="Create Collection Callout"
      class="devsite-page-bookmark-tooltip nocontent"
      dismiss-button="true"
      id="devsite-collections-dropdown"
      
      dismiss-button-text="閉じる"

      
      close-button-text="OK">

    
    
      <devsite-bookmark></devsite-bookmark>
    

    <span slot="popout-heading">
      
      コレクションでコンテンツを整理
    </span>
    <span slot="popout-contents">
      
      必要に応じて、コンテンツの保存と分類を行います。
    </span>
  </devsite-feature-tooltip></div>
  
      
    </h1>
  

  <devsite-toc class="devsite-nav"
    depth="1"
    devsite-toc-embedded
    >
  </devsite-toc>
  
    
  <div class="devsite-article-body clearfix
  ">

  
    
    
    
    <google-codelab-analytics ga4id="G-JTFZSJVVVZ" gaid="UA-49880327-14"></google-codelab-analytics>
    <google-codelab category="android" codelab-ga4id="" codelab-gaid="" doc-id="1A2sZoEgf9srlkY8l5goYXm_T55b56nidlGa83Cv9nx0" environment="web" feedback-link="" id="health-connect" layout="paginated" no-tooltip="" title="初めてのヘルスコネクト統合アプリ">
      
        <google-codelab-step duration="10" step="0" label="はじめに">
          
            <google-codelab-about authors="Wei-Chen Chen" duration="90" last-updated="2025-02-27T10:28:41Z" codelab-title="初めてのヘルスコネクト統合アプリ">
            </google-codelab-about>
          
          <h2 class="step-title" data-text="               1. はじめに           " id="0" tabindex="-1">
              1. はじめに
          </h2>
          <p class="image-container"><img alt="e4a4985ad1cdae8b.png" sizes="(max-width: 840px) 100vw, 856px" src="https://developer.android.com/static/codelabs/health-connect/img/e4a4985ad1cdae8b.png?hl=ja" srcset="https://developer.android.com/static/codelabs/health-connect/img/e4a4985ad1cdae8b_36.png?hl=ja 36w,https://developer.android.com/static/codelabs/health-connect/img/e4a4985ad1cdae8b_48.png?hl=ja 48w,https://developer.android.com/static/codelabs/health-connect/img/e4a4985ad1cdae8b_72.png?hl=ja 72w,https://developer.android.com/static/codelabs/health-connect/img/e4a4985ad1cdae8b_96.png?hl=ja 96w,https://developer.android.com/static/codelabs/health-connect/img/e4a4985ad1cdae8b_480.png?hl=ja 480w,https://developer.android.com/static/codelabs/health-connect/img/e4a4985ad1cdae8b_720.png?hl=ja 720w,https://developer.android.com/static/codelabs/health-connect/img/e4a4985ad1cdae8b_856.png?hl=ja 856w,https://developer.android.com/static/codelabs/health-connect/img/e4a4985ad1cdae8b_960.png?hl=ja 960w,https://developer.android.com/static/codelabs/health-connect/img/e4a4985ad1cdae8b_1440.png?hl=ja 1440w,https://developer.android.com/static/codelabs/health-connect/img/e4a4985ad1cdae8b_1920.png?hl=ja 1920w,https://developer.android.com/static/codelabs/health-connect/img/e4a4985ad1cdae8b_2880.png?hl=ja 2880w" style="width: 134.25px" /></p>
<h2 data-text="ヘルスコネクトとは" id="what-is-health-connect" is-upgraded="" tabindex="-1"><strong>ヘルスコネクトとは</strong></h2>
<p>ヘルスコネクトは、Android アプリ デベロッパー向けの健康データ プラットフォームです。ユーザーの健康とフィットネスのデータにアクセスできる一元化されたインターフェースと、デバイスに依存しない一貫した機能動作を実現できます。ヘルスコネクトでは、健康とフィットネスに関するデータがデバイスに安全に保存されるほか、アクセスを詳細に制御して透明性を確保できます。</p>
<h3 data-text="ヘルスコネクトの仕組み" id="how-does-health-connect-work" is-upgraded="" tabindex="-1"><strong>ヘルスコネクトの仕組み</strong></h3>
<p>ヘルスコネクトは、アクティビティ、睡眠、栄養、身体測定、心拍数や血圧などの指標を含む、50 を超える一般的な健康とフィットネスに関するデータ型とカテゴリをサポートしています。</p>
<p class="image-container"><img alt="ヘルスコネクトの仕組み" sizes="(max-width: 840px) 100vw, 856px" src="https://developer.android.com/static/codelabs/health-connect/img/5280de9ff5e2a038.png?hl=ja" srcset="https://developer.android.com/static/codelabs/health-connect/img/5280de9ff5e2a038_36.png?hl=ja 36w,https://developer.android.com/static/codelabs/health-connect/img/5280de9ff5e2a038_48.png?hl=ja 48w,https://developer.android.com/static/codelabs/health-connect/img/5280de9ff5e2a038_72.png?hl=ja 72w,https://developer.android.com/static/codelabs/health-connect/img/5280de9ff5e2a038_96.png?hl=ja 96w,https://developer.android.com/static/codelabs/health-connect/img/5280de9ff5e2a038_480.png?hl=ja 480w,https://developer.android.com/static/codelabs/health-connect/img/5280de9ff5e2a038_720.png?hl=ja 720w,https://developer.android.com/static/codelabs/health-connect/img/5280de9ff5e2a038_856.png?hl=ja 856w,https://developer.android.com/static/codelabs/health-connect/img/5280de9ff5e2a038_960.png?hl=ja 960w,https://developer.android.com/static/codelabs/health-connect/img/5280de9ff5e2a038_1440.png?hl=ja 1440w,https://developer.android.com/static/codelabs/health-connect/img/5280de9ff5e2a038_1920.png?hl=ja 1920w,https://developer.android.com/static/codelabs/health-connect/img/5280de9ff5e2a038_2880.png?hl=ja 2880w" style="width: 170.00px" /></p>
<p>デベロッパーはユーザー権限で、標準化されたスキーマと API の動作を使用して、ヘルスコネクトに対する読み取りや書き込みを安全に行えます。ユーザーは、プライバシー設定を詳細に制御し、どのアプリがデータへのアクセスをリクエストしているかをいつでも細かく管理できます。ヘルスコネクトのデータはデバイス上に保存され、暗号化されます。ユーザーは、アクセスを遮断したり、デバイス上で不要なデータを削除したりできるほか、複数のアプリを使用する場合に、複数のデータソースで優先順位を付けることもできます。</p>
<h3 data-text="ヘルスコネクトのアーキテクチャ" id="health-connect-architecture" is-upgraded="" tabindex="-1"><strong>ヘルスコネクトのアーキテクチャ</strong></h3>
<p class="image-container"><img alt="アーキテクチャ" sizes="(max-width: 840px) 100vw, 856px" src="https://developer.android.com/static/codelabs/health-connect/img/371855e1b42d5d1a.jpeg?hl=ja" srcset="https://developer.android.com/static/codelabs/health-connect/img/371855e1b42d5d1a_36.jpeg?hl=ja 36w,https://developer.android.com/static/codelabs/health-connect/img/371855e1b42d5d1a_48.jpeg?hl=ja 48w,https://developer.android.com/static/codelabs/health-connect/img/371855e1b42d5d1a_72.jpeg?hl=ja 72w,https://developer.android.com/static/codelabs/health-connect/img/371855e1b42d5d1a_96.jpeg?hl=ja 96w,https://developer.android.com/static/codelabs/health-connect/img/371855e1b42d5d1a_480.jpeg?hl=ja 480w,https://developer.android.com/static/codelabs/health-connect/img/371855e1b42d5d1a_720.jpeg?hl=ja 720w,https://developer.android.com/static/codelabs/health-connect/img/371855e1b42d5d1a_856.jpeg?hl=ja 856w,https://developer.android.com/static/codelabs/health-connect/img/371855e1b42d5d1a_960.jpeg?hl=ja 960w,https://developer.android.com/static/codelabs/health-connect/img/371855e1b42d5d1a_1440.jpeg?hl=ja 1440w,https://developer.android.com/static/codelabs/health-connect/img/371855e1b42d5d1a_1920.jpeg?hl=ja 1920w,https://developer.android.com/static/codelabs/health-connect/img/371855e1b42d5d1a_2880.jpeg?hl=ja 2880w" style="width: 555.50px" /></p>
<p>ヘルスコネクトの主な要素とアーキテクチャのコンポーネントは次のとおりです。</p>
<ul>
<li><strong>クライアント アプリ:</strong> ヘルスコネクトと統合するために、クライアント アプリが SDK を健康＆フィットネス アプリにリンクします。これにより、ヘルスコネクト API とやり取りするための API サーフェスが提供されます。</li>
<li><strong>ソフトウェア開発キット:</strong> この SDK で、クライアント アプリがヘルスコネクト APK と通信できるようになります。</li>
<li><strong>ヘルスコネクト APK:</strong> ヘルスコネクトを実装する APK です。権限管理コンポーネントとデータ管理コンポーネントの両方が含まれています。ヘルスコネクト APK はユーザーのデバイスで直接利用できるようになるため、ヘルスコネクトはアカウント中心ではなくデバイス中心になります。</li>
<li><strong>権限の管理:</strong> ヘルスコネクトには、アプリがデータを表示する権限をユーザーにリクエストするためのユーザー インターフェースがあります。既存のユーザー権限のリストも表示されます。これにより、ユーザーはさまざまなアプリに対して付与または拒否したアクセス権を、簡単に管理できます。</li>
<li><strong>データの管理:</strong> ヘルスコネクトは、ユーザーの歩数、サイクリング速度、心拍数など、サポートされているデータの種類について、記録されたデータの概要をユーザー インターフェースに表示します。</li>
</ul>
<h2 data-text="作成するアプリの概要" id="what-youll-build" is-upgraded="" tabindex="-1"><strong>作成するアプリの概要</strong></h2>
<p>この Codelab では、ヘルスコネクトと統合されたシンプルな健康＆フィットネス アプリを作成します。このアプリでは次の処理を行います。</p>
<ul>
<li>データアクセスに関するユーザー権限の取得と確認。</li>
<li>ヘルスコネクトへのデータの書き込み。</li>
<li>ヘルスコネクトからの集計データの読み取り。</li>
</ul>
<h2 class="checklist" data-text="学習内容" id="what-youll-learn" is-upgraded="" tabindex="-1"><strong>学習内容</strong></h2>
<ul class="checklist">
<li>ヘルスコネクトの統合開発をサポートする環境を設定する方法。</li>
<li>権限を取得して権限チェックを実行する方法。</li>
<li>ヘルスコネクト プラットフォームに健康やフィットネスに関するデータを提供する方法。</li>
<li>デバイス上のデータ ストレージを活用する方法。</li>
<li>Google が提供するデベロッパー ツールを使用してアプリを検証する方法。</li>
</ul>
<h2 data-text="必要なもの" id="what-youll-need" is-upgraded="" tabindex="-1"><strong>必要なもの</strong></h2>
<ul>
<li><a href="https://developer.android.com/studio?hl=ja" target="_blank">Android Studio</a> の最新の安定版。</li>
<li>Android SDK バージョン 28（Pie）以降を搭載した Android モバイル デバイス。</li>
</ul>


        </google-codelab-step>
      
        <google-codelab-step duration="10" step="1" label="セットアップする">
          
          <h2 class="step-title" data-text="               2. セットアップする           " id="1" tabindex="-1">
              2. セットアップする
          </h2>
          <h2 data-text="ヘルスコネクト アプリを準備する" id="prepare-the-health-connect-app" is-upgraded="" tabindex="-1"><strong>ヘルスコネクト アプリを準備する</strong></h2>
<p>ヘルスコネクト アプリは、アプリがヘルスコネクト SDK を介して送信するすべてのリクエストを処理します。リクエストには、データの保存や読み取り / 書き込みアクセス権の管理などがあります。</p>
<p>ヘルスコネクトへのアクセスは、スマートフォンにインストールされている Android のバージョンによって異なります。以下のセクションでは、Android の最近のバージョンを処理する方法の概要を示します。</p>
<h2 data-text="Android 14" id="android-14" is-upgraded="" tabindex="-1"><strong>Android 14</strong></h2>
<p>Android 14（API レベル 34）以降、ヘルスコネクトは Android フレームワークの一部になっています。このバージョンのヘルスコネクトはフレームワーク モジュールであるため、セットアップは不要です。</p>
<h2 data-text="Android 13 以前" id="android-13-and-lower" is-upgraded="" tabindex="-1"><strong>Android 13 以前</strong></h2>
<p>Android 13（API レベル 33）以前のバージョンでは、ヘルスコネクトは Android フレームワークの一部ではありません。そのため、Google Play ストアからヘルスコネクト アプリをインストールする必要があります。QR コードをスキャンして、ヘルスコネクトをインストールします。</p>
<p class="image-container"><img alt="633ed0490a74595d.png" sizes="(max-width: 840px) 100vw, 856px" src="https://developer.android.com/static/codelabs/health-connect/img/633ed0490a74595d.png?hl=ja" srcset="https://developer.android.com/static/codelabs/health-connect/img/633ed0490a74595d_36.png?hl=ja 36w,https://developer.android.com/static/codelabs/health-connect/img/633ed0490a74595d_48.png?hl=ja 48w,https://developer.android.com/static/codelabs/health-connect/img/633ed0490a74595d_72.png?hl=ja 72w,https://developer.android.com/static/codelabs/health-connect/img/633ed0490a74595d_96.png?hl=ja 96w,https://developer.android.com/static/codelabs/health-connect/img/633ed0490a74595d_480.png?hl=ja 480w,https://developer.android.com/static/codelabs/health-connect/img/633ed0490a74595d_720.png?hl=ja 720w,https://developer.android.com/static/codelabs/health-connect/img/633ed0490a74595d_856.png?hl=ja 856w,https://developer.android.com/static/codelabs/health-connect/img/633ed0490a74595d_960.png?hl=ja 960w,https://developer.android.com/static/codelabs/health-connect/img/633ed0490a74595d_1440.png?hl=ja 1440w,https://developer.android.com/static/codelabs/health-connect/img/633ed0490a74595d_1920.png?hl=ja 1920w,https://developer.android.com/static/codelabs/health-connect/img/633ed0490a74595d_2880.png?hl=ja 2880w" style="width: 205.50px" /></p>
<h2 data-text="サンプルコードを取得する" id="get-the-sample-code" is-upgraded="" tabindex="-1">サンプルコードを取得する</h2>
<p>まず、GitHub からソースコードのクローンを作成します。</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Text only"><code translate="no" dir="ltr">git clone https://github.com/android/android-health-connect-codelab.git
</code></pre></devsite-code>
<p>サンプル ディレクトリには、この Codelab の <code dir="ltr" translate="no">start</code> コードと <code dir="ltr" translate="no">finished</code> コードが含まれています。Android Studio の [<strong>Project</strong>] ビューに、次の 2 つのモジュールが表示されます。</p>
<ul>
<li><code dir="ltr" translate="no">start</code>: このプロジェクトのスターター コード。これを変更して Codelab を完成します。</li>
<li><code dir="ltr" translate="no">finished</code>: この Codelab の完成したコード。作業のチェックに使用します。</li>
</ul>
<aside class="special"><p><strong>注</strong>: どちらのモジュールも、Android Studio のツールバーで実行構成を変更することでいつでも実行できます。</p>
</aside>
<h2 data-text="「start」コードを確認する" id="explore-the-‘start-code" is-upgraded="" tabindex="-1"><strong>「start」コードを確認する</strong></h2>
<p>Codelab サンプルアプリには Jetpack Compose によって構築された基本的な UI があり、次の画面が用意されています。</p>
<ul>
<li><code dir="ltr" translate="no">WelcomeScreen</code>: アプリのランディング ページです。このページに、ヘルスコネクトの状態（インストール済み、未インストール、サポート対象外）に応じたメッセージが表示されます。</li>
<li><code dir="ltr" translate="no">PrivacyPolicyScreen</code>: アプリでの権限の使用方法を説明します。ユーザーがヘルスコネクトの権限ダイアログで<strong>プライバシー ポリシー</strong>のリンクをクリックすると表示されます。</li>
<li><code dir="ltr" translate="no">InputReadingsScreen</code>: シンプルな体重のレコードの読み取りと書き込みを行います。</li>
<li><code dir="ltr" translate="no">ExerciseSessionScreen</code>: ここにユーザーがエクササイズ セッションを挿入して一覧表示します。レコードをクリックすると、<code dir="ltr" translate="no">ExerciseSessionDetailScreen</code> が表示され、そのセッションに関連するデータが表示されます。</li>
<li><code dir="ltr" translate="no">DifferentialChangesScreen</code>: 変更トークンの取得と、ヘルスコネクトからの新しい変更の取得を行います。</li>
</ul>
<p><code dir="ltr" translate="no">HealthConnectManager</code>: ヘルスコネクトとのやり取りを行うすべての関数が格納されます。この Codelab では、基本的な機能を完成させるための手順を詳細に説明します。<code dir="ltr" translate="no">start</code> ビルド内の <code dir="ltr" translate="no">&lt;!-- TODO:</code> 文字列には、この Codelab 内の対応するセクションがあり、プロジェクトに挿入するためのサンプルコードが提供されています。</p>
<p>まず、ヘルスコネクトをプロジェクトに追加します。</p>
<h2 data-text="ヘルスコネクト クライアント SDK を追加する" id="add-health-connect-client-sdk" is-upgraded="" tabindex="-1"><strong>ヘルスコネクト クライアント SDK を追加する</strong></h2>
<p>ヘルスコネクト SDK の使用を開始するには、<code dir="ltr" translate="no">build.gradle</code> ファイルに依存関係を追加する必要があります。ヘルスコネクトの最新バージョンを確認するには、<a href="https://developer.android.com/jetpack/androidx/releases/health-connect?hl=ja" target="_blank">Jetpack ライブラリのリリース</a>をご覧ください。</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Carbon"><code translate="no" dir="ltr"><span class="devsite-syntax-nx">dependencies</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// Add a dependency of Health Connect SDK</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-nx">implementation</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-s">"androidx.health.connect:connect-client:1.1.0-alpha11"</span>
<span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<aside class="special"><p><strong>注</strong>: Codelab の <code dir="ltr" translate="no">start</code> プロジェクトでは、すでに依存関係が追加されています。この手順は、独自のアプリ開発における参考のために記載されています。</p>
</aside>
<h2 data-text="ヘルスコネクトの公開設定を宣言する" id="declare-health-connect-visibility" is-upgraded="" tabindex="-1"><strong>ヘルスコネクトの公開設定を宣言する</strong></h2>
<p>アプリ内で <code dir="ltr" translate="no">Health Connect</code> とやり取りするには、<code dir="ltr" translate="no">AndroidManifest.xml</code> でヘルスコネクト パッケージ名を宣言します。</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Carbon"><code translate="no" dir="ltr">&lt;<span class="devsite-syntax-p">!</span><span class="devsite-syntax-o">--</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nx">TODO</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nx">declare</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nx">Health</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nx">Connect</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nx">visibility</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">--</span>&gt;
&lt;<span class="devsite-syntax-nx">queries</span>&gt;
<span class="devsite-syntax-w">   </span>&lt;<span class="devsite-syntax-kn">package</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nx">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-nx">name</span><span class="devsite-syntax-p">=</span><span class="devsite-syntax-s">"com.google.android.apps.healthdata"</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">/</span>&gt;
&lt;<span class="devsite-syntax-o">/</span><span class="devsite-syntax-nx">queries</span>&gt;
</code></pre></devsite-code>
<h2 data-text="start プロジェクトを実行する" id="run-the-start-project" is-upgraded="" tabindex="-1"><strong>start プロジェクトを実行する</strong></h2>
<p>すべての設定を終えたら、<code dir="ltr" translate="no">start</code> プロジェクトを実行します。この時点で、「ヘルスコネクトはこのデバイスにインストールされています」と表示されるウェルカム画面とメニュー ドロワーが表示されるはずです。ヘルスコネクトとやり取りする機能については、後のセクションで追加します。</p>
<p class="image-container"><img alt="8f063e5b305189.png" sizes="(max-width: 840px) 100vw, 856px" src="https://developer.android.com/static/codelabs/health-connect/img/8f063e5b305189.png?hl=ja" srcset="https://developer.android.com/static/codelabs/health-connect/img/8f063e5b305189_36.png?hl=ja 36w,https://developer.android.com/static/codelabs/health-connect/img/8f063e5b305189_48.png?hl=ja 48w,https://developer.android.com/static/codelabs/health-connect/img/8f063e5b305189_72.png?hl=ja 72w,https://developer.android.com/static/codelabs/health-connect/img/8f063e5b305189_96.png?hl=ja 96w,https://developer.android.com/static/codelabs/health-connect/img/8f063e5b305189_480.png?hl=ja 480w,https://developer.android.com/static/codelabs/health-connect/img/8f063e5b305189_720.png?hl=ja 720w,https://developer.android.com/static/codelabs/health-connect/img/8f063e5b305189_856.png?hl=ja 856w,https://developer.android.com/static/codelabs/health-connect/img/8f063e5b305189_960.png?hl=ja 960w,https://developer.android.com/static/codelabs/health-connect/img/8f063e5b305189_1440.png?hl=ja 1440w,https://developer.android.com/static/codelabs/health-connect/img/8f063e5b305189_1920.png?hl=ja 1920w,https://developer.android.com/static/codelabs/health-connect/img/8f063e5b305189_2880.png?hl=ja 2880w" style="width: 235.29px" />                 <img alt="fd39f325f5c19e5d.png" sizes="(max-width: 840px) 100vw, 856px" src="https://developer.android.com/static/codelabs/health-connect/img/fd39f325f5c19e5d.png?hl=ja" srcset="https://developer.android.com/static/codelabs/health-connect/img/fd39f325f5c19e5d_36.png?hl=ja 36w,https://developer.android.com/static/codelabs/health-connect/img/fd39f325f5c19e5d_48.png?hl=ja 48w,https://developer.android.com/static/codelabs/health-connect/img/fd39f325f5c19e5d_72.png?hl=ja 72w,https://developer.android.com/static/codelabs/health-connect/img/fd39f325f5c19e5d_96.png?hl=ja 96w,https://developer.android.com/static/codelabs/health-connect/img/fd39f325f5c19e5d_480.png?hl=ja 480w,https://developer.android.com/static/codelabs/health-connect/img/fd39f325f5c19e5d_720.png?hl=ja 720w,https://developer.android.com/static/codelabs/health-connect/img/fd39f325f5c19e5d_856.png?hl=ja 856w,https://developer.android.com/static/codelabs/health-connect/img/fd39f325f5c19e5d_960.png?hl=ja 960w,https://developer.android.com/static/codelabs/health-connect/img/fd39f325f5c19e5d_1440.png?hl=ja 1440w,https://developer.android.com/static/codelabs/health-connect/img/fd39f325f5c19e5d_1920.png?hl=ja 1920w,https://developer.android.com/static/codelabs/health-connect/img/fd39f325f5c19e5d_2880.png?hl=ja 2880w" style="width: 235.06px" /></p>
<aside class="special"><p><strong>注</strong>: データを保護するため、ヘルスコネクトを使用するには、PIN、パターン、またはパスワードによるスマートフォンのロック方法を設定する必要があります。ヘルスコネクトにアクセスするための画面ロックを設定するには、スマートフォンの [設定] に移動してください。</p>
</aside>


        </google-codelab-step>
      
        <google-codelab-step duration="7" step="2" label="権限の管理">
          
          <h2 class="step-title" data-text="               3. 権限の管理           " id="2" tabindex="-1">
              3. 権限の管理
          </h2>
          <p>ヘルスコネクトでは、権限のリクエストをアプリで使用されるデータ型に制限することがデベロッパーに推奨されます。権限を包括的にリクエストすると、アプリに対するユーザーの信頼度が低下し、ユーザーの信用を損なう可能性があります。権限リクエストが 3 回以上拒否されると、アプリがロックアウトされます。その結果、権限のリクエストが表示されなくなります。</p>
<p>この Codelab では、次の権限のみが必要です。</p>
<ul>
<li>エクササイズ セッション</li>
<li>心拍数</li>
<li>手順</li>
<li>総消費カロリー</li>
<li>体重</li>
</ul>
<h2 data-text="権限を宣言する" id="declare-permissions" is-upgraded="" tabindex="-1"><strong>権限を宣言する</strong></h2>
<p>アプリが読み書きするデータ型はすべて、<code dir="ltr" translate="no">AndroidManifest.xml</code> 内で権限を使用して宣言する必要があります。バージョン <a href="https://developer.android.com/jetpack/androidx/releases/health-connect?hl=ja#1.0.0-alpha10" target="_blank"><code dir="ltr" translate="no">1.0.0-alpha10</code></a> 以降のヘルスコネクトでは、標準的な Android 権限の宣言形式を使用します。</p>
<p>必要なデータ型の権限を宣言するには、<code dir="ltr" translate="no">&lt;uses-permission&gt;</code> 要素を使用して権限にそれぞれの名前を割り当てます。<code dir="ltr" translate="no">&lt;manifest&gt;</code> タグ内にネストします。権限とそれに対応するデータ型の一覧については、<a href="https://developer.android.com/guide/health-and-fitness/health-connect/data-and-data-types/data-types?hl=ja#permissions" target="_blank">データ型のリスト</a>をご覧ください。</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="scdoc"><code translate="no" dir="ltr">&lt;!-- TODO: Required to specify which Health Connect permissions the app can request --&gt;
  &lt;uses-permission android:name="android.permission.health.READ_HEART_RATE"/&gt;
  &lt;uses-permission android:name="android.permission.health.WRITE_HEART_RATE"/&gt;
  &lt;uses-permission android:name="android.permission.health.READ_STEPS"/&gt;
  &lt;uses-permission android:name="android.permission.health.WRITE_STEPS"/&gt;
  &lt;uses-permission android:name="android.permission.health.READ_EXERCISE"/&gt;
  &lt;uses-permission android:name="android.permission.health.WRITE_EXERCISE"/&gt;
  &lt;uses-permission android:name="android.permission.health.READ_TOTAL_CALORIES_BURNED"/&gt;
  &lt;uses-permission android:name="android.permission.health.WRITE_TOTAL_CALORIES_BURNED"/&gt;
  &lt;uses-permission android:name="android.permission.health.READ_WEIGHT"/&gt;
  &lt;uses-permission android:name="android.permission.health.WRITE_WEIGHT"/&gt;
</code></pre></devsite-code>
<p><code dir="ltr" translate="no">AndroidManifest.xml</code> でインテント フィルタを宣言して、そうした権限をアプリでどのように使用するかを説明するインテントを処理します。アプリはこのインテントを処理して、ユーザーデータの使用方法と処理方法を説明したプライバシー ポリシーを表示する必要があります。ユーザーがヘルスコネクトの権限ダイアログで<strong>プライバシー ポリシー</strong>のリンクをタップすると、このインテントがアプリに送信されます。</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="scdoc"><code translate="no" dir="ltr">&lt;!-- TODO: Add intent filter to handle permission rationale intent --&gt;
&lt;!-- Permission handling for Android 13 and before --&gt;
&lt;intent-filter&gt;
  &lt;action android:name="androidx.health.ACTION_SHOW_PERMISSIONS_RATIONALE" /&gt;
&lt;/intent-filter&gt;

&lt;!-- Permission handling for Android 14 and later --&gt;
&lt;intent-filter&gt;
  &lt;action android:name="android.intent.action.VIEW_PERMISSION_USAGE"/&gt;
  &lt;category android:name="android.intent.category.HEALTH_PERMISSIONS"/&gt;
&lt;/intent-filter&gt;

</code></pre></devsite-code>
<p>次にアプリを再度開いて、宣言された権限を確認します。メニュー ドロワーの [<strong>Settings</strong>] をクリックして、[Health Connect Settings] 画面に移動します。次に、[<strong>App permissions</strong>] をクリックすると、リストに [<strong>Health Connect Codelab</strong>] が表示されます。[<strong>Health Connect Codelab</strong>] をクリックして、対象のアプリの読み取り / 書き込みアクセス権のデータ型のリストを表示します。</p>
<p class="image-container"><img alt="fbed69d871f92178.png" sizes="(max-width: 840px) 100vw, 856px" src="https://developer.android.com/static/codelabs/health-connect/img/fbed69d871f92178.png?hl=ja" srcset="https://developer.android.com/static/codelabs/health-connect/img/fbed69d871f92178_36.png?hl=ja 36w,https://developer.android.com/static/codelabs/health-connect/img/fbed69d871f92178_48.png?hl=ja 48w,https://developer.android.com/static/codelabs/health-connect/img/fbed69d871f92178_72.png?hl=ja 72w,https://developer.android.com/static/codelabs/health-connect/img/fbed69d871f92178_96.png?hl=ja 96w,https://developer.android.com/static/codelabs/health-connect/img/fbed69d871f92178_480.png?hl=ja 480w,https://developer.android.com/static/codelabs/health-connect/img/fbed69d871f92178_720.png?hl=ja 720w,https://developer.android.com/static/codelabs/health-connect/img/fbed69d871f92178_856.png?hl=ja 856w,https://developer.android.com/static/codelabs/health-connect/img/fbed69d871f92178_960.png?hl=ja 960w,https://developer.android.com/static/codelabs/health-connect/img/fbed69d871f92178_1440.png?hl=ja 1440w,https://developer.android.com/static/codelabs/health-connect/img/fbed69d871f92178_1920.png?hl=ja 1920w,https://developer.android.com/static/codelabs/health-connect/img/fbed69d871f92178_2880.png?hl=ja 2880w" style="width: 265.00px" />         <img alt="1b9c7764c1dbdfac.png" sizes="(max-width: 840px) 100vw, 856px" src="https://developer.android.com/static/codelabs/health-connect/img/1b9c7764c1dbdfac.png?hl=ja" srcset="https://developer.android.com/static/codelabs/health-connect/img/1b9c7764c1dbdfac_36.png?hl=ja 36w,https://developer.android.com/static/codelabs/health-connect/img/1b9c7764c1dbdfac_48.png?hl=ja 48w,https://developer.android.com/static/codelabs/health-connect/img/1b9c7764c1dbdfac_72.png?hl=ja 72w,https://developer.android.com/static/codelabs/health-connect/img/1b9c7764c1dbdfac_96.png?hl=ja 96w,https://developer.android.com/static/codelabs/health-connect/img/1b9c7764c1dbdfac_480.png?hl=ja 480w,https://developer.android.com/static/codelabs/health-connect/img/1b9c7764c1dbdfac_720.png?hl=ja 720w,https://developer.android.com/static/codelabs/health-connect/img/1b9c7764c1dbdfac_856.png?hl=ja 856w,https://developer.android.com/static/codelabs/health-connect/img/1b9c7764c1dbdfac_960.png?hl=ja 960w,https://developer.android.com/static/codelabs/health-connect/img/1b9c7764c1dbdfac_1440.png?hl=ja 1440w,https://developer.android.com/static/codelabs/health-connect/img/1b9c7764c1dbdfac_1920.png?hl=ja 1920w,https://developer.android.com/static/codelabs/health-connect/img/1b9c7764c1dbdfac_2880.png?hl=ja 2880w" style="width: 255.20px" /></p>
<h2 data-text="権限をリクエストする" id="request-permissions" is-upgraded="" tabindex="-1"><strong>権限をリクエストする</strong></h2>
<p>権限を管理する際は、ユーザーをヘルスコネクトの設定に直接誘導するほかに、Health Connect API を介してアプリから権限をリクエストすることもできます。ユーザーはいつでも権限を変更する可能性があるため、必要な権限が利用できるかどうかをアプリでチェックしてください。この Codelab プロジェクトでは、データの読み取りまたは書き込みの前にチェックを行い、権限リクエストを送信します。</p>
<p><code dir="ltr" translate="no">HealthConnectClient</code> が Health Connect API のエントリ ポイントです。<code dir="ltr" translate="no">HealthConnectManager.kt</code> で、<code dir="ltr" translate="no">HealthConnectClient</code> インスタンスを取得します。</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Text only"><code translate="no" dir="ltr">private val healthConnectClient by lazy { HealthConnectClient.getOrCreate(context) }
</code></pre></devsite-code>
<p>アプリ内で権限リクエスト ダイアログを開始するには、まず、必要なデータ型の権限セットを作成します。使用するデータ型に対する権限のみをリクエストする必要があります。</p>
<p>たとえば、[<strong>Record weight</strong>] 画面では、体重の読み取り / 書き込み権限のみを付与する必要があります。次のコードのように、<code dir="ltr" translate="no">InputReadingsViewModel.kt</code> に権限セットを作成しました。</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Text only"><code translate="no" dir="ltr">  val permissions = setOf(
    HealthPermission.getReadPermission(WeightRecord::class),
    HealthPermission.getWritePermission(WeightRecord::class),
  )
</code></pre></devsite-code>
<p>次に、権限のリクエストを実行する前に、権限が付与されているかどうかを確認します。<code dir="ltr" translate="no">HealthConnectManager.kt</code> で、<code dir="ltr" translate="no">getGrantedPermissions</code> を使用して、必要なデータ型の権限が付与されているかどうかを確認します。権限リクエストを実行するには、<code dir="ltr" translate="no">PermissionController.createRequestPermissionResultContract()</code> を使用して <code dir="ltr" translate="no">ActivityResultContract</code> を作成する必要があります。このコードは、必要な権限が付与されていない場合に実行する必要があります。</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Text only"><code translate="no" dir="ltr">  suspend fun hasAllPermissions(permissions: Set&lt;String&gt;): Boolean {
    return healthConnectClient.permissionController.getGrantedPermissions().containsAll(permissions)
  }

  fun requestPermissionsActivityContract(): ActivityResultContract&lt;Set&lt;String&gt;, Set&lt;String&gt;&gt; {
    return PermissionController.createRequestPermissionResultContract()
  }
</code></pre></devsite-code>
<p>Codelab サンプルアプリで、必要なデータ型に権限を付与していない場合、画面に [<strong>Request permissions</strong>] ボタンが表示されることがあります。[<strong>Request permissions</strong>] をクリックして、ヘルスコネクトの権限ダイアログを開きます。必要な権限を許可して、Codelab アプリに戻ります。</p>
<p class="image-container"><img alt="a0eb27cea376e56f.png" sizes="(max-width: 840px) 100vw, 856px" src="https://developer.android.com/static/codelabs/health-connect/img/a0eb27cea376e56f.png?hl=ja" srcset="https://developer.android.com/static/codelabs/health-connect/img/a0eb27cea376e56f_36.png?hl=ja 36w,https://developer.android.com/static/codelabs/health-connect/img/a0eb27cea376e56f_48.png?hl=ja 48w,https://developer.android.com/static/codelabs/health-connect/img/a0eb27cea376e56f_72.png?hl=ja 72w,https://developer.android.com/static/codelabs/health-connect/img/a0eb27cea376e56f_96.png?hl=ja 96w,https://developer.android.com/static/codelabs/health-connect/img/a0eb27cea376e56f_480.png?hl=ja 480w,https://developer.android.com/static/codelabs/health-connect/img/a0eb27cea376e56f_720.png?hl=ja 720w,https://developer.android.com/static/codelabs/health-connect/img/a0eb27cea376e56f_856.png?hl=ja 856w,https://developer.android.com/static/codelabs/health-connect/img/a0eb27cea376e56f_960.png?hl=ja 960w,https://developer.android.com/static/codelabs/health-connect/img/a0eb27cea376e56f_1440.png?hl=ja 1440w,https://developer.android.com/static/codelabs/health-connect/img/a0eb27cea376e56f_1920.png?hl=ja 1920w,https://developer.android.com/static/codelabs/health-connect/img/a0eb27cea376e56f_2880.png?hl=ja 2880w" style="width: 237.64px" />         <img alt="4752973f6b0b8d56.png" sizes="(max-width: 840px) 100vw, 856px" src="https://developer.android.com/static/codelabs/health-connect/img/4752973f6b0b8d56.png?hl=ja" srcset="https://developer.android.com/static/codelabs/health-connect/img/4752973f6b0b8d56_36.png?hl=ja 36w,https://developer.android.com/static/codelabs/health-connect/img/4752973f6b0b8d56_48.png?hl=ja 48w,https://developer.android.com/static/codelabs/health-connect/img/4752973f6b0b8d56_72.png?hl=ja 72w,https://developer.android.com/static/codelabs/health-connect/img/4752973f6b0b8d56_96.png?hl=ja 96w,https://developer.android.com/static/codelabs/health-connect/img/4752973f6b0b8d56_480.png?hl=ja 480w,https://developer.android.com/static/codelabs/health-connect/img/4752973f6b0b8d56_720.png?hl=ja 720w,https://developer.android.com/static/codelabs/health-connect/img/4752973f6b0b8d56_856.png?hl=ja 856w,https://developer.android.com/static/codelabs/health-connect/img/4752973f6b0b8d56_960.png?hl=ja 960w,https://developer.android.com/static/codelabs/health-connect/img/4752973f6b0b8d56_1440.png?hl=ja 1440w,https://developer.android.com/static/codelabs/health-connect/img/4752973f6b0b8d56_1920.png?hl=ja 1920w,https://developer.android.com/static/codelabs/health-connect/img/4752973f6b0b8d56_2880.png?hl=ja 2880w" style="width: 236.74px" /></p>


        </google-codelab-step>
      
        <google-codelab-step duration="10" step="3" label="データを書き込む">
          
          <h2 class="step-title" data-text="               4. データを書き込む           " id="3" tabindex="-1">
              4. データを書き込む
          </h2>
          <p>ヘルスコネクトへのレコードの書き込みを開始します。体重のレコードを書き込むには、体重の入力値を含む <code dir="ltr" translate="no">WeightRecord</code> オブジェクトを作成します。ヘルスコネクト SDK はさまざまな<a href="https://developer.android.com/reference/androidx/health/connect/client/units/package-summary?hl=ja" target="_blank">単位</a>クラスをサポートしています。たとえば、<code dir="ltr" translate="no">Mass.kilograms(weightInput)</code> を使用すると、ユーザーの体重をキログラム単位で設定できます。</p>
<p>基本的に、ヘルスコネクトに書き込むデータには常にゾーン オフセット情報を指定するようにします。データの書き込み時にゾーン オフセット情報を指定すると、ヘルスコネクトのデータを読み取った際にタイムゾーン情報が提供されます。</p>
<p>体重レコードを作成したら、<code dir="ltr" translate="no">healthConnectClient.insertRecords</code> を使ってヘルスコネクトにデータを書き込みます。</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Transact-SQL"><code translate="no" dir="ltr"><span class="devsite-syntax-cm">/**</span>
<span class="devsite-syntax-cm">* TODO: Writes [WeightRecord] to Health Connect.</span>
<span class="devsite-syntax-cm">*/</span>
<span class="devsite-syntax-n">suspend</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">writeWeightInput</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-nl">weightInput</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">Double</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">   </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">time</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ZonedDateTime</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">now</span><span class="devsite-syntax-p">().</span><span class="devsite-syntax-n">withNano</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">   </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">weightRecord</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">WeightRecord</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">       </span><span class="devsite-syntax-n">metadata</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Metadata</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">manualEntry</span><span class="devsite-syntax-p">(),</span>
<span class="devsite-syntax-w">       </span><span class="devsite-syntax-n">weight</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Mass</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">kilograms</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">weightInput</span><span class="devsite-syntax-p">),</span>
<span class="devsite-syntax-w">       </span><span class="devsite-syntax-nc">time</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">time</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">toInstant</span><span class="devsite-syntax-p">(),</span>
<span class="devsite-syntax-w">       </span><span class="devsite-syntax-n">zoneOffset</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">time</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">offset</span>
<span class="devsite-syntax-w">   </span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">   </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">records</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">listOf</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">weightRecord</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">   </span><span class="devsite-syntax-k">try</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">healthConnectClient</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">insertRecords</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">records</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">Toast</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">makeText</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-ss">"Successfully insert records"</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Toast</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">LENGTH_SHORT</span><span class="devsite-syntax-p">).</span><span class="devsite-syntax-n">show</span><span class="devsite-syntax-p">()</span>
<span class="devsite-syntax-w">   </span><span class="devsite-syntax-err">}</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">catch</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-nl">e</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">Exception</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">Toast</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">makeText</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">e</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">message</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">toString</span><span class="devsite-syntax-p">(),</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Toast</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">LENGTH_SHORT</span><span class="devsite-syntax-p">).</span><span class="devsite-syntax-n">show</span><span class="devsite-syntax-p">()</span>
<span class="devsite-syntax-w">   </span><span class="devsite-syntax-err">}</span>
<span class="devsite-syntax-err">}</span>
</code></pre></devsite-code>
<p>次に、アプリを実行します。[<strong>Record weight</strong>] をクリックし、新しい体重レコードをキログラム単位で入力します。体重レコードがヘルスコネクトに正常に書き込まれたかどうかを確認するには、ヘルスコネクト アプリの設定を開き、<strong>[データとアクセス] > [身体測定] > [体重] > [すべてのエントリを表示]</strong> をクリックします。ヘルスコネクト Codelab から書き込まれた新しい体重レコードが表示されます。</p>
<h2 data-text="エクササイズ セッションを書き込む" id="write-exercise-sessions" is-upgraded="" tabindex="-1"><strong>エクササイズ セッションを書き込む</strong></h2>
<p>セッションとは、ユーザーがアクティビティを実施する期間です。ヘルスコネクトのエクササイズ セッションには、ランニングからバドミントンまで、さまざまなものがあります。セッションにより、ユーザーは時間ベースのパフォーマンスを測定できます。このデータには、一定期間にわたって測定された一連の瞬間的なサンプル（アクティビティ中の連続的な心拍数や位置情報のサンプルなど）が記録されます。</p>
<p>次の例は、エクササイズ セッションを書き込む方法を示しています。<code dir="ltr" translate="no">healthConnectClient.insertRecords</code> を使用して、セッションに関連付けられた複数のデータレコードを挿入します。この例の挿入リクエストには、<code dir="ltr" translate="no">ExerciseType</code> を含む <code dir="ltr" translate="no">ExerciseSessionRecord</code>、歩数を含む <code dir="ltr" translate="no">StepsRecord</code>、<code dir="ltr" translate="no">Energy</code> を含む <code dir="ltr" translate="no">TotalCaloriesBurnedRecord</code>、および一連の <code dir="ltr" translate="no">HeartRateRecord</code> サンプルが含まれます。</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Transact-SQL"><code translate="no" dir="ltr"><span class="devsite-syntax-w">  </span><span class="devsite-syntax-cm">/**</span>
<span class="devsite-syntax-cm">   * TODO: Writes an [ExerciseSessionRecord] to Health Connect.</span>
<span class="devsite-syntax-cm">   */</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-n">suspend</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">writeExerciseSession</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-k">start</span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ZonedDateTime</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">end</span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ZonedDateTime</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">healthConnectClient</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">insertRecords</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">listOf</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">ExerciseSessionRecord</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">          </span><span class="devsite-syntax-n">metadata</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Metadata</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">manualEntry</span><span class="devsite-syntax-p">(),</span>
<span class="devsite-syntax-w">          </span><span class="devsite-syntax-n">startTime</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">start</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">toInstant</span><span class="devsite-syntax-p">(),</span>
<span class="devsite-syntax-w">          </span><span class="devsite-syntax-n">startZoneOffset</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">start</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">offset</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">          </span><span class="devsite-syntax-n">endTime</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">end</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">toInstant</span><span class="devsite-syntax-p">(),</span>
<span class="devsite-syntax-w">          </span><span class="devsite-syntax-n">endZoneOffset</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">end</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">offset</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">          </span><span class="devsite-syntax-n">exerciseType</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ExerciseSessionRecord</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">EXERCISE_TYPE_RUNNING</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">          </span><span class="devsite-syntax-n">title</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-ss">"My Run #${Random.nextInt(0, 60)}"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">),</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">StepsRecord</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">          </span><span class="devsite-syntax-n">metadata</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Metadata</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">manualEntry</span><span class="devsite-syntax-p">(),</span>
<span class="devsite-syntax-w">          </span><span class="devsite-syntax-n">startTime</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">start</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">toInstant</span><span class="devsite-syntax-p">(),</span>
<span class="devsite-syntax-w">          </span><span class="devsite-syntax-n">startZoneOffset</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">start</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">offset</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">          </span><span class="devsite-syntax-n">endTime</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">end</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">toInstant</span><span class="devsite-syntax-p">(),</span>
<span class="devsite-syntax-w">          </span><span class="devsite-syntax-n">endZoneOffset</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">end</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">offset</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">          </span><span class="devsite-syntax-nf">count</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">1000</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">+</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">1000</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Random</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">nextInt</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">3</span><span class="devsite-syntax-p">)).</span><span class="devsite-syntax-n">toLong</span><span class="devsite-syntax-p">()</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">),</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">TotalCaloriesBurnedRecord</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">          </span><span class="devsite-syntax-n">metadata</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Metadata</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">manualEntry</span><span class="devsite-syntax-p">(),</span>
<span class="devsite-syntax-w">          </span><span class="devsite-syntax-n">startTime</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">start</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">toInstant</span><span class="devsite-syntax-p">(),</span>
<span class="devsite-syntax-w">          </span><span class="devsite-syntax-n">startZoneOffset</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">start</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">offset</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">          </span><span class="devsite-syntax-n">endTime</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">end</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">toInstant</span><span class="devsite-syntax-p">(),</span>
<span class="devsite-syntax-w">          </span><span class="devsite-syntax-n">endZoneOffset</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">end</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">offset</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">          </span><span class="devsite-syntax-n">energy</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Energy</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">calories</span><span class="devsite-syntax-p">((</span><span class="devsite-syntax-mi">140</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">+</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Random</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">nextInt</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">20</span><span class="devsite-syntax-p">))</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mf">0.01</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">+</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">buildHeartRateSeries</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-k">start</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">end</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-err">}</span>

<span class="devsite-syntax-w">  </span><span class="devsite-syntax-cm">/**</span>
<span class="devsite-syntax-cm">   * TODO: Build [HeartRateRecord].</span>
<span class="devsite-syntax-cm">   */</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-n">private</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">buildHeartRateSeries</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-nl">sessionStartTime</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ZonedDateTime</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-nl">sessionEndTime</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ZonedDateTime</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">HeartRateRecord</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">samples</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">mutableListOf&lt;HeartRateRecord</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Sample</span>&gt;<span class="devsite-syntax-p">()</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-nf">var</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">time</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">sessionStartTime</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">while</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-nc">time</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">isBefore</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">sessionEndTime</span><span class="devsite-syntax-p">))</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">samples</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-k">add</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">HeartRateRecord</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Sample</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">          </span><span class="devsite-syntax-nc">time</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">time</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">toInstant</span><span class="devsite-syntax-p">(),</span>
<span class="devsite-syntax-w">          </span><span class="devsite-syntax-n">beatsPerMinute</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">80</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">+</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Random</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">nextInt</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">80</span><span class="devsite-syntax-p">)).</span><span class="devsite-syntax-n">toLong</span><span class="devsite-syntax-p">()</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-nc">time</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">time</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">plusSeconds</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">30</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-err">}</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">HeartRateRecord</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">metadata</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Metadata</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">manualEntry</span><span class="devsite-syntax-p">(),</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">startTime</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">sessionStartTime</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">toInstant</span><span class="devsite-syntax-p">(),</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">startZoneOffset</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">sessionStartTime</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">offset</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">endTime</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">sessionEndTime</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">toInstant</span><span class="devsite-syntax-p">(),</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">endZoneOffset</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">sessionEndTime</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">offset</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">samples</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">samples</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-err">}</span>
</code></pre></devsite-code>


        </google-codelab-step>
      
        <google-codelab-step duration="15" step="4" label="データを読み取る">
          
          <h2 class="step-title" data-text="               5. データを読み取る           " id="4" tabindex="-1">
              5. データを読み取る
          </h2>
          <p>これで、Codelab サンプルアプリとツールボックス アプリの両方で、体重とエクササイズ セッションのレコードを書き込めました。Health Connect API を使用してこれらのレコードを読み取りましょう。まず <code dir="ltr" translate="no">ReadRecordsRequest</code> を作成し、読み取るレコードタイプと期間を指定します。<code dir="ltr" translate="no">ReadRecordsRequest</code> で、<code dir="ltr" translate="no">dataOriginFilter</code> を設定して、読み取り元のレコードのソースアプリを指定することもできます。</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Transact-SQL"><code translate="no" dir="ltr"><span class="devsite-syntax-w">    </span><span class="devsite-syntax-cm">/**</span>
<span class="devsite-syntax-cm">     * TODO: Reads in existing [WeightRecord]s.</span>
<span class="devsite-syntax-cm">     */</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">suspend</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">readWeightInputs</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-k">start</span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Instant</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">end</span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Instant</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">List&lt;WeightRecord&gt;</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">request</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ReadRecordsRequest</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">recordType</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nl">WeightRecord</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-k">class</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">timeRangeFilter</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">TimeRangeFilter</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-ow">between</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-k">start</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">end</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">response</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">healthConnectClient</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">readRecords</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">request</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">response</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">records</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-err">}</span>
</code></pre></devsite-code>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Transact-SQL"><code translate="no" dir="ltr"><span class="devsite-syntax-w">  </span><span class="devsite-syntax-cm">/**</span>
<span class="devsite-syntax-cm">   * TODO: Obtains a list of [ExerciseSessionRecord]s in a specified time frame.</span>
<span class="devsite-syntax-cm">   */</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-n">suspend</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">readExerciseSessions</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-k">start</span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Instant</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">end</span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Instant</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">List&lt;ExerciseSessionRecord&gt;</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">request</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ReadRecordsRequest</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">recordType</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nl">ExerciseSessionRecord</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-k">class</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">timeRangeFilter</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">TimeRangeFilter</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-ow">between</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-k">start</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">end</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">response</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">healthConnectClient</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">readRecords</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">request</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">response</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">records</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-err">}</span>
</code></pre></devsite-code>
<p>アプリを実行して、体重のレコードとエクササイズ セッションのリストが表示されるかどうかを確認しましょう。</p>
<p class="image-container"><img alt="a08af54eef6bc832.png" sizes="(max-width: 840px) 100vw, 856px" src="https://developer.android.com/static/codelabs/health-connect/img/a08af54eef6bc832.png?hl=ja" srcset="https://developer.android.com/static/codelabs/health-connect/img/a08af54eef6bc832_36.png?hl=ja 36w,https://developer.android.com/static/codelabs/health-connect/img/a08af54eef6bc832_48.png?hl=ja 48w,https://developer.android.com/static/codelabs/health-connect/img/a08af54eef6bc832_72.png?hl=ja 72w,https://developer.android.com/static/codelabs/health-connect/img/a08af54eef6bc832_96.png?hl=ja 96w,https://developer.android.com/static/codelabs/health-connect/img/a08af54eef6bc832_480.png?hl=ja 480w,https://developer.android.com/static/codelabs/health-connect/img/a08af54eef6bc832_720.png?hl=ja 720w,https://developer.android.com/static/codelabs/health-connect/img/a08af54eef6bc832_856.png?hl=ja 856w,https://developer.android.com/static/codelabs/health-connect/img/a08af54eef6bc832_960.png?hl=ja 960w,https://developer.android.com/static/codelabs/health-connect/img/a08af54eef6bc832_1440.png?hl=ja 1440w,https://developer.android.com/static/codelabs/health-connect/img/a08af54eef6bc832_1920.png?hl=ja 1920w,https://developer.android.com/static/codelabs/health-connect/img/a08af54eef6bc832_2880.png?hl=ja 2880w" style="width: 267.38px" />         <img alt="3b0781389f1094a1.png" sizes="(max-width: 840px) 100vw, 856px" src="https://developer.android.com/static/codelabs/health-connect/img/3b0781389f1094a1.png?hl=ja" srcset="https://developer.android.com/static/codelabs/health-connect/img/3b0781389f1094a1_36.png?hl=ja 36w,https://developer.android.com/static/codelabs/health-connect/img/3b0781389f1094a1_48.png?hl=ja 48w,https://developer.android.com/static/codelabs/health-connect/img/3b0781389f1094a1_72.png?hl=ja 72w,https://developer.android.com/static/codelabs/health-connect/img/3b0781389f1094a1_96.png?hl=ja 96w,https://developer.android.com/static/codelabs/health-connect/img/3b0781389f1094a1_480.png?hl=ja 480w,https://developer.android.com/static/codelabs/health-connect/img/3b0781389f1094a1_720.png?hl=ja 720w,https://developer.android.com/static/codelabs/health-connect/img/3b0781389f1094a1_856.png?hl=ja 856w,https://developer.android.com/static/codelabs/health-connect/img/3b0781389f1094a1_960.png?hl=ja 960w,https://developer.android.com/static/codelabs/health-connect/img/3b0781389f1094a1_1440.png?hl=ja 1440w,https://developer.android.com/static/codelabs/health-connect/img/3b0781389f1094a1_1920.png?hl=ja 1920w,https://developer.android.com/static/codelabs/health-connect/img/3b0781389f1094a1_2880.png?hl=ja 2880w" style="width: 296.50px" /></p>


        </google-codelab-step>
      
        <google-codelab-step duration="10" step="5" label="バックグラウンドでデータを読み取る">
          
          <h2 class="step-title" data-text="               6. バックグラウンドでデータを読み取る           " id="5" tabindex="-1">
              6. バックグラウンドでデータを読み取る
          </h2>
          <h2 data-text="権限を宣言する" id="declare-permission" is-upgraded="" tabindex="-1"><strong>権限を宣言する</strong></h2>
<p>バックグラウンドで健康に関するデータにアクセスするには、<code dir="ltr" translate="no">AndroidManifest.xml</code> ファイルで <code dir="ltr" translate="no">READ_HEALTH_DATA_IN_BACKGROUND</code> 権限を宣言します。</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="scdoc"><code translate="no" dir="ltr">&lt;!-- TODO: Required to specify which Health Connect permissions the app can request --&gt;
...
&lt;uses-permission android:name="android.permission.health.READ_HEALTH_DATA_IN_BACKGROUND" /&gt;
</code></pre></devsite-code>
<h2 data-text="機能が使用できることを確認する" id="check-feature-availability" is-upgraded="" tabindex="-1"><strong>機能が使用できることを確認する</strong></h2>
<p>ヘルスコネクトの最新バージョンを使用していないユーザーもいるため、まず<a href="https://developer.android.com/health-and-fitness/guides/health-connect/develop/feature-availability?hl=ja" target="_blank">機能が使用できるかどうか</a>確認することをおすすめします。<code dir="ltr" translate="no">HealthConnectManager.kt</code> では、<a href="https://developer.android.com/reference/androidx/health/connect/client/HealthConnectFeatures?hl=ja#getFeatureStatus(kotlin.Int)" target="_blank"><code dir="ltr" translate="no">getFeatureStatus()</code></a> メソッドを使用してこれを行います。</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="scdoc"><code translate="no" dir="ltr">fun isFeatureAvailable(feature: Int): Boolean{
    return healthConnectClient
      .features
      .getFeatureStatus(feature) == HealthConnectFeatures.FEATURE_STATUS_AVAILABLE
  }
</code></pre></devsite-code>
<p><code dir="ltr" translate="no">ExerciseSessionViewModel.kt</code> のバックグラウンドでの読み取り機能は、<a href="https://developer.android.com/reference/androidx/health/connect/client/HealthConnectFeatures?hl=ja#FEATURE_READ_HEALTH_DATA_IN_BACKGROUND()" target="_blank"><code dir="ltr" translate="no">FEATURE_READ_HEALTH_DATA_IN_BACKGROUND</code></a> 定数を使用して確認できます。</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="scdoc"><code translate="no" dir="ltr">backgroundReadAvailable.value = healthConnectManager.isFeatureAvailable(
    HealthConnectFeatures.FEATURE_READ_HEALTH_DATA_IN_BACKGROUND
)
</code></pre></devsite-code>
<h2 data-text="権限をリクエストする" id="request-permissions_1" is-upgraded="" tabindex="-1"><strong>権限をリクエストする</strong></h2>
<p>バックグラウンドでの読み取り機能が使用できることを確認したら、[<strong>Exercise sessions</strong>] 画面で [<strong>Request Background Read</strong>] をクリックして、<a href="https://developer.android.com/reference/androidx/health/connect/client/permission/HealthPermission?hl=ja#PERMISSION_READ_HEALTH_DATA_IN_BACKGROUND()" target="_blank">PERMISSION_READ_HEALTH_DATA_IN_BACKGROUND</a> 権限をリクエストできます。</p>
<p>ユーザーには次のプロンプトが表示されます。</p>
<p class="image-container"><img alt="edfb507d0976427a.png" sizes="(max-width: 840px) 100vw, 856px" src="https://developer.android.com/static/codelabs/health-connect/img/edfb507d0976427a.png?hl=ja" srcset="https://developer.android.com/static/codelabs/health-connect/img/edfb507d0976427a_36.png?hl=ja 36w,https://developer.android.com/static/codelabs/health-connect/img/edfb507d0976427a_48.png?hl=ja 48w,https://developer.android.com/static/codelabs/health-connect/img/edfb507d0976427a_72.png?hl=ja 72w,https://developer.android.com/static/codelabs/health-connect/img/edfb507d0976427a_96.png?hl=ja 96w,https://developer.android.com/static/codelabs/health-connect/img/edfb507d0976427a_480.png?hl=ja 480w,https://developer.android.com/static/codelabs/health-connect/img/edfb507d0976427a_720.png?hl=ja 720w,https://developer.android.com/static/codelabs/health-connect/img/edfb507d0976427a_856.png?hl=ja 856w,https://developer.android.com/static/codelabs/health-connect/img/edfb507d0976427a_960.png?hl=ja 960w,https://developer.android.com/static/codelabs/health-connect/img/edfb507d0976427a_1440.png?hl=ja 1440w,https://developer.android.com/static/codelabs/health-connect/img/edfb507d0976427a_1920.png?hl=ja 1920w,https://developer.android.com/static/codelabs/health-connect/img/edfb507d0976427a_2880.png?hl=ja 2880w" style="width: 267.84px" /></p>
<p>ユーザーは、システム設定で <strong>[ヘルスコネクト] > [アプリの権限] > [Health Connect Codelab] > [アクセス権の追加] > [バックグラウンドでのデータアクセス]</strong> に移動して、バックグラウンドでの読み取り権限を付与することもできます。</p>
<p class="image-container"><img alt="154a4ebf8069457a.png" sizes="(max-width: 840px) 100vw, 856px" src="https://developer.android.com/static/codelabs/health-connect/img/154a4ebf8069457a.png?hl=ja" srcset="https://developer.android.com/static/codelabs/health-connect/img/154a4ebf8069457a_36.png?hl=ja 36w,https://developer.android.com/static/codelabs/health-connect/img/154a4ebf8069457a_48.png?hl=ja 48w,https://developer.android.com/static/codelabs/health-connect/img/154a4ebf8069457a_72.png?hl=ja 72w,https://developer.android.com/static/codelabs/health-connect/img/154a4ebf8069457a_96.png?hl=ja 96w,https://developer.android.com/static/codelabs/health-connect/img/154a4ebf8069457a_480.png?hl=ja 480w,https://developer.android.com/static/codelabs/health-connect/img/154a4ebf8069457a_720.png?hl=ja 720w,https://developer.android.com/static/codelabs/health-connect/img/154a4ebf8069457a_856.png?hl=ja 856w,https://developer.android.com/static/codelabs/health-connect/img/154a4ebf8069457a_960.png?hl=ja 960w,https://developer.android.com/static/codelabs/health-connect/img/154a4ebf8069457a_1440.png?hl=ja 1440w,https://developer.android.com/static/codelabs/health-connect/img/154a4ebf8069457a_1920.png?hl=ja 1920w,https://developer.android.com/static/codelabs/health-connect/img/154a4ebf8069457a_2880.png?hl=ja 2880w" style="width: 267.84px" /></p>
<h2 data-text="バックグラウンドでデータを読み取る" id="read-data-in-background" is-upgraded="" tabindex="-1"><strong>バックグラウンドでデータを読み取る</strong></h2>
<p><a href="https://developer.android.com/develop/background-work/background-tasks/persistent/getting-started?hl=ja" target="_blank"><code dir="ltr" translate="no">WorkManager</code></a> を使用してバックグラウンド タスクのスケジュールを設定します。[<strong>Read Steps In Background</strong>] ボタンをタップすると、10 秒の遅延後にアプリが <code dir="ltr" translate="no">ReadStepWorker</code> を開始します。この Worker は、過去 24 時間の総歩数をヘルスコネクトから取得します。その後、この情報の詳細を示す同様のログエントリが Logcat に表示されます。</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Text only"><code translate="no" dir="ltr">There are 4000 steps in Health Connect in the last 24 hours.
</code></pre></devsite-code>
<aside class="special"><p><strong>注</strong>: <code dir="ltr" translate="no">ReadStepWorker</code> が必ずバックグラウンドで実行されるようにするには、ボタンをタップした直後にアプリを閉じることが必要な場合があります。</p>
</aside>


        </google-codelab-step>
      
        <google-codelab-step duration="10" step="6" label="過去のデータを読み取る">
          
          <h2 class="step-title" data-text="               7. 過去のデータを読み取る           " id="6" tabindex="-1">
              7. 過去のデータを読み取る
          </h2>
          <h2 data-text="権限を宣言する" id="declare-permission_1" is-upgraded="" tabindex="-1"><strong>権限を宣言する</strong></h2>
<p>他のアプリの 30 日より前の健康に関するデータにアクセスするには、<code dir="ltr" translate="no">AndroidManifest.xml</code> ファイルで <code dir="ltr" translate="no">READ_HEALTH_DATA_HISTORY</code> 権限を宣言します。</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="scdoc"><code translate="no" dir="ltr">&lt;!-- TODO: Required to specify which Health Connect permissions the app can request --&gt;
...
&lt;uses-permission android:name="android.permission.health.READ_HEALTH_DATA_HISTORY" /&gt;
</code></pre></devsite-code>
<h2 data-text="機能が使用できることを確認する" id="check-feature-availability_1" is-upgraded="" tabindex="-1"><strong>機能が使用できることを確認する</strong></h2>
<p>ヘルスコネクトの最新バージョンを使用していないユーザーもいるため、まず<a href="https://developer.android.com/health-and-fitness/guides/health-connect/develop/feature-availability?hl=ja" target="_blank">機能が使用できるかどうか</a>確認することをおすすめします。<code dir="ltr" translate="no">HealthConnectManager.kt</code> では、<a href="https://developer.android.com/reference/androidx/health/connect/client/HealthConnectFeatures?hl=ja#getFeatureStatus(kotlin.Int)" target="_blank"><code dir="ltr" translate="no">getFeatureStatus()</code></a> メソッドを使用してこれを行います。</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="scdoc"><code translate="no" dir="ltr">fun isFeatureAvailable(feature: Int): Boolean{
    return healthConnectClient
      .features
      .getFeatureStatus(feature) == HealthConnectFeatures.FEATURE_STATUS_AVAILABLE
  }
</code></pre></devsite-code>
<p><code dir="ltr" translate="no">ExerciseSessionViewModel.kt</code> の過去のデータの読み取り機能は、<a href="https://developer.android.com/reference/androidx/health/connect/client/HealthConnectFeatures?hl=ja#FEATURE_READ_HEALTH_DATA_HISTORY()" target="_blank"><code dir="ltr" translate="no">FEATURE_READ_HEALTH_DATA_HISTORY</code></a> 定数を使用して確認できます。</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="scdoc"><code translate="no" dir="ltr">historyReadAvailable.value = healthConnectManager.isFeatureAvailable(
    HealthConnectFeatures.FEATURE_READ_HEALTH_DATA_HISTORY
)
</code></pre></devsite-code>
<h2 data-text="権限をリクエストする" id="request-permissions_2" is-upgraded="" tabindex="-1"><strong>権限をリクエストする</strong></h2>
<p>過去のデータの読み取り機能が使用できることを確認したら、[<strong>Exercise sessions</strong>] 画面で [<strong>Request History Read</strong>] をクリックして、<a href="https://developer.android.com/reference/androidx/health/connect/client/permission/HealthPermission?hl=ja#PERMISSION_READ_HEALTH_DATA_HISTORY()" target="_blank">PERMISSION_READ_HEALTH_DATA_HISTORY</a> 権限をリクエストできます。</p>
<p>ユーザーには次のプロンプトが表示されます。</p>
<p class="image-container"><img alt="ff523ee39aeadd8e.png" sizes="(max-width: 840px) 100vw, 856px" src="https://developer.android.com/static/codelabs/health-connect/img/ff523ee39aeadd8e.png?hl=ja" srcset="https://developer.android.com/static/codelabs/health-connect/img/ff523ee39aeadd8e_36.png?hl=ja 36w,https://developer.android.com/static/codelabs/health-connect/img/ff523ee39aeadd8e_48.png?hl=ja 48w,https://developer.android.com/static/codelabs/health-connect/img/ff523ee39aeadd8e_72.png?hl=ja 72w,https://developer.android.com/static/codelabs/health-connect/img/ff523ee39aeadd8e_96.png?hl=ja 96w,https://developer.android.com/static/codelabs/health-connect/img/ff523ee39aeadd8e_480.png?hl=ja 480w,https://developer.android.com/static/codelabs/health-connect/img/ff523ee39aeadd8e_720.png?hl=ja 720w,https://developer.android.com/static/codelabs/health-connect/img/ff523ee39aeadd8e_856.png?hl=ja 856w,https://developer.android.com/static/codelabs/health-connect/img/ff523ee39aeadd8e_960.png?hl=ja 960w,https://developer.android.com/static/codelabs/health-connect/img/ff523ee39aeadd8e_1440.png?hl=ja 1440w,https://developer.android.com/static/codelabs/health-connect/img/ff523ee39aeadd8e_1920.png?hl=ja 1920w,https://developer.android.com/static/codelabs/health-connect/img/ff523ee39aeadd8e_2880.png?hl=ja 2880w" style="width: 267.84px" /></p>
<p>ユーザーは、システム設定で <strong>[ヘルスコネクト] > [アプリの権限] > [Health Connect Codelab] > [アクセス権の追加] > [過去のデータへのアクセス]</strong> に移動して、過去のデータの読み取り権限を付与することもできます。</p>
<p class="image-container"><img alt="1ec187a6c63245b6.png" sizes="(max-width: 840px) 100vw, 856px" src="https://developer.android.com/static/codelabs/health-connect/img/1ec187a6c63245b6.png?hl=ja" srcset="https://developer.android.com/static/codelabs/health-connect/img/1ec187a6c63245b6_36.png?hl=ja 36w,https://developer.android.com/static/codelabs/health-connect/img/1ec187a6c63245b6_48.png?hl=ja 48w,https://developer.android.com/static/codelabs/health-connect/img/1ec187a6c63245b6_72.png?hl=ja 72w,https://developer.android.com/static/codelabs/health-connect/img/1ec187a6c63245b6_96.png?hl=ja 96w,https://developer.android.com/static/codelabs/health-connect/img/1ec187a6c63245b6_480.png?hl=ja 480w,https://developer.android.com/static/codelabs/health-connect/img/1ec187a6c63245b6_720.png?hl=ja 720w,https://developer.android.com/static/codelabs/health-connect/img/1ec187a6c63245b6_856.png?hl=ja 856w,https://developer.android.com/static/codelabs/health-connect/img/1ec187a6c63245b6_960.png?hl=ja 960w,https://developer.android.com/static/codelabs/health-connect/img/1ec187a6c63245b6_1440.png?hl=ja 1440w,https://developer.android.com/static/codelabs/health-connect/img/1ec187a6c63245b6_1920.png?hl=ja 1920w,https://developer.android.com/static/codelabs/health-connect/img/1ec187a6c63245b6_2880.png?hl=ja 2880w" style="width: 267.84px" /></p>
<h2 data-text="過去のデータを読み取る" id="read-historical-data" is-upgraded="" tabindex="-1"><strong>過去のデータを読み取る</strong></h2>
<p>過去のデータを読み取る権限が付与されると、[<strong>Exercise sessions</strong>] 画面に他のアプリの過去のデータが表示されます。</p>
<aside class="special"><p><strong>注</strong>: 他のアプリの過去のデータがデバイスに保存されていない場合は、<a href="https://developer.android.com/health-and-fitness/guides/health-connect/test/health-connect-toolbox?hl=ja" target="_blank">ヘルスコネクト ツールボックス</a>を使用して <strong>[INSERT HEALTH RECORD] > [Activity] > [ExerciseSession]</strong> に移動し、40 日前からのエクササイズ セッションを手動で追加します。</p>
</aside>


        </google-codelab-step>
      
        <google-codelab-step duration="8" step="7" label="差分データを読み取る">
          
          <h2 class="step-title" data-text="               8. 差分データを読み取る           " id="7" tabindex="-1">
              8. 差分データを読み取る
          </h2>
          <p>ヘルスコネクトの Differential Changes API は、一連のデータ型について、特定の時点からの変更を追跡するのに役立ちます。たとえば、ユーザーがアプリの外部で既存のレコードを更新または削除したかどうかを把握し、それに応じてデータベースを更新できます。</p>
<p>ヘルスコネクトでのデータの読み取りは、フォアグラウンドで実行されているアプリに制限されています。この制限は、ユーザーのプライバシー保護を強化するために設けられたものです。ヘルスコネクトにはデータのバックグラウンドでの読み取りアクセス権がなく、データの読み取りとアクセスはフォアグラウンドでのみ行えることがユーザーに通知され、保証されます。アプリがフォアグラウンドにあるとき、Differential Changes API を使用すると、デベロッパーは変更トークンをデプロイして、ヘルスコネクトに加えられた変更を取得できます。</p>
<p><code dir="ltr" translate="no">HealthConnectManager.kt</code> には <code dir="ltr" translate="no">getChangesToken()</code> と <code dir="ltr" translate="no">getChanges()</code> の 2 つの関数があります。これらの関数に Differential Changes API を追加して、データの変更を取得します。</p>
<h2 data-text="最初の変更トークンの設定" id="initial-changes-token-setup" is-upgraded="" tabindex="-1"><strong>最初の変更トークンの設定</strong></h2>
<p>ヘルスコネクトからデータの変更が取得されるのは、アプリが変更トークンでリクエストした場合のみです。変更トークンは、差分データの取得元となる commit 履歴内のポイントを表します。</p>
<p>変更トークンを取得するには、データの変更を追跡する一連のデータ型を指定して <code dir="ltr" translate="no">ChangesTokenRequest</code> を送信します。このトークンを保管しておき、ヘルスコネクトからアップデートを取得するときに使用します。</p>
<aside class="special"><p><strong>注</strong>: <code dir="ltr" translate="no">DeletionChanges</code> は、プライバシー上の理由から、削除されたレコードの <code dir="ltr" translate="no">id</code> のみを返します（<a href="https://developer.android.com/reference/kotlin/androidx/health/connect/client/HealthConnectClient?hl=ja#deleteRecords(kotlin.reflect.KClass,kotlin.collections.List,kotlin.collections.List)" target="_blank"><code dir="ltr" translate="no">deleteRecords</code></a> で使用されるレコードタイプは返されません）。これを処理するには、<code dir="ltr" translate="no">getChanges</code> の呼び出しごとに 1 つのデータ型のみを指定するか、この情報を事前に別々に保存しておきます。</p>
</aside>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Carbon"><code translate="no" dir="ltr"><span class="devsite-syntax-w">  </span><span class="devsite-syntax-cm">/**</span>
<span class="devsite-syntax-cm">   * TODO: Obtains a Changes token for the specified record types.</span>
<span class="devsite-syntax-cm">   */</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-nx">suspend</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nx">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nx">getChangesToken</span><span class="devsite-syntax-p">():</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nx">String</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nx">healthConnectClient</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-nx">getChangesToken</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-nx">ChangesTokenRequest</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-nx">setOf</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">          </span><span class="devsite-syntax-nx">ExerciseSessionRecord</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-kd">class</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<h2 data-text="変更トークンによるデータ更新" id="data-update-with-changes-token" is-upgraded="" tabindex="-1"><strong>変更トークンによるデータ更新</strong></h2>
<p>アプリがヘルスコネクトと最後に同期したときからの変更を取得するには、以前に取得した変更トークンを使用し、そのトークンを含む <code dir="ltr" translate="no">getChanges</code> 呼び出しを送信します。<code dir="ltr" translate="no">ChangesResponse</code> は、ヘルスコネクトで検出された変更（<a href="https://developer.android.com/reference/kotlin/androidx/health/connect/client/changes/UpsertionChange?hl=ja" target="_blank"><code dir="ltr" translate="no">UpsertionChange</code></a> や <a href="https://developer.android.com/reference/kotlin/androidx/health/connect/client/changes/DeletionChange?hl=ja" target="_blank"><code dir="ltr" translate="no">DeletionChange</code></a> など）のリストを返します。</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="GDScript"><code translate="no" dir="ltr"><span class="devsite-syntax-w">  </span><span class="devsite-syntax-o">/**</span>
<span class="devsite-syntax-w">   </span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">TODO</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Retrieve</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">changes</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">from</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">a</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Changes</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">token</span><span class="devsite-syntax-o">.</span>
<span class="devsite-syntax-w">   </span><span class="devsite-syntax-o">*/</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-n">suspend</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">getChanges</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">token</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb devsite-syntax-nb-Type">String</span><span class="devsite-syntax-p">):</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Flow&lt;ChangesMessage&gt;</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">flow</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">var</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">nextChangesToken</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">token</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">do</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">response</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">healthConnectClient</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">getChanges</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">nextChangesToken</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">response</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">changesTokenExpired</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">throw</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">IOException</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-s2">"Changes token has expired"</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">emit</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">ChangesMessage</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">ChangeList</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">response</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">changes</span><span class="devsite-syntax-p">))</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">nextChangesToken</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">response</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">nextChangesToken</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">while</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">response</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">hasMore</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">emit</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">ChangesMessage</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">NoMoreChanges</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">nextChangesToken</span><span class="devsite-syntax-p">))</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<aside class="special"><p><strong>注</strong>: 変更トークンの有効期限は 30 日間です。アプリを次のように設定してください。</p>
<ul>
<li>トークンが古くならないように、30 日以内の間隔でデータを定期更新し、変更を反映します。</li>
<li>トークンの有効期限が切れた場合に対処します。</li>
<li>必要なデータを取得するためのフォールバック メカニズムを組み込む必要があります。</li>
</ul>
</aside>
<aside class="warning"><p><strong>重要</strong>: 最初に返されたレスポンスだけでは、ヘルスコネクトに加えられたすべての変更を取得できないことがあります。その場合は追加の API 呼び出しを行い、残りの変更を取得する必要があります。</p>
</aside>
<p>次に、アプリを実行し、[<strong>Changes</strong>] 画面に移動します。まず、[<strong>Track changes</strong>] を有効にして、変更トークンを取得します。次に、ツールボックスまたは Codelab アプリから、体重またはエクササイズ セッションを挿入します。[<strong>Changes</strong>] 画面に戻り、[<strong>Get new changes</strong>] を選択します。アップサートの変更が表示されます。</p>
<p class="image-container"><img alt="f3aded8ae5487e9c.png" sizes="(max-width: 840px) 100vw, 856px" src="https://developer.android.com/static/codelabs/health-connect/img/f3aded8ae5487e9c.png?hl=ja" srcset="https://developer.android.com/static/codelabs/health-connect/img/f3aded8ae5487e9c_36.png?hl=ja 36w,https://developer.android.com/static/codelabs/health-connect/img/f3aded8ae5487e9c_48.png?hl=ja 48w,https://developer.android.com/static/codelabs/health-connect/img/f3aded8ae5487e9c_72.png?hl=ja 72w,https://developer.android.com/static/codelabs/health-connect/img/f3aded8ae5487e9c_96.png?hl=ja 96w,https://developer.android.com/static/codelabs/health-connect/img/f3aded8ae5487e9c_480.png?hl=ja 480w,https://developer.android.com/static/codelabs/health-connect/img/f3aded8ae5487e9c_720.png?hl=ja 720w,https://developer.android.com/static/codelabs/health-connect/img/f3aded8ae5487e9c_856.png?hl=ja 856w,https://developer.android.com/static/codelabs/health-connect/img/f3aded8ae5487e9c_960.png?hl=ja 960w,https://developer.android.com/static/codelabs/health-connect/img/f3aded8ae5487e9c_1440.png?hl=ja 1440w,https://developer.android.com/static/codelabs/health-connect/img/f3aded8ae5487e9c_1920.png?hl=ja 1920w,https://developer.android.com/static/codelabs/health-connect/img/f3aded8ae5487e9c_2880.png?hl=ja 2880w" style="width: 286.50px" />         <img alt="437d69e3e000ce81.png" sizes="(max-width: 840px) 100vw, 856px" src="https://developer.android.com/static/codelabs/health-connect/img/437d69e3e000ce81.png?hl=ja" srcset="https://developer.android.com/static/codelabs/health-connect/img/437d69e3e000ce81_36.png?hl=ja 36w,https://developer.android.com/static/codelabs/health-connect/img/437d69e3e000ce81_48.png?hl=ja 48w,https://developer.android.com/static/codelabs/health-connect/img/437d69e3e000ce81_72.png?hl=ja 72w,https://developer.android.com/static/codelabs/health-connect/img/437d69e3e000ce81_96.png?hl=ja 96w,https://developer.android.com/static/codelabs/health-connect/img/437d69e3e000ce81_480.png?hl=ja 480w,https://developer.android.com/static/codelabs/health-connect/img/437d69e3e000ce81_720.png?hl=ja 720w,https://developer.android.com/static/codelabs/health-connect/img/437d69e3e000ce81_856.png?hl=ja 856w,https://developer.android.com/static/codelabs/health-connect/img/437d69e3e000ce81_960.png?hl=ja 960w,https://developer.android.com/static/codelabs/health-connect/img/437d69e3e000ce81_1440.png?hl=ja 1440w,https://developer.android.com/static/codelabs/health-connect/img/437d69e3e000ce81_1920.png?hl=ja 1920w,https://developer.android.com/static/codelabs/health-connect/img/437d69e3e000ce81_2880.png?hl=ja 2880w" style="width: 274.50px" /></p>


        </google-codelab-step>
      
        <google-codelab-step duration="8" step="8" label="集計データ">
          
          <h2 class="step-title" data-text="               9. 集計データ           " id="8" tabindex="-1">
              9. 集計データ
          </h2>
          <p>ヘルスコネクトは、集計 API を介して集計データも提供します。次の例は、ヘルスコネクトから累積データと統計データを取得する方法を示しています。</p>
<p><code dir="ltr" translate="no">healthConnectClient.aggregate</code> を使用して <code dir="ltr" translate="no">AggregateRequest</code> を送信します。集計リクエストで、一連の集計指標と取得する時間範囲を指定します。たとえば、<code dir="ltr" translate="no">ExerciseSessionRecord.EXERCISE_DURATION_TOTAL</code> と <code dir="ltr" translate="no">StepsRecord.COUNT_TOTAL</code> は累積データ、<code dir="ltr" translate="no">WeightRecord.WEIGHT_AVG</code>、<code dir="ltr" translate="no">HeartRateRecord.BPM_MAX</code>、<code dir="ltr" translate="no">HeartRateRecord.BPM_MIN</code> は統計データを提供します。</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Transact-SQL"><code translate="no" dir="ltr"><span class="devsite-syntax-w">    </span><span class="devsite-syntax-cm">/**</span>
<span class="devsite-syntax-cm">     * TODO: Returns the weekly average of [WeightRecord]s.</span>
<span class="devsite-syntax-cm">     */</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">suspend</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">computeWeeklyAverage</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-k">start</span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Instant</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">end</span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Instant</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Mass</span><span class="devsite-syntax-vm">?</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">request</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">AggregateRequest</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">metrics</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">setOf</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">WeightRecord</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">WEIGHT_AVG</span><span class="devsite-syntax-p">),</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">timeRangeFilter</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">TimeRangeFilter</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-ow">between</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-k">start</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">end</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">response</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">healthConnectClient</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-k">aggregate</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">request</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">response</span><span class="devsite-syntax-o">[</span><span class="devsite-syntax-n">WeightRecord.WEIGHT_AVG</span><span class="devsite-syntax-o">]</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-err">}</span>
</code></pre></devsite-code>
<p>この例では、特定のエクササイズ セッションの関連集計データを取得する方法を示します。まず、<code dir="ltr" translate="no">uid</code> で <code dir="ltr" translate="no">healthConnectClient.readRecord</code> を使用してレコードを読み取ります。次に、エクササイズ セッションの <code dir="ltr" translate="no">startTime</code> と <code dir="ltr" translate="no">endTime</code> を時間範囲、<code dir="ltr" translate="no">dataOrigin</code> をフィルタとして使用し、関連集計データを読み取ります。</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Transact-SQL"><code translate="no" dir="ltr"><span class="devsite-syntax-w">  </span><span class="devsite-syntax-cm">/**</span>
<span class="devsite-syntax-cm">   * TODO: Reads aggregated data and raw data for selected data types, for a given [ExerciseSessionRecord].</span>
<span class="devsite-syntax-cm">   */</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-n">suspend</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">readAssociatedSessionData</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-nl">uid</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">String</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ExerciseSessionData</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">exerciseSession</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">healthConnectClient</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">readRecord</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-nl">ExerciseSessionRecord</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-k">class</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">uid</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">Use</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">start</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">time</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-ow">and</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">end</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">time</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">from</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">session</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">for</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">reading</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">raw</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-ow">and</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">aggregate</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">data</span><span class="devsite-syntax-p">.</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">timeRangeFilter</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">TimeRangeFilter</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-ow">between</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">startTime</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">exerciseSession</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">record</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">startTime</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">endTime</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">exerciseSession</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">record</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">endTime</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">aggregateDataTypes</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">setOf</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">ExerciseSessionRecord</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">EXERCISE_DURATION_TOTAL</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">StepsRecord</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">COUNT_TOTAL</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">TotalCaloriesBurnedRecord</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">ENERGY_TOTAL</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">HeartRateRecord</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">BPM_AVG</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">HeartRateRecord</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">BPM_MAX</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">HeartRateRecord</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">BPM_MIN</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">Limit</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">data</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">read</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">to</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">just</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">application</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">that</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">wrote</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">session</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">This</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">may</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-ow">or</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">may</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-ow">not</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">be</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">desirable</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">depending</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">on</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">use</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">case</span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-ow">In</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-ow">some</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">cases</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">it</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">may</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">be</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">useful</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">to</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">combine</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">with</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">data</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">written</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">by</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">other</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">apps</span><span class="devsite-syntax-p">.</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">dataOriginFilter</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">setOf</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">exerciseSession</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">record</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">metadata</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">dataOrigin</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">aggregateRequest</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">AggregateRequest</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">metrics</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">aggregateDataTypes</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">timeRangeFilter</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">timeRangeFilter</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">dataOriginFilter</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">dataOriginFilter</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">aggregateData</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">healthConnectClient</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-k">aggregate</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">aggregateRequest</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">heartRateData</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">readData&lt;HeartRateRecord&gt;</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">timeRangeFilter</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">dataOriginFilter</span><span class="devsite-syntax-p">)</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ExerciseSessionData</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">uid</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">uid</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">totalActiveTime</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">aggregateData</span><span class="devsite-syntax-o">[</span><span class="devsite-syntax-n">ExerciseSessionRecord.EXERCISE_DURATION_TOTAL</span><span class="devsite-syntax-o">]</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">totalSteps</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">aggregateData</span><span class="devsite-syntax-o">[</span><span class="devsite-syntax-n">StepsRecord.COUNT_TOTAL</span><span class="devsite-syntax-o">]</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">totalEnergyBurned</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">aggregateData</span><span class="devsite-syntax-o">[</span><span class="devsite-syntax-n">TotalCaloriesBurnedRecord.ENERGY_TOTAL</span><span class="devsite-syntax-o">]</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">minHeartRate</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">aggregateData</span><span class="devsite-syntax-o">[</span><span class="devsite-syntax-n">HeartRateRecord.BPM_MIN</span><span class="devsite-syntax-o">]</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">maxHeartRate</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">aggregateData</span><span class="devsite-syntax-o">[</span><span class="devsite-syntax-n">HeartRateRecord.BPM_MAX</span><span class="devsite-syntax-o">]</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">avgHeartRate</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">aggregateData</span><span class="devsite-syntax-o">[</span><span class="devsite-syntax-n">HeartRateRecord.BPM_AVG</span><span class="devsite-syntax-o">]</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">heartRateSeries</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">heartRateData</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-err">}</span>
</code></pre></devsite-code>
<p>次に、アプリを実行して、[<strong>Record weight</strong>] 画面に平均体重が表示されるかどうかを確認します。また、エクササイズ セッションの詳細なデータを表示するには、[<strong>Exercise sessions</strong>] 画面を開き、エクササイズ セッションのレコードのいずれかを選択します。</p>
<p class="image-container"><img alt="af1fe646159d6a60.png" sizes="(max-width: 840px) 100vw, 856px" src="https://developer.android.com/static/codelabs/health-connect/img/af1fe646159d6a60.png?hl=ja" srcset="https://developer.android.com/static/codelabs/health-connect/img/af1fe646159d6a60_36.png?hl=ja 36w,https://developer.android.com/static/codelabs/health-connect/img/af1fe646159d6a60_48.png?hl=ja 48w,https://developer.android.com/static/codelabs/health-connect/img/af1fe646159d6a60_72.png?hl=ja 72w,https://developer.android.com/static/codelabs/health-connect/img/af1fe646159d6a60_96.png?hl=ja 96w,https://developer.android.com/static/codelabs/health-connect/img/af1fe646159d6a60_480.png?hl=ja 480w,https://developer.android.com/static/codelabs/health-connect/img/af1fe646159d6a60_720.png?hl=ja 720w,https://developer.android.com/static/codelabs/health-connect/img/af1fe646159d6a60_856.png?hl=ja 856w,https://developer.android.com/static/codelabs/health-connect/img/af1fe646159d6a60_960.png?hl=ja 960w,https://developer.android.com/static/codelabs/health-connect/img/af1fe646159d6a60_1440.png?hl=ja 1440w,https://developer.android.com/static/codelabs/health-connect/img/af1fe646159d6a60_1920.png?hl=ja 1920w,https://developer.android.com/static/codelabs/health-connect/img/af1fe646159d6a60_2880.png?hl=ja 2880w" style="width: 250.27px" /></p>


        </google-codelab-step>
      
        <google-codelab-step duration="2" step="9" label="完了">
          
          <h2 class="step-title" data-text="               10. 完了           " id="9" tabindex="-1">
              10. 完了
          </h2>
          <p>これで、ヘルスコネクトと統合された健康＆フィットネス アプリを初めて構築できました。</p>
<p>アプリは、権限を宣言し、アプリで使用されているデータ型に関するユーザー権限をリクエストできます。ヘルスコネクトのデータ ストレージに対して、データの読み取りと書き込みを行うこともできます。また、ヘルスコネクト ツールボックスを使用して、ヘルスコネクトのデータ ストレージにモックデータを作成し、アプリ開発をサポートする方法も学びました。</p>
<p>これで、健康＆フィットネス アプリをヘルスコネクト エコシステムに組み込むために必要な主な手順を学習できました。</p>
<h2 data-text="参考資料" id="further-reading" is-upgraded="" tabindex="-1"><strong>参考資料</strong></h2>
<ul>
<li><a href="https://developer.android.com/guide/health-and-fitness/health-connect?hl=ja" target="_blank">ヘルスコネクトのデベロッパー サイト</a></li>
<li><a href="https://support.google.com/googleplay/android-developer/answer/12991134?hl=ja" target="_blank">ヘルスコネクトのポリシー要件</a></li>
<li><a href="https://developer.android.com/guide/health-and-fitness/health-connect-guidelines/ux-guidelines/basic-guidance?hl=ja" target="_blank">ヘルスコネクトの UX デベロッパー向けガイドライン</a></li>
<li><a href="https://developer.android.com/health-and-fitness/guides/health-connect/test/health-connect-toolbox?hl=ja" target="_blank">ヘルスコネクト ツールボックス</a></li>
<li><a href="https://developer.android.com/kotlin?hl=ja" target="_blank">Kotlin</a></li>
<li><a href="https://developer.android.com/jetpack?hl=ja" target="_blank">Android Jetpack</a></li>
<li><a href="https://developer.android.com/jetpack/compose?hl=ja" target="_blank">Android Jetpack Compose</a></li>
<li><a href="https://developer.android.com/topic/libraries/architecture/viewmodel?gclid=CjwKCAjwzY2bBhB6EiwAPpUpZnMf553e5aMStvOi0XQNjG88yCjem3cuLDjbxhL5FiVMAROYM3ACPxoC8HcQAvD_BwE&gclsrc=aw.ds&hl=ja" target="_blank">Android Jetpack - ViewModel</a></li>
</ul>


        </google-codelab-step>
      
    </google-codelab>
  
  
  

  
</div>

  
    
    
    
  

  <div class="devsite-floating-action-buttons"></div></article>


<devsite-content-footer class="nocontent">
  <p>特に記載のない限り、このページのコンテンツは<a href="https://creativecommons.org/licenses/by/4.0/">クリエイティブ・コモンズの表示 4.0 ライセンス</a>により使用許諾されます。コードサンプルは <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 ライセンス</a>により使用許諾されます。詳しくは、<a href="https://developers.google.com/site-policies?hl=ja">Google Developers サイトのポリシー</a>をご覧ください。Java は Oracle および関連会社の登録商標です。</p>
  
</devsite-content-footer>


<devsite-notification
>
</devsite-notification>


  
<div class="devsite-content-data">
  
  
    <template class="devsite-content-data-template">
      [[["わかりやすい","easyToUnderstand","thumb-up"],["問題の解決に役立った","solvedMyProblem","thumb-up"],["その他","otherUp","thumb-up"]],[["必要な情報がない","missingTheInformationINeed","thumb-down"],["複雑すぎる / 手順が多すぎる","tooComplicatedTooManySteps","thumb-down"],["最新ではない","outOfDate","thumb-down"],["翻訳に関する問題","translationIssue","thumb-down"],["サンプル / コードに問題がある","samplesCodeIssue","thumb-down"],["その他","otherDown","thumb-down"]],[],[],[],null,[]]
    </template>
  
</div>
            
          </devsite-content>
        </main>
        <devsite-footer-promos class="devsite-footer">
          
            

<nav class="devsite-footer-promos nocontent" aria-label="プロモーション">
  <ul class="devsite-footer-promos-list">
    
    <li class="devsite-footer-promo">
      <a href="//x.com/AndroidDev"
         class="devsite-footer-promo-title gc-analytics-event"
         data-category="Site-Wide Custom Events"
       
       
         data-label="Footer X Promo"
       >
        
        
        <picture>
          
          <source class="devsite-dark-theme"
                  srcset="https://developer.android.com/_static/android/images/logo-x_dt.svg?hl=ja"
                  media="(prefers-color-scheme: dark)">
          
          <img class="devsite-footer-promo-icon"
                src="https://developer.android.com/_static/android/images/logo-x.svg?hl=ja"
                loading="lazy"
                alt="X">
        </picture>
        
        <span class="devsite-footer-promo-label">
          X
        </span>
      </a>
      <div class="devsite-footer-promo-description">@AndroidDev を X でフォロー</div>
    </li>
    
    <li class="devsite-footer-promo">
      <a href="//www.youtube.com/user/androiddevelopers?hl=ja"
         class="devsite-footer-promo-title gc-analytics-event"
         data-category="Site-Wide Custom Events"
       
       
         data-label="Footer YouTube Promo"
       >
        
        
        <picture>
          
          <source class="devsite-dark-theme"
                  srcset="https://developer.android.com/_static/android/images/logo-youtube_dt.svg?hl=ja"
                  media="(prefers-color-scheme: dark)">
          
          <img class="devsite-footer-promo-icon"
                src="//www.gstatic.com/images/icons/material/product/2x/youtube_48dp.png"
                loading="lazy"
                alt="YouTube">
        </picture>
        
        <span class="devsite-footer-promo-label">
          YouTube
        </span>
      </a>
      <div class="devsite-footer-promo-description">Android デベロッパーを YouTube でチェック</div>
    </li>
    
    <li class="devsite-footer-promo">
      <a href="//www.linkedin.com/showcase/androiddev"
         class="devsite-footer-promo-title gc-analytics-event"
         data-category="Site-Wide Custom Events"
       
       
         data-label="Footer LinkedIn Promo"
       >
        
        
        <picture>
          
          <source class="devsite-dark-theme"
                  srcset="https://developer.android.com/_static/android/images/logo-linkedin_dt.svg?hl=ja"
                  media="(prefers-color-scheme: dark)">
          
          <img class="devsite-footer-promo-icon"
                src="https://developer.android.com/_static/android/images/logo-linkedin.svg?hl=ja"
                loading="lazy"
                alt="LinkedIn">
        </picture>
        
        <span class="devsite-footer-promo-label">
          LinkedIn
        </span>
      </a>
      <div class="devsite-footer-promo-description">Connect with the Android Developers community on LinkedIn</div>
    </li>
    
  </ul>
</nav>

          
        </devsite-footer-promos>
        <devsite-footer-linkboxes class="devsite-footer">
          
            
<nav class="devsite-footer-linkboxes nocontent" aria-label="フッターのリンク">
  
  <ul class="devsite-footer-linkboxes-list">
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">Android の詳細</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//www.android.com"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 1)"
            >
            
          
            Android
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//www.android.com/enterprise/"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 2)"
            >
            
          
            エンタープライズ向け Android
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//www.android.com/security-center/"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 3)"
            >
            
          
            セキュリティ
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//source.android.com"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 4)"
            >
            
          
            ソース
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/news"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 5)"
            >
            
          
            ニュース
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//android-developers.googleblog.com/"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 6)"
            >
            
          
            ブログ
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/podcasts"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 7)"
            >
            
              
              
            
          
            ポッドキャスト
          
          </a>
          
          
        </li>
        
      </ul>
    </li>
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">探索</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/games"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 1)"
            >
            
          
            ゲーム
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/ml"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 2)"
            >
            
          
            機械学習
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/health-and-fitness"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 3)"
            >
            
          
            健康＆フィットネス
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/media"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 4)"
            >
            
          
            カメラ＆メディア
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/privacy"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 5)"
            >
            
          
            プライバシー
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/training/connectivity/5g"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 6)"
            >
            
              
              
            
          
            5G
          
          </a>
          
          
        </li>
        
      </ul>
    </li>
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">Android デバイス</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/large-screens"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 1)"
            >
            
          
            大画面
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/wear"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 2)"
            >
            
          
            Wear OS
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/chrome-os"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 3)"
            >
            
          
            ChromeOS デバイス
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/cars"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 4)"
            >
            
          
            自動車向け Android
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/tv"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 5)"
            >
            
              
              
            
          
            Android TV
          
          </a>
          
          
        </li>
        
      </ul>
    </li>
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">リリース</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/about/versions/15"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 1)"
            >
            
          
            Android 15
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/about/versions/14"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 2)"
            >
            
          
            Android 14
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/about/versions/13"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 3)"
            >
            
          
            Android 13
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/about/versions/12"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 4)"
            >
            
          
            Android 12
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/about/versions/11"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 5)"
            >
            
          
            Android 11
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/about/versions/10"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 6)"
            >
            
          
            Android 10
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/about/versions/pie"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 7)"
            >
            
              
              
            
          
            Pie
          
          </a>
          
          
        </li>
        
      </ul>
    </li>
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">ドキュメントとダウンロード</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/studio/intro"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 1)"
            >
            
          
            Android Studio ガイド
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/guide"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 2)"
            >
            
          
            デベロッパー ガイド
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/reference"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 3)"
            >
            
          
            API リファレンス
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/studio"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 4)"
            >
            
          
            Studio をダウンロード
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/ndk"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 5)"
            >
            
              
              
            
          
            Android NDK
          
          </a>
          
          
        </li>
        
      </ul>
    </li>
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">サポート</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//issuetracker.google.com/issues/new?component=190923&amp;template=841312"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 1)"
            >
            
          
            プラットフォームのバグを報告
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//issuetracker.google.com/issues/new?component=192697"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 2)"
            >
            
          
            ドキュメントのバグを報告
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//support.google.com/googleplay/android-developer"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 3)"
            >
            
          
            Google Play support
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="https://g.co/userresearch/androiddeveloperfooter"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 4)"
            >
            
              
              
            
          
            調査に参加
          
          </a>
          
          
        </li>
        
      </ul>
    </li>
    
  </ul>
  
</nav>
          
        </devsite-footer-linkboxes>
        <devsite-footer-utility class="devsite-footer">
          
            

<div class="devsite-footer-utility nocontent">
  
  
  <nav class="devsite-footer-sites" aria-label="Google Developers のその他のウェブサイト">
    <a href="https://developers.google.com/?hl=ja"
       class="devsite-footer-sites-logo-link gc-analytics-event"
       data-category="Site-Wide Custom Events"
       data-label="Footer Google Developers Link">
      <picture>
        
        <source srcset="https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/images/lockup-google-for-developers-dark-theme.svg"
                media="(prefers-color-scheme: none)"
                class="devsite-dark-theme">
        
        <img class="devsite-footer-sites-logo"
             src="https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/images/lockup-google-for-developers.svg"
             loading="lazy"
             alt="Google Developers">
      </picture>
    </a>
    <ul class="devsite-footer-sites-list">
      
      <li class="devsite-footer-sites-item">
        <a href="//developer.android.com?hl=ja"
           class="devsite-footer-sites-link
                  gc-analytics-event"
           data-category="Site-Wide Custom Events"
         
           data-label="Footer Android Link"
         
         >
          Android
        </a>
      </li>
      
      <li class="devsite-footer-sites-item">
        <a href="//developer.chrome.com/home?hl=ja"
           class="devsite-footer-sites-link
                  gc-analytics-event"
           data-category="Site-Wide Custom Events"
         
           data-label="Footer Chrome Link"
         
         >
          Chrome
        </a>
      </li>
      
      <li class="devsite-footer-sites-item">
        <a href="//firebase.google.com?hl=ja"
           class="devsite-footer-sites-link
                  gc-analytics-event"
           data-category="Site-Wide Custom Events"
         
           data-label="Footer Firebase Link"
         
         >
          Firebase
        </a>
      </li>
      
      <li class="devsite-footer-sites-item">
        <a href="//cloud.google.com?hl=ja"
           class="devsite-footer-sites-link
                  gc-analytics-event"
           data-category="Site-Wide Custom Events"
         
           data-label="Footer Google Cloud Platform Link"
         
         >
          Google Cloud Platform
        </a>
      </li>
      
      <li class="devsite-footer-sites-item">
        <a href="//developers.google.com/products/?hl=ja"
           class="devsite-footer-sites-link
                  gc-analytics-event"
           data-category="Site-Wide Custom Events"
         
           data-label="Footer All products Link"
         
         >
          すべてのプロダクト
        </a>
      </li>
      
    </ul>
  </nav>
  

  
  <nav class="devsite-footer-utility-links" aria-label="ユーティリティのリンク">
    
    <ul class="devsite-footer-utility-list">
      
      <li class="devsite-footer-utility-item
                 ">
        
        
        <a class="devsite-footer-utility-link gc-analytics-event"
           href="//policies.google.com/privacy?hl=ja"
           data-category="Site-Wide Custom Events"
           data-label="Footer Privacy link"
         >
          プライバシー
        </a>
        
      </li>
      
      <li class="devsite-footer-utility-item
                 ">
        
        
        <a class="devsite-footer-utility-link gc-analytics-event"
           href="https://developer.android.com/license?hl=ja"
           data-category="Site-Wide Custom Events"
           data-label="Footer License link"
         >
          ライセンス
        </a>
        
      </li>
      
      <li class="devsite-footer-utility-item
                 ">
        
        
        <a class="devsite-footer-utility-link gc-analytics-event"
           href="https://developer.android.com/distribute/marketing-tools/brand-guidelines?hl=ja"
           data-category="Site-Wide Custom Events"
           data-label="Footer Brand guidelines link"
         >
          ブランドの取り扱いガイドライン
        </a>
        
      </li>
      
      <li class="devsite-footer-utility-item
                 glue-cookie-notification-bar-control">
        
        
        <a class="devsite-footer-utility-link gc-analytics-event"
           href="#"
           data-category="Site-Wide Custom Events"
           data-label="Footer Manage cookies link"
         
           aria-hidden="true"
         >
          Manage cookies
        </a>
        
      </li>
      
      <li class="devsite-footer-utility-item
                 devsite-footer-utility-button">
        
        <span class="devsite-footer-utility-description">ニュースやヒントをメールで受け取る</span>
        
        
        <a class="devsite-footer-utility-link gc-analytics-event"
           href="https://developer.android.com/updates?hl=ja"
           data-category="Site-Wide Custom Events"
           data-label="Footer Subscribe link"
         >
          購読
        </a>
        
      </li>
      
    </ul>
    
    
<devsite-language-selector>
  <ul role="presentation">
    
    
    <li role="presentation">
      <a role="menuitem" lang="en"
        >English</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="de"
        >Deutsch</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="es_419"
        >Español – América Latina</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="fr"
        >Français</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="id"
        >Indonesia</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="pl"
        >Polski</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="pt_br"
        >Português – Brasil</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="vi"
        >Tiếng Việt</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="zh_cn"
        >中文 – 简体</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="zh_tw"
        >中文 – 繁體</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="ja"
        >日本語</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="ko"
        >한국어</a>
    </li>
    
  </ul>
</devsite-language-selector>

  </nav>
</div>
          
        </devsite-footer-utility>
        <devsite-panel>
          
        </devsite-panel>
        
      </section></section>
    <devsite-sitemask></devsite-sitemask>
    <devsite-snackbar></devsite-snackbar>
    <devsite-tooltip ></devsite-tooltip>
    <devsite-heading-link></devsite-heading-link>
    <devsite-analytics>
      
        <script type="application/json" analytics>[]</script>
<script type="application/json" tag-management>{&#34;at&#34;: &#34;True&#34;, &#34;ga4&#34;: [{&#34;id&#34;: &#34;G-QFRN08RN6E&#34;, &#34;purpose&#34;: 0}], &#34;ga4p&#34;: [{&#34;id&#34;: &#34;G-QFRN08RN6E&#34;, &#34;purpose&#34;: 0}], &#34;gtm&#34;: [], &#34;parameters&#34;: {&#34;internalUser&#34;: &#34;False&#34;, &#34;language&#34;: {&#34;machineTranslated&#34;: &#34;False&#34;, &#34;requested&#34;: &#34;ja&#34;, &#34;served&#34;: &#34;ja&#34;}, &#34;pageType&#34;: &#34;codelab&#34;, &#34;projectName&#34;: null, &#34;signedIn&#34;: &#34;False&#34;, &#34;tenant&#34;: &#34;android&#34;, &#34;recommendations&#34;: {&#34;sourcePage&#34;: &#34;&#34;, &#34;sourceType&#34;: 0, &#34;sourceRank&#34;: 0, &#34;sourceIdenticalDescriptions&#34;: 0, &#34;sourceTitleWords&#34;: 0, &#34;sourceDescriptionWords&#34;: 0, &#34;experiment&#34;: &#34;&#34;}, &#34;experiment&#34;: {&#34;ids&#34;: &#34;&#34;}}}</script>
      
    </devsite-analytics>
    
      <devsite-badger></devsite-badger>
    
    
    
<android-fully-clickable
    target="
        .android-case-study .devsite-landing-row-item,
        .android-editorial-and-updates-cards .devsite-card-content-wrapper,
        .android-editorial-and-updates-cards .devsite-landing-row-item,
        .android-grouped-resources .devsite-landing-row-item,
        .android-grouped-resources-contained--primary .devsite-landing-row-item,
        .android-grouped-resources-contained--secondary .devsite-landing-row-item,
        .android-grouped-resources-contained--tertiary .devsite-landing-row-item,
        .android-grouped-resources-uncontained--primary .devsite-landing-row-item,
        .android-grouped-resources-uncontained--secondary .devsite-landing-row-item,
        .android-grouped-resources-uncontained--tertiary .devsite-landing-row-item,
        .android-guide-cards .devsite-landing-row-item,
        .android-illustrated-resources-index .devsite-landing-row-item,
        .android-illustrated-resources-primary .devsite-landing-row-item,
        .android-illustrated-resources-secondary .devsite-landing-row-item,
        .android-illustrated-resources-secondary-small .devsite-landing-row-item,
        .android-illustrated-resources-tertiary .devsite-landing-row-item,
        .android-illustrated-resources-tertiary-small .devsite-landing-row-item,
        .android-promo .devsite-landing-row-item,
        .android-quick-link,
        .android-samples .devsite-card-wrapper,
        .fully-clickable"
    watch=".android-editorial-and-updates-cards, .android-samples, devsite-content"></android-fully-clickable>
    
<script nonce="/iLR12eB2S4Aa4PSOlYk5WVf/aJBcQ">
  
  (function(d,e,v,s,i,t,E){d['GoogleDevelopersObject']=i;
    t=e.createElement(v);t.async=1;t.src=s;E=e.getElementsByTagName(v)[0];
    E.parentNode.insertBefore(t,E);})(window, document, 'script',
    'https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/js/app_loader.js', '[3,"ja",null,"/js/devsite_app_module.js","https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9","https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android","https://android-dot-devsite-v2-prod.appspot.com",1,null,["/_pwa/android/manifest.json","https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/images/video-placeholder.svg","https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/images/favicon.svg","https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/images/lockup.png","https://fonts.googleapis.com/css?family=Google+Sans:400,500,600,700|Google+Sans+Text:400,400italic,500,500italic,600,600italic,700,700italic|Roboto+Mono:400,500,700&display=swap"],1,null,[1,6,8,12,14,17,21,25,50,52,63,70,75,76,80,87,91,92,93,97,98,100,101,102,103,104,105,107,108,109,110,112,113,116,117,118,120,122,124,125,126,127,129,130,131,132,133,134,135,136,138,140,141,147,148,149,151,152,156,157,158,159,161,163,164,168,169,170,179,180,182,183,186,191,193,196],"AIzaSyAP-jjEJBzmIyKR4F-3XITp8yM9T1gEEI8","AIzaSyB6xiKGDR5O3Ak2okS4rLkauxGUG7XP0hg","developer.android.com","AIzaSyAQk0fBONSGUqCNznf6Krs82Ap1-NV6J4o","AIzaSyCCxcqdrZ_7QMeLCRY20bh_SXdAYqy70KY",null,null,null,["DevPro__enable_google_one_card","DevPro__enable_vertex_credit_card","TpcFeatures__enable_unmirrored_page_left_nav","Profiles__enable_stripe_subscription_management","Cloud__enable_cloud_shell_fte_user_flow","MiscFeatureFlags__enable_variable_operator_index_yaml","Cloud__enable_cloud_dlp_service","Profiles__enable_page_saving","Profiles__enable_playlist_community_acl","Profiles__enable_user_type","Profiles__enable_developer_profiles_callout","CloudShell__cloud_shell_button","Cloud__fast_free_trial","MiscFeatureFlags__developers_footer_dark_image","Search__enable_suggestions_from_borg","Profiles__enable_callout_notifications","MiscFeatureFlags__developers_footer_image","Profiles__enable_awarding_url","DevPro__enable_free_benefits","Profiles__enable_completequiz_endpoint","BookNav__enable_tenant_cache_key","Profiles__enable_public_developer_profiles","Profiles__enable_dashboard_curated_recommendations","MiscFeatureFlags__gdp_dashboard_reskin_enabled","Profiles__enable_developer_profile_benefits_ui_redesign","DevPro__enable_cloud_innovators_plus","Cloud__enable_cloudx_experiment_ids","Concierge__enable_actions_menu","Profiles__enable_release_notes_notifications","Cloud__enable_llm_concierge_chat","MiscFeatureFlags__emergency_css","Profiles__enable_recognition_badges","Profiles__enable_completecodelab_endpoint","DevPro__remove_eu_tax_intake_form","Profiles__require_profile_eligibility_for_signin","DevPro__enable_firebase_workspaces_card","Analytics__enable_clearcut_logging","DevPro__enable_embed_profile_creation","Profiles__enable_complete_playlist_endpoint","Concierge__enable_remove_info_panel_tags","DevPro__enable_devpro_offers","DevPro__enable_enterprise","Search__enable_page_map","Profiles__enable_profile_collections","MiscFeatureFlags__enable_dark_theme","Concierge__enable_pushui","DevPro__enable_google_payments_buyflow","MiscFeatureFlags__enable_explicit_template_dependencies","DevPro__enable_nvidia_credits_card","Profiles__enable_join_program_group_endpoint","Search__enable_ai_search_summaries_for_all","Search__enable_dynamic_content_confidential_banner","EngEduTelemetry__enable_engedu_telemetry","Profiles__enable_purchase_prompts","MiscFeatureFlags__enable_variable_operator","MiscFeatureFlags__enable_project_variables","Cloud__enable_free_trial_server_call","TpcFeatures__proxy_prod_host","Significatio__enable_by_tenant","MiscFeatureFlags__enable_project_body_class","MiscFeatureFlags__enable_framebox_badge_methods","Cloud__enable_cloud_shell","DevPro__enable_code_assist","MiscFeatureFlags__enable_view_transitions","Experiments__reqs_query_experiments","Search__enable_ai_eligibility_checks","Cloud__enable_legacy_calculator_redirect","DevPro__enable_developer_subscriptions","MiscFeatureFlags__enable_firebase_utm","Cloud__cache_serialized_dynamic_content","MiscFeatureFlags__enable_appearance_cookies","CloudShell__cloud_code_overflow_menu"],null,null,"AIzaSyBLEMok-5suZ67qRPzx0qUtbnLmyT_kCVE","https://developerscontentserving-pa.googleapis.com","AIzaSyCM4QpTRSqP5qI4Dvjt4OAScIN8sOUlO-k","https://developerscontentsearch-pa.googleapis.com",2,4,null,"https://developerprofiles-pa.googleapis.com",[3,"android","Android Developers","developer.android.com",null,"android-dot-devsite-v2-prod.appspot.com",null,null,[null,1,null,null,null,null,null,null,null,null,null,[1],null,null,null,null,null,null,[1],[1,null,null,[1,20],"/recommendations"],null,null,null,[1,null,1],[1,1,null,1,1]],null,[18,null,null,null,null,null,"/images/lockup.png","/images/touchicon-180.png",null,null,null,null,null,null,null,null,null,null,null,null,null,2,null,null,null,"/images/lockup-dark-theme.png",[]],[],null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,[6,1,14,15,20,22,23,28,29,37,43],null,[[null,null,1],[1,1]],[[null,null,null,null,null,null,null,[["G-QFRN08RN6E"],null,null,[["G-QFRN08RN6E",1]]],null,null,null,null,1],null,[[2,2],[1,1]]],null,4,null,null,null,null,null,null,null,null,null,null,null,null,null,"android.devsite.google"],null,"pk_live_5170syrHvgGVmSx9sBrnWtA5luvk9BwnVcvIi7HizpwauFG96WedXsuXh790rtij9AmGllqPtMLfhe2RSwD6Pn38V00uBCydV4m",1,null,"https://developerscontentinsights-pa.googleapis.com","AIzaSyCg-ZUslalsEbXMfIo9ZP8qufZgo3LSBDU","AIzaSyDxT0vkxnY_KeINtA4LSePJO-4MAZPMRsE","https://developers.googleapis.com",null,null,"AIzaSyBQom12tzI-rybN7Sf-KfeL4nwm-Rf7PmI\n",null,"https://developerslogging.googleapis.com"]')
  
</script>

    <devsite-a11y-announce></devsite-a11y-announce>
  </body>
</html>