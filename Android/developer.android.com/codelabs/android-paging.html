








<!doctype html>
<html 
      lang="en"
      dir="ltr">
  <head>
    <meta name="google-signin-client-id" content="721724668570-nbkv1cfusk7kk4eni4pjvepaus73b13t.apps.googleusercontent.com">
    <meta name="google-signin-scope"
          content="profile email https://www.googleapis.com/auth/developerprofiles https://www.googleapis.com/auth/developerprofiles.award">
    <meta property="og:site_name" content="Android Developers">
    <meta property="og:type" content="website"><meta name="theme-color" content="#34a853"><meta charset="utf-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    

    <link rel="manifest" href="/_pwa/android/manifest.json"
          crossorigin="use-credentials">
    <link rel="preconnect" href="//www.gstatic.com" crossorigin>
    <link rel="preconnect" href="//fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="//fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="//apis.google.com" crossorigin>
    <link rel="preconnect" href="//www.google-analytics.com" crossorigin><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Google+Sans:400,500,600,700|Google+Sans+Text:400,400italic,500,500italic,600,600italic,700,700italic|Roboto+Mono:400,500,700&display=swap">
      <link rel="stylesheet"
            href="//fonts.googleapis.com/css2?family=Material+Icons&family=Material+Symbols+Outlined&display=block"><link rel="stylesheet" href="https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/css/app.css">
      
        <link rel="stylesheet" href="https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/css/dark-theme.css" disabled>
      <link rel="shortcut icon" href="https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/images/favicon.svg">
    <link rel="apple-touch-icon" href="https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/images/touchicon-180.png"><link rel="canonical" href="https://developer.android.com/codelabs/android-paging"><link rel="search" type="application/opensearchdescription+xml"
            title="Android Developers" href="https://developer.android.com/s/opensearch.xml">
      <title>(Deprecated) Android Paging Advanced codelab &nbsp;|&nbsp; Android Developers</title>

<meta property="og:title" content="(Deprecated) Android Paging Advanced codelab &nbsp;|&nbsp; Android Developers"><meta name="description" content="In this codelab, you modify a sample app to incorporate the Paging Library, which reduces the app’s memory footprint.">
  <meta property="og:description" content="In this codelab, you modify a sample app to incorporate the Paging Library, which reduces the app’s memory footprint."><meta property="og:url" content="https://developer.android.com/codelabs/android-paging"><meta property="og:locale" content="en">
  
    
    
    
    
    
    
    
    
    
  

    
      <link rel="stylesheet" href="/extras.css"></head>
  <body class=""
        template="codelab"
        theme="android-theme"
        type="codelab"
        
        
        appearance
        
        layout="docs"
        
        
        
        
        display-toc
        pending>
  
    <devsite-progress type="indeterminate" id="app-progress"></devsite-progress>
  
  
    <a href="#main-content" class="skip-link button">
      
      Skip to main content
    </a>
    <section class="devsite-wrapper">
      <devsite-cookie-notification-bar></devsite-cookie-notification-bar><devsite-header role="banner">
  
    





















<div class="devsite-header--inner" data-nosnippet>
  <div class="devsite-top-logo-row-wrapper-wrapper">
    <div class="devsite-top-logo-row-wrapper">
      <div class="devsite-top-logo-row">
        <button type="button" id="devsite-hamburger-menu"
          class="devsite-header-icon-button button-flat material-icons gc-analytics-event"
          data-category="Site-Wide Custom Events"
          data-label="Navigation menu button"
          visually-hidden
          aria-label="Open menu">
        </button>
        
<div class="devsite-product-name-wrapper">

  <a href="/" class="devsite-site-logo-link gc-analytics-event"
   data-category="Site-Wide Custom Events" data-label="Site logo" track-type="globalNav"
   track-name="androidDevelopers" track-metadata-position="nav"
   track-metadata-eventDetail="nav">
  
  <picture>
    
    <source srcset="https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/images/lockup-dark-theme.png"
            media="(prefers-color-scheme: dark)"
            class="devsite-dark-theme">
    
    <img src="https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/images/lockup.png" class="devsite-site-logo" alt="Android Developers">
  </picture>
  
</a>



</div>
        <div class="devsite-top-logo-row-middle">
          <div class="devsite-header-upper-tabs">
            
           </div>
          
<devsite-search
    enable-signin
    enable-search
    enable-suggestions
      enable-query-completion
    
    enable-search-summaries
    
    tenant-name="Android Developers"
    
    
    
    
    
    >
  <form class="devsite-search-form" action="https://developer.android.com/s/results" method="GET">
    <div class="devsite-search-container">
      <button type="button"
              search-open
              class="devsite-search-button devsite-header-icon-button button-flat material-icons"
              
              aria-label="Open search"></button>
      <div class="devsite-searchbox">
        <input
          aria-activedescendant=""
          aria-autocomplete="list"
          
          aria-label="Search"
          aria-expanded="false"
          aria-haspopup="listbox"
          autocomplete="off"
          class="devsite-search-field devsite-search-query"
          name="q"
          
          placeholder="Search"
          role="combobox"
          type="text"
          value=""
          >
          <div class="devsite-search-image material-icons" aria-hidden="true">
            
              <svg class="devsite-search-ai-image" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <g clip-path="url(#clip0_6641_386)">
                    <path d="M19.6 21L13.3 14.7C12.8 15.1 12.225 15.4167 11.575 15.65C10.925 15.8833 10.2333 16 9.5 16C7.68333 16 6.14167 15.375 4.875 14.125C3.625 12.8583 3 11.3167 3 9.5C3 7.68333 3.625 6.15 4.875 4.9C6.14167 3.63333 7.68333 3 9.5 3C10.0167 3 10.5167 3.05833 11 3.175C11.4833 3.275 11.9417 3.43333 12.375 3.65L10.825 5.2C10.6083 5.13333 10.3917 5.08333 10.175 5.05C9.95833 5.01667 9.73333 5 9.5 5C8.25 5 7.18333 5.44167 6.3 6.325C5.43333 7.19167 5 8.25 5 9.5C5 10.75 5.43333 11.8167 6.3 12.7C7.18333 13.5667 8.25 14 9.5 14C10.6667 14 11.6667 13.625 12.5 12.875C13.35 12.1083 13.8417 11.15 13.975 10H15.975C15.925 10.6333 15.7833 11.2333 15.55 11.8C15.3333 12.3667 15.05 12.8667 14.7 13.3L21 19.6L19.6 21ZM17.5 12C17.5 10.4667 16.9667 9.16667 15.9 8.1C14.8333 7.03333 13.5333 6.5 12 6.5C13.5333 6.5 14.8333 5.96667 15.9 4.9C16.9667 3.83333 17.5 2.53333 17.5 0.999999C17.5 2.53333 18.0333 3.83333 19.1 4.9C20.1667 5.96667 21.4667 6.5 23 6.5C21.4667 6.5 20.1667 7.03333 19.1 8.1C18.0333 9.16667 17.5 10.4667 17.5 12Z" fill="#5F6368"/>
                  </g>
                <defs>
                <clipPath id="clip0_6641_386">
                <rect width="24" height="24" fill="white"/>
                </clipPath>
                </defs>
              </svg>
            
          </div>
          <div class="devsite-search-shortcut-icon-container" aria-hidden="true">
            <kbd class="devsite-search-shortcut-icon">/</kbd>
          </div>
      </div>
    </div>
  </form>
  <button type="button"
          search-close
          class="devsite-search-button devsite-header-icon-button button-flat material-icons"
          
          aria-label="Close search"></button>
</devsite-search>

        </div>

        

          

          

          <devsite-appearance-selector></devsite-appearance-selector>

          
<devsite-language-selector>
  <ul role="presentation">
    
    
    <li role="presentation">
      <a role="menuitem" lang="en"
        >English</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="de"
        >Deutsch</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="es_419"
        >Español – América Latina</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="fr"
        >Français</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="id"
        >Indonesia</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="pl"
        >Polski</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="pt_br"
        >Português – Brasil</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="vi"
        >Tiếng Việt</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="zh_cn"
        >中文 – 简体</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="ja"
        >日本語</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="ko"
        >한국어</a>
    </li>
    
  </ul>
</devsite-language-selector>


          
            <a class="devsite-header-link devsite-top-button button gc-analytics-event "
    href="https://developer.android.com/studio"
    data-category="Site-Wide Custom Events"
    data-label="Site header link: Android Studio"
    >
  Android Studio
</a>
          

        

        
          <devsite-user 
                        
                        
                          enable-profiles
                        
                        
                        id="devsite-user">
            
              
              <span class="button devsite-top-button" aria-hidden="true" visually-hidden>Sign in</span>
            
          </devsite-user>
        
        
        
      </div>
    </div>
  </div>



</div>



  
</devsite-header>
      <devsite-book-nav scrollbars hidden>
        
          





















<div class="devsite-book-nav-filter"
     hidden>
  <span class="filter-list-icon material-icons" aria-hidden="true"></span>
  <input type="text"
         placeholder="Filter"
         
         aria-label="Type to filter"
         role="searchbox">
  
  <span class="filter-clear-button hidden"
        data-title="Clear filter"
        aria-label="Clear filter"
        role="button"
        tabindex="0"></span>
</div>

<nav class="devsite-book-nav devsite-nav nocontent"
     aria-label="Side menu">
  <div class="devsite-mobile-header">
    <button type="button"
            id="devsite-close-nav"
            class="devsite-header-icon-button button-flat material-icons gc-analytics-event"
            data-category="Site-Wide Custom Events"
            data-label="Close navigation"
            aria-label="Close navigation">
    </button>
    <div class="devsite-product-name-wrapper">

  <a href="/" class="devsite-site-logo-link gc-analytics-event"
   data-category="Site-Wide Custom Events" data-label="Site logo" track-type="globalNav"
   track-name="androidDevelopers" track-metadata-position="nav"
   track-metadata-eventDetail="nav">
  
  <picture>
    
    <source srcset="https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/images/lockup-dark-theme.png"
            media="(prefers-color-scheme: dark)"
            class="devsite-dark-theme">
    
    <img src="https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/images/lockup.png" class="devsite-site-logo" alt="Android Developers">
  </picture>
  
</a>


</div>
  </div>

  <div class="devsite-book-nav-wrapper">
    <div class="devsite-mobile-nav-top">
      
        <ul class="devsite-nav-list">
          
          
    
    
<li class="devsite-nav-item">

  
  <a href="/studio"
    
       class="devsite-nav-title gc-analytics-event "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Android Studio"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      Android Studio
   </span>
    
  
  </a>
  

</li>

  
          
        </ul>
      
    </div>
    
  </div>
</nav>
        
      </devsite-book-nav>
      <section id="gc-wrapper">
        <main role="main" id="main-content" class="devsite-main-content"
            
              
              has-sidebar
            >
          <div class="devsite-sidebar">
            <div class="devsite-sidebar-content">
                
                <devsite-toc class="devsite-nav"
                            role="navigation"
                            aria-label="On this page"
                            depth="1"
                            scrollbars
                  ></devsite-toc>
                <devsite-recommendations-sidebar class="nocontent devsite-nav">
                </devsite-recommendations-sidebar>
            </div>
          </div>
          <devsite-content>
            
              












<article class="devsite-article"><style>
      body {
        transition: opacity ease-in 0.2s;
      }

      body[unresolved] {
        opacity: 0;
        display: block;
        overflow: hidden;
        position: relative;
      }
      </style>
  
  
  
  
  

  <div class="devsite-article-meta nocontent" role="navigation">
    
    
    <ul class="devsite-breadcrumb-list"
  >
  
</ul>
    
  </div>
  
    <h1 class="devsite-page-title" tabindex="-1">
      (Deprecated) Android Paging Advanced codelab<div class="devsite-actions" hidden data-nosnippet><devsite-feature-tooltip
      ack-key="AckCollectionsBookmarkTooltipDismiss"
      analytics-category="Site-Wide Custom Events"
      analytics-action-show="Callout Profile displayed"
      analytics-action-close="Callout Profile dismissed"
      analytics-label="Create Collection Callout"
      class="devsite-page-bookmark-tooltip nocontent"
      dismiss-button="true"
      id="devsite-collections-dropdown"
      
      dismiss-button-text="Dismiss"

      
      close-button-text="Got it">

    
    
      <devsite-bookmark></devsite-bookmark>
    

    <span slot="popout-heading">
      
      Stay organized with collections
    </span>
    <span slot="popout-contents">
      
      Save and categorize content based on your preferences.
    </span>
  </devsite-feature-tooltip></div>
  
      
    </h1>
  

  <devsite-toc class="devsite-nav"
    depth="1"
    devsite-toc-embedded
    >
  </devsite-toc>
  
    
  <div class="devsite-article-body clearfix
  ">

  
    
    
    <google-codelab-analytics gaid="UA-49880327-14" ga4id="G-JTFZSJVVVZ"></google-codelab-analytics>
    <google-codelab codelab-gaid=""
                    codelab-ga4id=""
                    doc-id="1oLYuxc0HdiiKFnc58fGzIRcJUYJCu-m1Os7F-8LgGac"
                    id="android-paging"
                    title="(Deprecated) Android Paging Advanced codelab"
                    no-tooltip=""
                    environment="web"
                    category=""
                    feedback-link=""
                    layout="paginated"
                    >
      
        <google-codelab-step label="Introduction" duration="0" step="0">
          
            <google-codelab-about codelab-title="(Deprecated) Android Paging Advanced codelab"
                                  
                                  last-updated="2024-12-09T18:47:10Z"
                                  duration="88">
            </google-codelab-about>
          
          <h2 class="step-title" id="0" data-text="Introduction" tabindex="-1">
              1. Introduction
          </h2>
          <aside class="warning"><p> This codelab is deprecated and it will be removed soon.</p>
</aside>
<p>This is a codelab that demonstrates advanced usage of the Paging Library. If you&#39;re new to pagination as a concept, or to the Paging Library as a whole, check out the  <a href="https://developer.android.com/codelabs/android-paging-basics" target="_blank">Paging basics codelab</a>.</p>
<h2 class="checklist" is-upgraded id="what-youll-learn" data-text="What you'll learn" tabindex="-1"><strong>What you'll learn</strong></h2>
<ul class="checklist">
<li>What the main components of Paging 3 are.</li>
<li>How to add Paging 3 to your project.</li>
<li>How to add a header or footer to your list using the Paging 3 API.</li>
<li>How to add list separators using the Paging 3 API.</li>
<li>How to page from network and database.</li>
</ul>
<h2 is-upgraded id="what-youll-build" data-text="What you'll build" tabindex="-1"><strong>What you'll build</strong></h2>
<p>In this codelab, you start with a sample app that already displays a list of GitHub repositories. Whenever the user scrolls to the end of the displayed list, a new network request is triggered and its result is displayed on the screen.</p>
<p>You will add code through a series of steps, to achieve the following:</p>
<ul>
<li>Migrate to the  <a href="https://developer.android.com/topic/libraries/architecture/paging.html" target="_blank">Paging library</a> components.</li>
<li>Add a loading status header and footer to your list.</li>
<li>Show loading progress between every new repository search.</li>
<li>Add separators in your list.</li>
<li>Add database support for paging from network and database.</li>
</ul>
<p>Here&#39;s what your app will look like in the end:</p>
<p class="image-container"><img alt="23643514cb9cf43e.png" style="width: 237.50px" src="/static/codelabs/android-paging/img/23643514cb9cf43e.png" srcset="https://developer.android.com/static/codelabs/android-paging/img/23643514cb9cf43e_36.png 36w,https://developer.android.com/static/codelabs/android-paging/img/23643514cb9cf43e_48.png 48w,https://developer.android.com/static/codelabs/android-paging/img/23643514cb9cf43e_72.png 72w,https://developer.android.com/static/codelabs/android-paging/img/23643514cb9cf43e_96.png 96w,https://developer.android.com/static/codelabs/android-paging/img/23643514cb9cf43e_480.png 480w,https://developer.android.com/static/codelabs/android-paging/img/23643514cb9cf43e_720.png 720w,https://developer.android.com/static/codelabs/android-paging/img/23643514cb9cf43e_856.png 856w,https://developer.android.com/static/codelabs/android-paging/img/23643514cb9cf43e_960.png 960w,https://developer.android.com/static/codelabs/android-paging/img/23643514cb9cf43e_1440.png 1440w,https://developer.android.com/static/codelabs/android-paging/img/23643514cb9cf43e_1920.png 1920w,https://developer.android.com/static/codelabs/android-paging/img/23643514cb9cf43e_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<h2 is-upgraded id="what-youll-need" data-text="What you'll need" tabindex="-1">What you'll need</h2>
<ul>
<li><a href="https://developer.android.com/studio/index.html" target="_blank">Android Studio Arctic Fox</a>.</li>
<li>Familiarity with the following Architecture Components:  <a href="https://developer.android.com/reference/android/arch/lifecycle/LiveData.html" target="_blank">LiveData</a>,  <a href="https://developer.android.com/reference/android/arch/lifecycle/ViewModel.html" target="_blank">ViewModel</a>,  <a href="https://developer.android.com/topic/libraries/view-binding" target="_blank">View. Binding</a> and with the architecture suggested in the &#34; <a href="https://developer.android.com/topic/libraries/architecture/guide.html" target="_blank">Guide to App Architecture</a>&#34;.</li>
<li>Familiarity with  <a href="https://kotlinlang.org/docs/reference/coroutines-overview.html" target="_blank">coroutines</a> and Kotlin  <a href="https://kotlinlang.org/docs/reference/coroutines/flow.html" target="_blank">Flow</a>.</li>
</ul>
<p>For an introduction to Architecture Components, check out the  <a href="https://codelabs.developers.google.com/codelabs/android-room-with-a-view/index.html?index=..%2F..%2Findex#0" target="_blank">Room with a View codelab</a>. For an introduction to Flow, check out the  <a href="https://developer.android.com/codelabs/advanced-kotlin-coroutines" target="_blank">Advanced Coroutines with Kotlin Flow and LiveData codelab</a>.</p>


        </google-codelab-step>
      
        <google-codelab-step label="Setup Your Environment" duration="3" step="1">
          
          <h2 class="step-title" id="1" data-text="Setup Your Environment" tabindex="-1">
              2. Setup Your Environment
          </h2>
          <p>In this step, you will download the code for the entire codelab and then run a simple example app.</p>
<p>To get you started as quickly as possible, we have prepared a starter project for you to build on.</p>
<p>If you have git installed, you can simply run the command below. (You can check by typing <code translate="no" dir="ltr">git --version</code> in the terminal / command line and verify it executes correctly.)</p>
<div></div><devsite-code><pre translate="no" dir="ltr" is-upgraded> git clone https://github.com/android/codelab-android-paging
</pre></devsite-code>
<p>The code is inside the <code translate="no" dir="ltr">/advanced</code> folder. Open the <code translate="no" dir="ltr">start</code> project.</p>
<p>The <code translate="no" dir="ltr">end</code> project contains the code that you should end with, so feel free to check it out if you are stuck.</p>
<p>If you do not have git, you can click the following button to download all the code for this codelab:</p>
<p><a href="https://github.com/android/codelab-android-paging/archive/main.zip" target="_blank"><button class="button button-primary button-with-icon"><span class="material-icons" aria-hidden="true" translate="no">file_download</span>Download source code</button></a></p>
<ol type="1">
<li>Unzip the code, and then open the project Android Studio.</li>
<li>Run the <strong><code translate="no" dir="ltr">app</code></strong> run configuration on a device or emulator.</li>
</ol>
<p class="image-container"><img alt="89af884fa2d4e709.png" style="width: 624.00px" src="/static/codelabs/android-paging/img/89af884fa2d4e709.png" srcset="https://developer.android.com/static/codelabs/android-paging/img/89af884fa2d4e709_36.png 36w,https://developer.android.com/static/codelabs/android-paging/img/89af884fa2d4e709_48.png 48w,https://developer.android.com/static/codelabs/android-paging/img/89af884fa2d4e709_72.png 72w,https://developer.android.com/static/codelabs/android-paging/img/89af884fa2d4e709_96.png 96w,https://developer.android.com/static/codelabs/android-paging/img/89af884fa2d4e709_480.png 480w,https://developer.android.com/static/codelabs/android-paging/img/89af884fa2d4e709_720.png 720w,https://developer.android.com/static/codelabs/android-paging/img/89af884fa2d4e709_856.png 856w,https://developer.android.com/static/codelabs/android-paging/img/89af884fa2d4e709_960.png 960w,https://developer.android.com/static/codelabs/android-paging/img/89af884fa2d4e709_1440.png 1440w,https://developer.android.com/static/codelabs/android-paging/img/89af884fa2d4e709_1920.png 1920w,https://developer.android.com/static/codelabs/android-paging/img/89af884fa2d4e709_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>The app runs and displays a list of GitHub repositories similar to this one:</p>
<p class="image-container"><img alt="50d1d2aa6e79e473.png" style="width: 238.92px" src="/static/codelabs/android-paging/img/50d1d2aa6e79e473.png" srcset="https://developer.android.com/static/codelabs/android-paging/img/50d1d2aa6e79e473_36.png 36w,https://developer.android.com/static/codelabs/android-paging/img/50d1d2aa6e79e473_48.png 48w,https://developer.android.com/static/codelabs/android-paging/img/50d1d2aa6e79e473_72.png 72w,https://developer.android.com/static/codelabs/android-paging/img/50d1d2aa6e79e473_96.png 96w,https://developer.android.com/static/codelabs/android-paging/img/50d1d2aa6e79e473_480.png 480w,https://developer.android.com/static/codelabs/android-paging/img/50d1d2aa6e79e473_720.png 720w,https://developer.android.com/static/codelabs/android-paging/img/50d1d2aa6e79e473_856.png 856w,https://developer.android.com/static/codelabs/android-paging/img/50d1d2aa6e79e473_960.png 960w,https://developer.android.com/static/codelabs/android-paging/img/50d1d2aa6e79e473_1440.png 1440w,https://developer.android.com/static/codelabs/android-paging/img/50d1d2aa6e79e473_1920.png 1920w,https://developer.android.com/static/codelabs/android-paging/img/50d1d2aa6e79e473_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>


        </google-codelab-step>
      
        <google-codelab-step label="Project overview" duration="3" step="2">
          
          <h2 class="step-title" id="2" data-text="Project overview" tabindex="-1">
              3. Project overview
          </h2>
          <p>The app allows you to search GitHub for repositories whose name or description contains a specific word. The list of repositories is displayed in descending order based on the number of stars, then alphabetically by name.</p>
<p>The app follows the architecture recommended in the &#34; <a href="https://developer.android.com/topic/libraries/architecture/guide.html" target="_blank">Guide to app architecture</a>&#34;. Here&#39;s what you will find in each package:</p>
<ul>
<li><strong>api</strong> - Github API calls, using Retrofit.</li>
<li><strong>data</strong> - the repository class, responsible for triggering API requests and caching the responses in memory.</li>
<li><strong>model</strong> - the <code translate="no" dir="ltr">Repo</code> data model, which is also a table in the Room database; and <code translate="no" dir="ltr">RepoSearchResult</code>, a class that is used by the UI to observe both search results data and network errors.</li>
<li><strong>ui</strong> - classes related to displaying an <code translate="no" dir="ltr">Activity</code> with a <code translate="no" dir="ltr">RecyclerView</code>.</li>
</ul>
<p>The <code translate="no" dir="ltr">GithubRepository</code> class retrieves the list of repository names from the network every time the user scrolls towards the end of the list, or when the user searches for a new repository. The list of results for a query is kept in memory in the <code translate="no" dir="ltr">GithubRepository</code> in a  <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.channels/-conflated-broadcast-channel/" target="_blank"><code translate="no" dir="ltr">ConflatedBroadcastChannel</code></a> and exposed as a  <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/-flow/index.html" target="_blank"><code translate="no" dir="ltr">Flow</code></a>.</p>
<aside class="special"><p><strong>A Flow is an async sequence of values</strong></p>
<p><code translate="no" dir="ltr">Flow</code> produces values one at a time (instead of all at once) that can generate values from <em>async</em> operations like network requests, database calls, or other async code. It supports coroutines throughout its API, so you can transform a flow using coroutines as well! For an introduction to the <code translate="no" dir="ltr">Flow</code> type, be sure to visit the  <a href="https://developer.android.com/kotlin/flow" target="_blank">documentation</a>. For a more hands-on experience, be sure to check out the advanced coroutines  <a href="https://developer.android.com/codelabs/advanced-kotlin-coroutines#0" target="_blank">codelab</a>.</p>
</aside>
<p><code translate="no" dir="ltr">SearchRepositoriesViewModel</code> requests the data from <code translate="no" dir="ltr">GithubRepository</code> and exposes it to the <code translate="no" dir="ltr">SearchRepositoriesActivity</code>. Because we want to ensure that we&#39;re not requesting the data multiple times on configuration change (e.g. rotation), we&#39;re converting the <code translate="no" dir="ltr">Flow</code> to <code translate="no" dir="ltr">LiveData</code> in the <code translate="no" dir="ltr">ViewModel</code> using the  <a href="https://developer.android.com/reference/kotlin/androidx/lifecycle/package-summary#liveData(kotlin.coroutines.CoroutineContext,%20kotlin.Long,%20kotlin.coroutines.SuspendFunction1)" target="_blank"><code translate="no" dir="ltr">liveData()</code></a> builder method. That way, the <code translate="no" dir="ltr">LiveData</code> caches the latest list of results in memory, and when the <code translate="no" dir="ltr">SearchRepositoriesActivity</code> gets recreated, the content of the <code translate="no" dir="ltr">LiveData</code> will be displayed on the screen.  The <code translate="no" dir="ltr">ViewModel</code> exposes:</p>
<ol type="1">
<li>A <code translate="no" dir="ltr">LiveData&lt;UiState&gt;</code></li>
<li>A function <code translate="no" dir="ltr">(UiAction) -&gt; Unit</code></li>
</ol>
<p>The <code translate="no" dir="ltr">UiState</code> is a representation of everything needed to render the app&#39;s UI, with different fields corresponding to different UI components. It is an immutable object, which means it can&#39;t be changed; however, new versions of it can be produced and observed by the UI. In our case, new versions of it are produced as a result of the user&#39;s actions: either searching for a new query, or scrolling the list to fetch more.</p>
<p>The user actions are aptly represented by the <code translate="no" dir="ltr">UiAction</code> type. Enclosing the API for interactions to the <code translate="no" dir="ltr">ViewModel</code> in a single type has the following benefits:</p>
<ul>
<li>Small API surface: Actions can be added, removed, or changed, but the method signature of the <code translate="no" dir="ltr">ViewModel</code> never changes. This makes refactoring local and less likely to leak abstractions or interface implementations.</li>
<li>Easier concurrency management: As you&#39;ll see later in the codelab, it&#39;s important to be able to guarantee the execution order of certain requests. By typing the API strongly with <code translate="no" dir="ltr">UiAction</code>, we can write code with strict requirements for what can happen, and when it can happen.</li>
</ul>
<p>From a usability perspective, we have the following issues:</p>
<ul>
<li>The user has no information on the list loading state: they see an empty screen when they search for a new repository or just an abrupt end of the list while more results for the same query are being loaded.</li>
<li>The user can&#39;t retry a failed query.</li>
<li>The list always scrolls to the top after orientation changes or after process death.</li>
</ul>
<p>From an implementation perspective, we have the following issues:</p>
<ul>
<li>The list grows unbounded in memory, wasting memory as the user scrolls.</li>
<li>We have to convert our results from <code translate="no" dir="ltr">Flow</code> to <code translate="no" dir="ltr">LiveData</code> to cache them, increasing the complexity of our code.</li>
<li>If our app needed to show multiple lists, we&#39;d see that there is a lot of boilerplate to write for each list.</li>
</ul>
<p>Let&#39;s find out how the Paging library can help us with these issues and what components it includes.</p>


        </google-codelab-step>
      
        <google-codelab-step label="Paging library components" duration="2" step="3">
          
          <h2 class="step-title" id="3" data-text="Paging library components" tabindex="-1">
              4. Paging library components
          </h2>
          <p>The Paging library makes it easier for you to load data incrementally and gracefully within your app&#39;s UI. The Paging API provides support for many of the functionalities that you would otherwise need to implement manually when you need to load data in pages:</p>
<ul>
<li>Keeps track of the keys to be used for retrieving the next and previous page.</li>
<li>Automatically requests the correct page when the user has scrolled to the end of the list.</li>
<li>Ensures that multiple requests aren&#39;t triggered at the same time.</li>
<li>Allows you to cache data: if you&#39;re using Kotlin, this is done in a  <a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-coroutine-scope/" target="_blank"><code translate="no" dir="ltr">CoroutineScope</code></a>; if you&#39;re using Java, this can be done with <code translate="no" dir="ltr">LiveData</code>.</li>
<li>Tracks loading state and allows you to display it in a <code translate="no" dir="ltr">RecyclerView</code> list item or elsewhere in your UI, and easily retry failed loads.</li>
<li>Allows you to execute common operations like <code translate="no" dir="ltr">map</code> or <code translate="no" dir="ltr">filter</code> on the list that will be displayed, independently of whether you&#39;re using <code translate="no" dir="ltr">Flow</code>, <code translate="no" dir="ltr">LiveData</code>, or RxJava <code translate="no" dir="ltr">Flowable</code> or <code translate="no" dir="ltr">Observable</code>.</li>
<li>Provides an easy way of implementing list separators.</li>
</ul>
<p>The  <a href="https://developer.android.com/topic/libraries/architecture/guide.html" target="_blank">Guide to app architecture</a> proposes an architecture with the following main components:</p>
<ul>
<li>A local database that serves as a single source of truth for data presented to the user and manipulated by the user.</li>
<li>A web API service.</li>
<li>A repository that works with the database and the web API service, providing a unified data interface.</li>
<li>A <code translate="no" dir="ltr">ViewModel</code> that provides data specific to the UI.</li>
<li>The UI, which shows a visual representation of the data in the <code translate="no" dir="ltr">ViewModel</code>.</li>
</ul>
<p>The Paging library works with all of these components and coordinates the interactions between them, so that it can load &#34;pages&#34; of  content from a data source and display that content in the UI.</p>
<p>This codelab introduces you to the Paging library and its main components:</p>
<ul>
<li><strong><code translate="no" dir="ltr">PagingData</code></strong> - a container for paginated data. Each refresh of data will have a separate corresponding <code translate="no" dir="ltr">PagingData</code>.</li>
<li><strong><code translate="no" dir="ltr">PagingSource</code></strong> - a <code translate="no" dir="ltr">PagingSource</code> is the base class for loading snapshots of data into a stream of <code translate="no" dir="ltr">PagingData</code>.</li>
<li><strong><code translate="no" dir="ltr">Pager.flow</code></strong> - builds a <code translate="no" dir="ltr">Flow&lt;PagingData&gt;</code>, based on a <code translate="no" dir="ltr">PagingConfig</code> and a function that defines how to construct the implemented <code translate="no" dir="ltr">PagingSource</code>.</li>
<li><strong><code translate="no" dir="ltr">PagingDataAdapter</code></strong> - a <code translate="no" dir="ltr">RecyclerView.Adapter</code> that presents <code translate="no" dir="ltr">PagingData</code> in a <code translate="no" dir="ltr">RecyclerView</code>. The <code translate="no" dir="ltr">PagingDataAdapter</code> can be connected to a Kotlin <code translate="no" dir="ltr">Flow</code>, a <code translate="no" dir="ltr">LiveData</code>, an RxJava <code translate="no" dir="ltr">Flowable</code>, or an RxJava <code translate="no" dir="ltr">Observable</code>. The <code translate="no" dir="ltr">PagingDataAdapter</code> listens to internal <code translate="no" dir="ltr">PagingData</code> loading events as pages are loaded and uses <code translate="no" dir="ltr">DiffUtil</code> on a background thread to compute fine-grained updates as updated content is received in the form of new <code translate="no" dir="ltr">PagingData</code> objects.</li>
<li><strong><code translate="no" dir="ltr">RemoteMediator</code></strong> - helps implement pagination from network and database.</li>
</ul>
<p>In this codelab, you will implement examples of each of the components described above.</p>


        </google-codelab-step>
      
        <google-codelab-step label="Define the source of data" duration="5" step="4">
          
          <h2 class="step-title" id="4" data-text="Define the source of data" tabindex="-1">
              5. Define the source of data
          </h2>
          <p>The <code translate="no" dir="ltr">PagingSource</code> implementation defines the source of data and how to retrieve data from that source. The <code translate="no" dir="ltr">PagingData</code> object queries data from the <code translate="no" dir="ltr">PagingSource</code> in response to loading hints that are generated as the user scrolls in a <code translate="no" dir="ltr">RecyclerView</code>.</p>
<p>Currently, the <code translate="no" dir="ltr">GithubRepository</code> has a lot of the responsibilities of a data source that the Paging library will handle once we&#39;re done adding it:</p>
<ul>
<li>Loads the data from <code translate="no" dir="ltr">GithubService</code>, ensuring that multiple requests aren&#39;t triggered at the same time.</li>
<li>Keeps an in-memory cache of the retrieved data.</li>
<li>Keeps track of the page to be requested.</li>
</ul>
<p>To build the <code translate="no" dir="ltr">PagingSource</code> you need to define the following:</p>
<ul>
<li><strong>The type of the paging key</strong> - in our case, the Github API uses 1-based index numbers for pages, so the type is <code translate="no" dir="ltr">Int</code>.</li>
<li><strong>The type of data loaded</strong> - in our case, we&#39;re loading <code translate="no" dir="ltr">Repo</code> items.</li>
<li><strong>Where is the data retrieved from</strong> - we&#39;re getting the data from <code translate="no" dir="ltr">GithubService</code>. Our data source will be specific to a certain query, so we need to make sure we&#39;re also passing the query information to <code translate="no" dir="ltr">GithubService</code>.</li>
</ul>
<p>So, in the <code translate="no" dir="ltr">data</code> package, let&#39;s create a <code translate="no" dir="ltr">PagingSource</code> implementation called <code translate="no" dir="ltr">GithubPagingSource</code>:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Scalate Server Page"><code translate="no" dir="ltr">class<span class="devsite-syntax-w"> </span>GithubPagingSource(
<span class="devsite-syntax-w">        </span>private<span class="devsite-syntax-w"> </span>val<span class="devsite-syntax-w"> </span>service:<span class="devsite-syntax-w"> </span>GithubService,
<span class="devsite-syntax-w">        </span>private<span class="devsite-syntax-w"> </span>val<span class="devsite-syntax-w"> </span>query:<span class="devsite-syntax-w"> </span>String
)<span class="devsite-syntax-w"> </span>:<span class="devsite-syntax-w"> </span>PagingSource&lt;Int,<span class="devsite-syntax-w"> </span>Repo&gt;()<span class="devsite-syntax-w"> </span>{<span class="devsite-syntax-w"> </span>
<span class="devsite-syntax-w">    </span>override<span class="devsite-syntax-w"> </span>suspend<span class="devsite-syntax-w"> </span>fun<span class="devsite-syntax-w"> </span>load(params:<span class="devsite-syntax-w"> </span>LoadParams&lt;Int&gt;):<span class="devsite-syntax-w"> </span>LoadResult&lt;Int,<span class="devsite-syntax-w"> </span>Repo&gt;<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">        </span>TODO("Not<span class="devsite-syntax-w"> </span>yet<span class="devsite-syntax-w"> </span>implemented")
<span class="devsite-syntax-w">    </span>}
<span class="devsite-syntax-w">   </span>override<span class="devsite-syntax-w"> </span>fun<span class="devsite-syntax-w"> </span>getRefreshKey(state:<span class="devsite-syntax-w"> </span>PagingState&lt;Int,<span class="devsite-syntax-w"> </span>Repo&gt;):<span class="devsite-syntax-w"> </span>Int?<span class="devsite-syntax-w"> </span>{<span class="devsite-syntax-w"> </span>
<span class="devsite-syntax-w">        </span>TODO("Not<span class="devsite-syntax-w"> </span>yet<span class="devsite-syntax-w"> </span>implemented")
<span class="devsite-syntax-w">    </span>}

}
</code></pre></devsite-code>
<p>We&#39;ll see that <code translate="no" dir="ltr">PagingSource</code> requires us to implement two functions: <code translate="no" dir="ltr">load()</code> and <code translate="no" dir="ltr">getRefreshKey()</code>.</p>
<p>The <code translate="no" dir="ltr">load()</code> function will be called  by the Paging library to asynchronously fetch more data to be displayed as the user scrolls around. The <code translate="no" dir="ltr">LoadParams</code> object keeps information related to the load operation, including the following:</p>
<ul>
<li><strong>Key of the page to be loaded</strong>. If this is the first time that load is called, <code translate="no" dir="ltr">LoadParams.key</code> will be <code translate="no" dir="ltr">null</code>. In this case, you will have to define the initial page key. For our project, you&#39;ll have to move <code translate="no" dir="ltr">GITHUB_STARTING_PAGE_INDEX</code> constant from <code translate="no" dir="ltr">GithubRepository</code> to your <code translate="no" dir="ltr">PagingSource</code> implementation since this is the initial page key.</li>
<li><strong>Load size</strong> - the requested number of items to load.</li>
</ul>
<p>The load function returns a <code translate="no" dir="ltr">LoadResult</code>. This will replace the usage of <code translate="no" dir="ltr">RepoSearchResult</code> in our app, as <code translate="no" dir="ltr">LoadResult</code> can take one of the following types:</p>
<ul>
<li><code translate="no" dir="ltr">LoadResult.Page</code>, if the result was successful.</li>
<li><code translate="no" dir="ltr">LoadResult.Error</code>, in case of error.</li>
</ul>
<p>When constructing the <code translate="no" dir="ltr">LoadResult.Page</code>, pass <code translate="no" dir="ltr">null</code> for <code translate="no" dir="ltr">nextKey</code> or <code translate="no" dir="ltr">prevKey</code> if the list can&#39;t be loaded in the corresponding direction. For example, in our case, we could consider that if the network response was successful but the list was empty, we don&#39;t have any data left to be loaded; so the <code translate="no" dir="ltr">nextKey</code> can be <code translate="no" dir="ltr">null</code>.</p>
<p>Based on all of this information, we should be able to implement the <code translate="no" dir="ltr">load()</code> function!</p>
<p>Next we need to implement <code translate="no" dir="ltr">getRefreshKey()</code>. The refresh key is used for subsequent refresh calls to <code translate="no" dir="ltr">PagingSource.load()</code> (the first call is initial load which uses <code translate="no" dir="ltr">initialKey</code> provided by <code translate="no" dir="ltr">Pager</code>). A refresh happens whenever the Paging library wants to load new data to replace the current list, e.g., on swipe to refresh or on invalidation due to database updates, config changes, process death, etc. Typically, subsequent refresh calls will want to restart loading data centered around <code translate="no" dir="ltr">PagingState.anchorPosition</code> which represents the most recently accessed index.</p>
<p>The <code translate="no" dir="ltr">GithubPagingSource</code> implementation looks like this:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="GDScript"><code translate="no" dir="ltr"><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">GitHub</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">page</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">API</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">1</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">based</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">https</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-n">developer</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">github</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">com</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">v3</span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-c1">#pagination</span>
<span class="devsite-syntax-n">private</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">const</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">GITHUB_STARTING_PAGE_INDEX</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">1</span>

<span class="devsite-syntax-k">class</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">GithubPagingSource</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">private</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">service</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">GithubService</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">private</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">query</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb devsite-syntax-nb-Type">String</span>
<span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">PagingSource&lt;Int</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Repo</span>&gt;<span class="devsite-syntax-p">()</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">override</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">suspend</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb">load</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">params</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadParams&lt;Int&gt;</span><span class="devsite-syntax-p">):</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadResult&lt;Int</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Repo</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">position</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">params</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">key</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">GITHUB_STARTING_PAGE_INDEX</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">apiQuery</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">query</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">+</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">IN_QUALIFIER</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">try</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">response</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">service</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">searchRepos</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">apiQuery</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">position</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">params</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">loadSize</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">repos</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">response</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">items</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">nextKey</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">repos</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">isEmpty</span><span class="devsite-syntax-p">())</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-nb devsite-syntax-nb-Type">null</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-p">}</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">else</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">initial</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb">load</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">size</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">3</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">NETWORK_PAGE_SIZE</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ensure</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">we</span><span class="devsite-syntax-s1">'re not requesting duplicating items, at the 2nd request</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">position</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">+</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">params</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">loadSize</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">/</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">NETWORK_PAGE_SIZE</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">LoadResult</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Page</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">                    </span><span class="devsite-syntax-n">data</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">repos</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">                    </span><span class="devsite-syntax-n">prevKey</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">position</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">==</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">GITHUB_STARTING_PAGE_INDEX</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb devsite-syntax-nb-Type">null</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">else</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">position</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">1</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">                    </span><span class="devsite-syntax-n">nextKey</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">nextKey</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">}</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">catch</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">exception</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">IOException</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadResult</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Error</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">exception</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">}</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">catch</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">exception</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">HttpException</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadResult</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Error</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">exception</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">The</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">key</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">used</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">for</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">subsequent</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">calls</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">to</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">PagingSource</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">load</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">after</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">initial</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb">load</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">override</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">getRefreshKey</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">state</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">PagingState&lt;Int</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Repo</span>&gt;<span class="devsite-syntax-p">):</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Int</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">We</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">need</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">to</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">get</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">previous</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">key</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-ow">or</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">next</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">key</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">previous</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb devsite-syntax-nb-Type">null</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">of</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">page</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">that</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">was</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">closest</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">to</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">most</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">recently</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">accessed</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">index</span><span class="devsite-syntax-o">.</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Anchor</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">position</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">most</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">recently</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">accessed</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">index</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">state</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">anchorPosition</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">let</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">anchorPosition</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">state</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">closestPageToPosition</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">anchorPosition</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">prevKey</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">plus</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">1</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">state</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">closestPageToPosition</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">anchorPosition</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">nextKey</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">minus</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">1</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span>

<span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<aside class="special"><p>By default, the <strong>initial load size is 3 * page size</strong>. That way, Paging ensures that the first time the list is loaded the user will see enough items and doesn&#39;t trigger too many network requests, if the user doesn&#39;t scroll past what&#39;s loaded.</p>
<p>Make sure you keep that in consideration when computing the next key in the PagingSource implementation.</p>
</aside>


        </google-codelab-step>
      
        <google-codelab-step label="Build and configure PagingData" duration="5" step="5">
          
          <h2 class="step-title" id="5" data-text="Build and configure PagingData" tabindex="-1">
              6. Build and configure PagingData
          </h2>
          <p>In our current implementation, we use a <code translate="no" dir="ltr">Flow&lt;RepoSearchResult&gt;</code> in the <code translate="no" dir="ltr">GitHubRepository</code> to get the data from the network and pass it to the <code translate="no" dir="ltr">ViewModel</code>. The <code translate="no" dir="ltr">ViewModel</code> then transforms it into a <code translate="no" dir="ltr">LiveData</code> and exposes it to the UI. Whenever we get to the end of the displayed list and more data is loaded from the network, the <code translate="no" dir="ltr">Flow&lt;RepoSearchResult&gt;</code> will contain the entire list of previously retrieved data for that query in addition to the latest data.</p>
<p><code translate="no" dir="ltr">RepoSearchResult</code> encapsulates both the success and error cases. The success case holds the repository data. The error case contains the <code translate="no" dir="ltr">Exception</code> reason. With Paging 3 we don&#39;t need the <code translate="no" dir="ltr">RepoSearchResult</code> anymore, as the library models both the success and error cases with <code translate="no" dir="ltr">LoadResult</code>. Feel free to delete <code translate="no" dir="ltr">RepoSearchResult</code> as in the next few steps we&#39;ll replace it.</p>
<p>To construct the <code translate="no" dir="ltr">PagingData</code>, we first need to decide what API we want to use to pass the <code translate="no" dir="ltr">PagingData</code> to other layers of our app:</p>
<ul>
<li>Kotlin <code translate="no" dir="ltr">Flow</code> - use <code translate="no" dir="ltr">Pager.flow</code>.</li>
<li><code translate="no" dir="ltr">LiveData</code> - use <code translate="no" dir="ltr">Pager.liveData</code>.</li>
<li>RxJava <code translate="no" dir="ltr">Flowable</code> - use <code translate="no" dir="ltr">Pager.flowable</code>.</li>
<li>RxJava <code translate="no" dir="ltr">Observable</code> - use <code translate="no" dir="ltr">Pager.observable</code>.</li>
</ul>
<p>As we&#39;re already using <code translate="no" dir="ltr">Flow</code> in our app, we&#39;ll continue with this approach; but instead of using <code translate="no" dir="ltr">Flow&lt;RepoSearchResult&gt;</code>, we&#39;ll use <code translate="no" dir="ltr">Flow&lt;PagingData&lt;Repo&gt;&gt;</code>.</p>
<p>No matter which <code translate="no" dir="ltr">PagingData</code> builder you use, you&#39;ll have to pass the following parameters:</p>
<ul>
<li><strong><code translate="no" dir="ltr">PagingConfig</code></strong>. This class sets options regarding how to load content from a <code translate="no" dir="ltr">PagingSource</code> such as how far ahead to load, the size request for the initial load, and others. The only mandatory parameter you have to define is the page size—how many items should be loaded in each page. By default, Paging will keep in memory all the pages you load. To ensure that you&#39;re not wasting memory as the user scrolls, set the <code translate="no" dir="ltr">maxSize</code> parameter in <code translate="no" dir="ltr">PagingConfig</code>. By default Paging will return null items as a placeholder for content that is not yet loaded if Paging can count the unloaded items and if the <code translate="no" dir="ltr">enablePlaceholders</code> config flag is true. Like this, you will be able to display a placeholder view in your adapter. To simplify the work in this codelab, let&#39;s disable the placeholders by passing <code translate="no" dir="ltr">enablePlaceholders = false</code>.</li>
<li>A <strong>function that defines how to create the </strong><code translate="no" dir="ltr">PagingSource</code>. In our case, we&#39;ll create a new <code translate="no" dir="ltr">GithubPagingSource</code> for each new query.</li>
</ul>
<aside class="special"><p><strong>Note:</strong> The <code translate="no" dir="ltr">PagingConfig.pageSize</code> should be enough for several screens&#39; worth of items. If the page is too small, your list might flicker as pages&#39; content doesn&#39;t cover the full screen. Larger page sizes are good for loading efficiency, but can increase latency when the list is updated.</p>
<p><strong>Note:</strong> By default <code translate="no" dir="ltr">PagingConfig.maxSize</code> is unbounded, so pages are never dropped. If you do want to drop pages, make sure that you keep <code translate="no" dir="ltr">maxSize</code> to a high enough number that it doesn&#39;t result in too many network requests when the user changes the scroll direction. The minimum value is <code translate="no" dir="ltr">pageSize + prefetchDistance * 2</code>.</p>
</aside>
<p>Let&#39;s modify our <code translate="no" dir="ltr">GithubRepository</code>!</p>
<h2 is-upgraded id="update-githubrepository.getsearchresultstream" data-text="Update GithubRepository.getSearchResultStream" tabindex="-1">Update <code translate="no" dir="ltr">GithubRepository.getSearchResultStream</code></h2>
<ul>
<li>Remove the <code translate="no" dir="ltr">suspend</code> modifier.</li>
<li>Return <code translate="no" dir="ltr">Flow&lt;PagingData&lt;Repo&gt;&gt;</code>.</li>
<li>Construct <code translate="no" dir="ltr">Pager</code>.</li>
</ul>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="scdoc"><code translate="no" dir="ltr">fun getSearchResultStream(query: String): Flow&lt;PagingData&lt;Repo&gt;&gt; {
    return Pager(
          config = PagingConfig(
            pageSize = NETWORK_PAGE_SIZE,
            enablePlaceholders = false
         ),
          pagingSourceFactory = { GithubPagingSource(service, query) }
    ).flow
}
</code></pre></devsite-code>
<h2 is-upgraded id="cleanup-githubrepository" data-text="Cleanup GithubRepository" tabindex="-1">Cleanup <strong><code translate="no" dir="ltr">GithubRepository</code></strong></h2>
<p>Paging 3 does a lot of things for us:</p>
<ul>
<li>Handles in-memory cache.</li>
<li>Requests data when the user is close to the end of the list.</li>
</ul>
<p>This means that everything else in our <code translate="no" dir="ltr">GithubRepository</code> can be removed, except <code translate="no" dir="ltr">getSearchResultStream</code> and the companion object where we defined the <code translate="no" dir="ltr">NETWORK_PAGE_SIZE</code>. Your <code translate="no" dir="ltr">GithubRepository</code> should now look like this:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Scalate Server Page"><code translate="no" dir="ltr">class<span class="devsite-syntax-w"> </span>GithubRepository(private<span class="devsite-syntax-w"> </span>val<span class="devsite-syntax-w"> </span>service:<span class="devsite-syntax-w"> </span>GithubService)<span class="devsite-syntax-w"> </span>{

<span class="devsite-syntax-w">    </span>fun<span class="devsite-syntax-w"> </span>getSearchResultStream(query:<span class="devsite-syntax-w"> </span>String):<span class="devsite-syntax-w"> </span>Flow&lt;PagingData&lt;Repo&gt;&gt;<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">        </span>return<span class="devsite-syntax-w"> </span>Pager(
<span class="devsite-syntax-w">                </span>config<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>PagingConfig(
<span class="devsite-syntax-w">                </span>pageSize<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>NETWORK_PAGE_SIZE,
<span class="devsite-syntax-w">                </span>enablePlaceholders<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>false
<span class="devsite-syntax-w">             </span>),
<span class="devsite-syntax-w">                </span>pagingSourceFactory<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>{<span class="devsite-syntax-w"> </span>GithubPagingSource(service,<span class="devsite-syntax-w"> </span>query)<span class="devsite-syntax-w"> </span>}
<span class="devsite-syntax-w">        </span>).flow
<span class="devsite-syntax-w">    </span>}

<span class="devsite-syntax-w">    </span>companion<span class="devsite-syntax-w"> </span>object<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">        </span>const<span class="devsite-syntax-w"> </span>val<span class="devsite-syntax-w"> </span>NETWORK_PAGE_SIZE<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>50
<span class="devsite-syntax-w">    </span>}
}
</code></pre></devsite-code>
<p>You should now have compile errors in the <code translate="no" dir="ltr">SearchRepositoriesViewModel</code>. Let&#39;s see what changes need to be made there!</p>


        </google-codelab-step>
      
        <google-codelab-step label="Request and cache PagingData in the ViewModel" duration="5" step="6">
          
          <h2 class="step-title" id="6" data-text="Request and cache PagingData in the ViewModel" tabindex="-1">
              7. Request and cache PagingData in the ViewModel
          </h2>
          <p>Before addressing the compile errors, let&#39;s review the types in the <code translate="no" dir="ltr">ViewModel</code>:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Scalate Server Page"><code translate="no" dir="ltr">sealed<span class="devsite-syntax-w"> </span>class<span class="devsite-syntax-w"> </span>UiAction<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">    </span>data<span class="devsite-syntax-w"> </span>class<span class="devsite-syntax-w"> </span>Search(val<span class="devsite-syntax-w"> </span>query:<span class="devsite-syntax-w"> </span>String)<span class="devsite-syntax-w"> </span>:<span class="devsite-syntax-w"> </span>UiAction()
<span class="devsite-syntax-w">    </span>data<span class="devsite-syntax-w"> </span>class<span class="devsite-syntax-w"> </span>Scroll(
<span class="devsite-syntax-w">        </span>val<span class="devsite-syntax-w"> </span>visibleItemCount:<span class="devsite-syntax-w"> </span>Int,
<span class="devsite-syntax-w">        </span>val<span class="devsite-syntax-w"> </span>lastVisibleItemPosition:<span class="devsite-syntax-w"> </span>Int,
<span class="devsite-syntax-w">        </span>val<span class="devsite-syntax-w"> </span>totalItemCount:<span class="devsite-syntax-w"> </span>Int
<span class="devsite-syntax-w">    </span>)<span class="devsite-syntax-w"> </span>:<span class="devsite-syntax-w"> </span>UiAction()
}

data<span class="devsite-syntax-w"> </span>class<span class="devsite-syntax-w"> </span>UiState(
<span class="devsite-syntax-w">    </span>val<span class="devsite-syntax-w"> </span>query:<span class="devsite-syntax-w"> </span>String,
<span class="devsite-syntax-w">    </span>val<span class="devsite-syntax-w"> </span>searchResult:<span class="devsite-syntax-w"> </span>RepoSearchResult
)
</code></pre></devsite-code>
<p>In our <code translate="no" dir="ltr">UiState</code> we expose a <code translate="no" dir="ltr">searchResult</code>; the role of <code translate="no" dir="ltr">searchResult</code> is to be an in-memory cache for result searches that survives configuration changes. With Paging 3 we don&#39;t need to convert our <code translate="no" dir="ltr">Flow</code> to <code translate="no" dir="ltr">LiveData</code> anymore. Instead, <code translate="no" dir="ltr">SearchRepositoriesViewModel</code> will now expose a <code translate="no" dir="ltr">StateFlow&lt;UiState&gt;</code>. Furthermore, we drop the <code translate="no" dir="ltr">searchResult</code> val entirely, opting instead to expose a separate <code translate="no" dir="ltr">Flow&lt;PagingData&lt;Repo&gt;&gt;</code> that serves the same purpose that <code translate="no" dir="ltr">searchResult</code> did.</p>
<p><code translate="no" dir="ltr">PagingData</code> is a self-contained type that contains a mutable stream of updates to the data to be displayed in the <code translate="no" dir="ltr">RecyclerView</code>. Each emission of <code translate="no" dir="ltr">PagingData</code> is completely independent, and multiple <code translate="no" dir="ltr">PagingData</code> may be emitted for a single query. As such, <code translate="no" dir="ltr">Flows</code> of <code translate="no" dir="ltr">PagingData</code> should be exposed independent of other <code translate="no" dir="ltr">Flows</code>.</p>
<aside class="special"><p><strong>Note:</strong> Do not mix or combine the <code translate="no" dir="ltr">PagingData</code> <code translate="no" dir="ltr">Flow</code> with other <code translate="no" dir="ltr">Flows</code>, as each emission of <code translate="no" dir="ltr">PagingData</code> should be consumed independently. Also operators like <code translate="no" dir="ltr">shareIn</code>  and <code translate="no" dir="ltr">stateIn</code> should not be used on <code translate="no" dir="ltr">PagingData</code> <code translate="no" dir="ltr">Flows</code>.</p>
</aside>
<p>Furthermore, as a user experience perk, for every new query entered, we want to scroll to the top of the list to show the first search result. However, as paging data may be emitted multiple times we only want to scroll to the top of the list if the user has <strong><em>not</em></strong> begun scrolling.</p>
<p>To do this, let&#39;s update <code translate="no" dir="ltr">UiState</code> and add fields for the <code translate="no" dir="ltr">lastQueryScrolled</code> and <code translate="no" dir="ltr">hasNotScrolledForCurrentSearch</code>. These flags will prevent us from scrolling to the top of the list when we shouldn&#39;t:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Scalate Server Page"><code translate="no" dir="ltr">data<span class="devsite-syntax-w"> </span>class<span class="devsite-syntax-w"> </span>UiState(
<span class="devsite-syntax-w">    </span>val<span class="devsite-syntax-w"> </span>query:<span class="devsite-syntax-w"> </span>String<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>DEFAULT_QUERY,
<span class="devsite-syntax-w">    </span>val<span class="devsite-syntax-w"> </span>lastQueryScrolled:<span class="devsite-syntax-w"> </span>String<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>DEFAULT_QUERY,
<span class="devsite-syntax-w">    </span>val<span class="devsite-syntax-w"> </span>hasNotScrolledForCurrentSearch:<span class="devsite-syntax-w"> </span>Boolean<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>false
)
</code></pre></devsite-code>
<p>Let&#39;s revisit our architecture. Because all requests to the <code translate="no" dir="ltr">ViewModel</code> go through a single entry point -  the <code translate="no" dir="ltr">accept</code> field defined as a <code translate="no" dir="ltr">(UiAction) -&gt; Unit</code> - we need to do the following:</p>
<ul>
<li>Convert that entry point into streams containing types we&#39;re interested in.</li>
<li>Transform those streams.</li>
<li>Combine the streams back into a <code translate="no" dir="ltr">StateFlow&lt;UiState&gt;</code>.</li>
</ul>
<p>In more functional terms, we are going to <code translate="no" dir="ltr">reduce</code> emissions of <code translate="no" dir="ltr">UiAction</code> into <code translate="no" dir="ltr">UiState</code>. It&#39;s sort of like an assembly line: the <code translate="no" dir="ltr">UiAction</code> types are the raw materials that come in, they cause effects (sometimes called mutations), and the <code translate="no" dir="ltr">UiState</code> is the finished output ready to be bound to the UI. This is sometimes called making the UI a function of the <code translate="no" dir="ltr">UiState</code>.</p>
<p>Let&#39;s rewrite the <code translate="no" dir="ltr">ViewModel</code> to handle each  <code translate="no" dir="ltr">UiAction</code> type in two different streams, and then transform them into a <code translate="no" dir="ltr">StateFlow&lt;UiState&gt;</code> using a few Kotlin <code translate="no" dir="ltr">Flow</code> operators.</p>
<p>First we update the definitions for <code translate="no" dir="ltr">state</code> in the <code translate="no" dir="ltr">ViewModel</code> to use a <code translate="no" dir="ltr">StateFlow</code> instead of a <code translate="no" dir="ltr">LiveData</code> while also adding a field for exposing a <code translate="no" dir="ltr">Flow</code> of <code translate="no" dir="ltr">PagingData</code>:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Scalate Server Page"><code translate="no" dir="ltr"><span class="devsite-syntax-w">   </span>/**
<span class="devsite-syntax-w">     </span>*<span class="devsite-syntax-w"> </span>Stream<span class="devsite-syntax-w"> </span>of<span class="devsite-syntax-w"> </span>immutable<span class="devsite-syntax-w"> </span>states<span class="devsite-syntax-w"> </span>representative<span class="devsite-syntax-w"> </span>of<span class="devsite-syntax-w"> </span>the<span class="devsite-syntax-w"> </span>UI.
<span class="devsite-syntax-w">     </span>*/
<span class="devsite-syntax-w">    </span>val<span class="devsite-syntax-w"> </span>state:<span class="devsite-syntax-w"> </span>StateFlow&lt;UiState&gt;

<span class="devsite-syntax-w">    </span>val<span class="devsite-syntax-w"> </span>pagingDataFlow:<span class="devsite-syntax-w"> </span>Flow&lt;PagingData&lt;Repo&gt;&gt;
</code></pre></devsite-code>
<p>Next, we update the definition for the <code translate="no" dir="ltr">UiAction.Scroll</code> subclass:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Scalate Server Page"><code translate="no" dir="ltr">sealed<span class="devsite-syntax-w"> </span>class<span class="devsite-syntax-w"> </span>UiAction<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">    </span>...
<span class="devsite-syntax-w">    </span>data<span class="devsite-syntax-w"> </span>class<span class="devsite-syntax-w"> </span>Scroll(val<span class="devsite-syntax-w"> </span>currentQuery:<span class="devsite-syntax-w"> </span>String)<span class="devsite-syntax-w"> </span>:<span class="devsite-syntax-w"> </span>UiAction()
}
</code></pre></devsite-code>
<p>Notice that we removed all of the fields in the <code translate="no" dir="ltr">UiAction.Scroll</code> data class and replaced them with the single <code translate="no" dir="ltr">currentQuery</code> string. This lets us associate a scroll action with a particular query. We also delete the <code translate="no" dir="ltr">shouldFetchMore</code> extension because it is no longer used. This is also something that needs to be restored after process death, so we make sure we update the <code translate="no" dir="ltr">onCleared()</code> method in the <code translate="no" dir="ltr">SearchRepositoriesViewModel</code>:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Scalate Server Page"><code translate="no" dir="ltr">class<span class="devsite-syntax-w"> </span>SearchRepositoriesViewModel{
<span class="devsite-syntax-w">  </span>...
<span class="devsite-syntax-w">   </span>override<span class="devsite-syntax-w"> </span>fun<span class="devsite-syntax-w"> </span>onCleared()<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">        </span>savedStateHandle[LAST_SEARCH_QUERY]<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>state.value.query
<span class="devsite-syntax-w">        </span>savedStateHandle[LAST_QUERY_SCROLLED]<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>state.value.lastQueryScrolled
<span class="devsite-syntax-w">        </span>super.onCleared()
<span class="devsite-syntax-w">    </span>}
}

//<span class="devsite-syntax-w"> </span>This<span class="devsite-syntax-w"> </span>is<span class="devsite-syntax-w"> </span>outside<span class="devsite-syntax-w"> </span>the<span class="devsite-syntax-w"> </span>ViewModel<span class="devsite-syntax-w"> </span>class,<span class="devsite-syntax-w"> </span>but<span class="devsite-syntax-w"> </span>in<span class="devsite-syntax-w"> </span>the<span class="devsite-syntax-w"> </span>same<span class="devsite-syntax-w"> </span>file
private<span class="devsite-syntax-w"> </span>const<span class="devsite-syntax-w"> </span>val<span class="devsite-syntax-w"> </span>LAST_QUERY_SCROLLED:<span class="devsite-syntax-w"> </span>String<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>"last_query_scrolled"
</code></pre></devsite-code>
<p>This is also a good time to introduce the method that will actually create the <code translate="no" dir="ltr">pagingData</code> <code translate="no" dir="ltr">Flow</code> from the <code translate="no" dir="ltr">GithubRepository</code>:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Perl6"><code translate="no" dir="ltr"><span class="devsite-syntax-k">class</span> <span class="devsite-syntax-n">SearchRepositoriesViewModel</span>(
    ...
) : <span class="devsite-syntax-n">ViewModel</span>() {

    <span class="devsite-syntax-n">override</span> <span class="devsite-syntax-n">fun</span> <span class="devsite-syntax-n">onCleared</span>() {
        ...
    }

    <span class="devsite-syntax-nb">private</span> <span class="devsite-syntax-n">fun</span> <span class="devsite-syntax-n">searchRepo</span>(<span class="devsite-syntax-n">queryString:</span> <span class="devsite-syntax-n">String</span>): <span class="devsite-syntax-n">Flow&lt;PagingData&lt;Repo&gt;</span>&gt; =
        <span class="devsite-syntax-n">repository</span>.<span class="devsite-syntax-n">getSearchResultStream</span>(<span class="devsite-syntax-n">queryString</span>)
}
</code></pre></devsite-code>
<p><code translate="no" dir="ltr">Flow&lt;PagingData&gt;</code> has a handy <code translate="no" dir="ltr">cachedIn()</code> method that allows us to cache the content of a <code translate="no" dir="ltr">Flow&lt;PagingData&gt;</code> in a <code translate="no" dir="ltr">CoroutineScope</code>. Since we&#39;re in a <code translate="no" dir="ltr">ViewModel</code>, we will use the  <a href="https://developer.android.com/reference/kotlin/androidx/lifecycle/package-summary#(androidx.lifecycle.ViewModel).viewModelScope:kotlinx.coroutines.CoroutineScope" target="_blank"><code translate="no" dir="ltr">androidx.lifecycle.viewModelScope</code></a>.</p>
<aside class="special"><p><strong>Note:</strong> If you&#39;re doing any operations on the <code translate="no" dir="ltr">Flow</code>, like <code translate="no" dir="ltr">map</code> or <code translate="no" dir="ltr">filter</code>, make sure you call <code translate="no" dir="ltr">cachedIn</code> after you execute these operations to ensure you don&#39;t need to trigger them again. In other words, <code translate="no" dir="ltr">cachedIn</code> should be used as a terminal operator.</p>
</aside>
<p>Now, we can start  converting the <code translate="no" dir="ltr">accept</code> field in the ViewModel into a <code translate="no" dir="ltr">UiAction</code> stream. Replace the <code translate="no" dir="ltr">init</code> block of <code translate="no" dir="ltr">SearchRepositoriesViewModel</code> with the following:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Scalate Server Page"><code translate="no" dir="ltr">class<span class="devsite-syntax-w"> </span>SearchRepositoriesViewModel(
<span class="devsite-syntax-w">    </span>...
)<span class="devsite-syntax-w"> </span>:<span class="devsite-syntax-w"> </span>ViewModel()<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">    </span>...
<span class="devsite-syntax-w">    </span>init<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">        </span>val<span class="devsite-syntax-w"> </span>initialQuery:<span class="devsite-syntax-w"> </span>String<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>savedStateHandle.get(LAST_SEARCH_QUERY)<span class="devsite-syntax-w"> </span>?:<span class="devsite-syntax-w"> </span>DEFAULT_QUERY
<span class="devsite-syntax-w">        </span>val<span class="devsite-syntax-w"> </span>lastQueryScrolled:<span class="devsite-syntax-w"> </span>String<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>savedStateHandle.get(LAST_QUERY_SCROLLED)<span class="devsite-syntax-w"> </span>?:<span class="devsite-syntax-w"> </span>DEFAULT_QUERY
<span class="devsite-syntax-w">        </span>val<span class="devsite-syntax-w"> </span>actionStateFlow<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>MutableSharedFlow&lt;UiAction&gt;()
<span class="devsite-syntax-w">        </span>val<span class="devsite-syntax-w"> </span>searches<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>actionStateFlow
<span class="devsite-syntax-w">            </span>.filterIsInstance&lt;UiAction.Search&gt;()
<span class="devsite-syntax-w">            </span>.distinctUntilChanged()
<span class="devsite-syntax-w">            </span>.onStart<span class="devsite-syntax-w"> </span>{<span class="devsite-syntax-w"> </span>emit(UiAction.Search(query<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>initialQuery))<span class="devsite-syntax-w"> </span>}
<span class="devsite-syntax-w">        </span>val<span class="devsite-syntax-w"> </span>queriesScrolled<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>actionStateFlow
<span class="devsite-syntax-w">            </span>.filterIsInstance&lt;UiAction.Scroll&gt;()
<span class="devsite-syntax-w">            </span>.distinctUntilChanged()
<span class="devsite-syntax-w">            </span>//<span class="devsite-syntax-w"> </span>This<span class="devsite-syntax-w"> </span>is<span class="devsite-syntax-w"> </span>shared<span class="devsite-syntax-w"> </span>to<span class="devsite-syntax-w"> </span>keep<span class="devsite-syntax-w"> </span>the<span class="devsite-syntax-w"> </span>flow<span class="devsite-syntax-w"> </span>"hot"<span class="devsite-syntax-w"> </span>while<span class="devsite-syntax-w"> </span>caching<span class="devsite-syntax-w"> </span>the<span class="devsite-syntax-w"> </span>last<span class="devsite-syntax-w"> </span>query<span class="devsite-syntax-w"> </span>scrolled,
<span class="devsite-syntax-w">            </span>//<span class="devsite-syntax-w"> </span>otherwise<span class="devsite-syntax-w"> </span>each<span class="devsite-syntax-w"> </span>flatMapLatest<span class="devsite-syntax-w"> </span>invocation<span class="devsite-syntax-w"> </span>would<span class="devsite-syntax-w"> </span>lose<span class="devsite-syntax-w"> </span>the<span class="devsite-syntax-w"> </span>last<span class="devsite-syntax-w"> </span>query<span class="devsite-syntax-w"> </span>scrolled,
<span class="devsite-syntax-w">            </span>.shareIn(
<span class="devsite-syntax-w">                </span>scope<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>viewModelScope,
<span class="devsite-syntax-w">                </span>started<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>SharingStarted.WhileSubscribed(stopTimeoutMillis<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>5000),
<span class="devsite-syntax-w">                </span>replay<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>1
<span class="devsite-syntax-w">            </span>)
<span class="devsite-syntax-w">            </span>.onStart<span class="devsite-syntax-w"> </span>{<span class="devsite-syntax-w"> </span>emit(UiAction.Scroll(currentQuery<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>lastQueryScrolled))<span class="devsite-syntax-w"> </span>}
<span class="devsite-syntax-w">   </span>}
}
</code></pre></devsite-code>
<p>Let&#39;s go over the code snippet above. We start with two items, the <code translate="no" dir="ltr">initialQuery</code> <code translate="no" dir="ltr">String</code>, pulled from saved state or a default, along with <code translate="no" dir="ltr">lastQueryScrolled</code>, a  <code translate="no" dir="ltr">String</code> representing the last searched term where the user has interacted with the list. Next we begin to split the <code translate="no" dir="ltr">Flow</code> into specific <code translate="no" dir="ltr">UiAction</code> types:</p>
<ol type="1">
<li><code translate="no" dir="ltr">UiAction.Search</code> for each time the user enters a particular query.</li>
<li><code translate="no" dir="ltr">UiAction.Scroll</code> for each time the user scrolls the list with a particular query in focus.</li>
</ol>
<p>The <code translate="no" dir="ltr">UiAction.Scroll Flow</code> has some extra transformations applied to it. Let&#39;s go over them:</p>
<ol type="1">
<li><code translate="no" dir="ltr">shareIn</code>: This is needed because when this <code translate="no" dir="ltr">Flow</code> is ultimately consumed, it is consumed using a <code translate="no" dir="ltr">flatmapLatest</code> operator. Each time the upstream emits, <code translate="no" dir="ltr">flatmapLatest</code> will cancel the last <code translate="no" dir="ltr">Flow</code> it was operating on, and start working based on the new flow it was given. In our case, this would make us lose the value of the last query the user has scrolled through. So, we use the <code translate="no" dir="ltr">Flow</code> operator with a <code translate="no" dir="ltr">replay</code> value of 1 to cache the last value so that it isn&#39;t lost when a new query comes in.</li>
<li><code translate="no" dir="ltr">onStart</code>: Also used for caching. If the app was killed, but the user had already scrolled through a query, we don&#39;t want to scroll the list to the top causing them to lose their place again.</li>
</ol>
<aside class="special"><p><strong>Note:</strong> For more information on the <code translate="no" dir="ltr">shareIn</code> operator, check out this  <a href="https://medium.com/androiddevelopers/things-to-know-about-flows-sharein-and-statein-operators-20e6ccb2bc74" target="_blank">blog post</a>.</p>
</aside>
<p>There should still be compile errors because we have not defined the <code translate="no" dir="ltr">state</code>, <code translate="no" dir="ltr">pagingDataFlow</code> , and <code translate="no" dir="ltr">accept</code> fields yet. Let&#39;s fix that. With the transformations applied to each <code translate="no" dir="ltr">UiAction</code>, we can now use them to create flows for both our <code translate="no" dir="ltr">PagingData</code> and the <code translate="no" dir="ltr">UiState</code>.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Text only"><code translate="no" dir="ltr">init {
        ...
        pagingDataFlow = searches
            .flatMapLatest { searchRepo(queryString = it.query) }
            .cachedIn(viewModelScope)

        state = combine(
            searches,
            queriesScrolled,
            ::Pair
        ).map { (search, scroll) -&gt;
            UiState(
                query = search.query,
                lastQueryScrolled = scroll.currentQuery,
                // If the search query matches the scroll query, the user has scrolled
                hasNotScrolledForCurrentSearch = search.query != scroll.currentQuery
            )
        }
            .stateIn(
                scope = viewModelScope,
                started = SharingStarted.WhileSubscribed(stopTimeoutMillis = 5000),
                initialValue = UiState()
            )

        accept = { action -&gt;
            viewModelScope.launch { actionStateFlow.emit(action) }
        }
    }
}
</code></pre></devsite-code>
<p>We use the <code translate="no" dir="ltr">flatmapLatest</code> operator on the <code translate="no" dir="ltr">searches</code> flow because each new search query requires a new <code translate="no" dir="ltr">Pager</code> to be created. Next, we apply the <code translate="no" dir="ltr">cachedIn</code> operator to the <code translate="no" dir="ltr">PagingData</code> flow to keep it active within the <code translate="no" dir="ltr">viewModelScope</code> and assign the result to the <code translate="no" dir="ltr">pagingDataFlow</code> field. On the <code translate="no" dir="ltr">UiState</code> side of things, we use the combine operator to populate the required <code translate="no" dir="ltr">UiState</code> fields and assign the resulting <code translate="no" dir="ltr">Flow</code> to the exposed <code translate="no" dir="ltr">state</code> field. We also define <code translate="no" dir="ltr">accept</code> as a lambda that launches a suspending function that feeds our state machine.</p>
<p>That&#39;s it! We now have a functional <code translate="no" dir="ltr">ViewModel</code> from both a literal and reactive programming point of view!</p>


        </google-codelab-step>
      
        <google-codelab-step label="Make the Adapter work with PagingData" duration="1" step="7">
          
          <h2 class="step-title" id="7" data-text="Make the Adapter work with PagingData" tabindex="-1">
              8. Make the Adapter work with PagingData
          </h2>
          <p>To bind a <code translate="no" dir="ltr">PagingData</code> to a <code translate="no" dir="ltr">RecyclerView</code>, use a <code translate="no" dir="ltr">PagingDataAdapter</code>. The <code translate="no" dir="ltr">PagingDataAdapter</code> gets notified whenever the <code translate="no" dir="ltr">PagingData</code> content is loaded and then it signals the <code translate="no" dir="ltr">RecyclerView</code> to update.</p>
<h2 is-upgraded id="update-the-ui.reposadapter-to-work-with-a-pagingdata-stream:" data-text="Update the ui.ReposAdapter to work with a PagingData stream:" tabindex="-1">Update the ui.<code translate="no" dir="ltr">ReposAdapter</code> to work with a <code translate="no" dir="ltr">PagingData</code> stream:</h2>
<ul>
<li>Right now, <code translate="no" dir="ltr">ReposAdapter</code> implements <code translate="no" dir="ltr">ListAdapter</code>. Make it implement <code translate="no" dir="ltr">PagingDataAdapter</code> instead. The rest of the class body remains unchanged:</li>
</ul>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Perl6"><code translate="no" dir="ltr"><span class="devsite-syntax-k">class</span> <span class="devsite-syntax-n">ReposAdapter</span> : <span class="devsite-syntax-n">PagingDataAdapter&lt;Repo</span>, <span class="devsite-syntax-n">RepoViewHolder</span>&gt;(<span class="devsite-syntax-n">REPO_COMPARATOR</span>) {
// <span class="devsite-syntax-n">body</span> <span class="devsite-syntax-k">is</span> <span class="devsite-syntax-n">unchanged</span>
}
</code></pre></devsite-code>
<p>We&#39;ve been making a lot of changes so far, but now we&#39;re just one step away from being able to run the app—we just need to connect the UI!</p>


        </google-codelab-step>
      
        <google-codelab-step label="Trigger network updates" duration="7" step="8">
          
          <h2 class="step-title" id="8" data-text="Trigger network updates" tabindex="-1">
              9. Trigger network updates
          </h2>
          <h2 is-upgraded id="replace-livedata-with-flow" data-text="Replace LiveData with Flow" tabindex="-1"><strong>Replace LiveData with Flow</strong></h2>
<p>Let&#39;s update <code translate="no" dir="ltr">SearchRepositoriesActivity</code> to work with Paging 3. To be able to work with <code translate="no" dir="ltr">Flow&lt;PagingData&gt;</code>, we need to launch a new coroutine. We will do that in the <code translate="no" dir="ltr">lifecycleScope</code>, which is responsible for canceling the request when the activity is recreated.</p>
<p>Fortunately, we needn&#39;t change much. Rather than <code translate="no" dir="ltr">observe()</code> a <code translate="no" dir="ltr">LiveData</code>, we&#39;ll instead <code translate="no" dir="ltr">launch()</code> a <code translate="no" dir="ltr">coroutine</code> and <code translate="no" dir="ltr">collect()</code> a <code translate="no" dir="ltr">Flow</code>. The <code translate="no" dir="ltr">UiState</code> will be combined with the <code translate="no" dir="ltr">PagingAdapter</code> <code translate="no" dir="ltr">LoadState</code> <code translate="no" dir="ltr">Flow</code> to give us the guarantee that we will not scroll the list back up to the top with new emissions of <code translate="no" dir="ltr">PagingData</code> if the user has already scrolled.</p>
<p>First off, as we are now returning state as a <code translate="no" dir="ltr">StateFlow</code> instead of a <code translate="no" dir="ltr">LiveData</code>, all references in the <code translate="no" dir="ltr">Activity</code> to <code translate="no" dir="ltr">LiveData</code> should be replaced with a <code translate="no" dir="ltr">StateFlow</code>, making sure to add an argument for the <code translate="no" dir="ltr">pagingData</code> <code translate="no" dir="ltr">Flow</code> as well. The first place is in the <code translate="no" dir="ltr">bindState</code> method:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Text only"><code translate="no" dir="ltr">   private fun ActivitySearchRepositoriesBinding.bindState(
        uiState: StateFlow&lt;UiState&gt;,
        pagingData: Flow&lt;PagingData&lt;Repo&gt;&gt;,
        uiActions: (UiAction) -&gt; Unit
    ) {
        ...
    }
</code></pre></devsite-code>
<p>This change has a cascading effect, as we now have to update <code translate="no" dir="ltr">bindSearch()</code> and <code translate="no" dir="ltr">bindList()</code>. <code translate="no" dir="ltr">bindSearch()</code> has the smallest change, so let&#39;s start there:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Text only"><code translate="no" dir="ltr">   private fun ActivitySearchRepositoriesBinding.bindSearch(
        uiState: StateFlow&lt;UiState&gt;,
        onQueryChanged: (UiAction.Search) -&gt; Unit
    ) {
        searchRepo.setOnEditorActionListener {...}
        searchRepo.setOnKeyListener {...}

        lifecycleScope.launch {
            uiState
                .map { it.query }
                .distinctUntilChanged()
                .collect(searchRepo::setText)
        }
    }
</code></pre></devsite-code>
<p>The major change here is the need to launch a coroutine, and collect the query change from the <code translate="no" dir="ltr">UiState</code> <code translate="no" dir="ltr">Flow</code>.</p>
<aside class="warning"><p>Sometimes, the collect function might not be automatically detected by Android Studio. In this case, make sure you import <code translate="no" dir="ltr">kotlinx.coroutines.flow.collect</code>.</p>
</aside>
<h2 is-upgraded id="address-the-scrolling-issue-and-bind-data" data-text="Address the scrolling issue and bind data" tabindex="-1">Address the scrolling issue and bind data</h2>
<p>Now for the scrolling part. First, like the last two changes, we replace the <code translate="no" dir="ltr">LiveData</code> with a <code translate="no" dir="ltr">StateFlow</code> and add an argument for the <code translate="no" dir="ltr">pagingData</code> <code translate="no" dir="ltr">Flow</code>. With that done, we can move on to the scroll listener. Notice that previously, we used an <code translate="no" dir="ltr">OnScrollListener</code> attached to the <code translate="no" dir="ltr">RecyclerView</code> to know when to trigger more data. The Paging library handles list scrolling for us, but we still need the <code translate="no" dir="ltr">OnScrollListener</code> as a signal for if the user has scrolled the list for the current query. In the <code translate="no" dir="ltr">bindList()</code> method, let&#39;s replace <code translate="no" dir="ltr">setupScrollListener()</code> with an inline <code translate="no" dir="ltr">RecyclerView.OnScrollListener</code>. We also delete the <code translate="no" dir="ltr">setupScrollListener()</code> method entirely.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Text only"><code translate="no" dir="ltr">   private fun ActivitySearchRepositoriesBinding.bindList(
        repoAdapter: ReposAdapter,
        uiState: StateFlow&lt;UiState&gt;,
        pagingData: Flow&lt;PagingData&lt;Repo&gt;&gt;,
        onScrollChanged: (UiAction.Scroll) -&gt; Unit
    ) {
        list.addOnScrollListener(object : RecyclerView.OnScrollListener() {
            override fun onScrolled(recyclerView: RecyclerView, dx: Int, dy: Int) {
                if (dy != 0) onScrollChanged(UiAction.Scroll(currentQuery = uiState.value.query))
            }
        })
        // the rest of the code is unchanged
    }
</code></pre></devsite-code>
<p>Next, we set up the pipeline to create a <code translate="no" dir="ltr">shouldScrollToTop</code> boolean flag. With that done, we have two flows we can <code translate="no" dir="ltr">collect</code> from: The <code translate="no" dir="ltr">PagingData</code> <code translate="no" dir="ltr">Flow</code> and the <code translate="no" dir="ltr">shouldScrollToTop</code> <code translate="no" dir="ltr">Flow</code>.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="GDScript"><code translate="no" dir="ltr"><span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">private</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ActivitySearchRepositoriesBinding</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">bindList</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">repoAdapter</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ReposAdapter</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">uiState</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">StateFlow&lt;UiState&gt;</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">pagingData</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Flow&lt;PagingData&lt;Repo&gt;</span>&gt;<span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">onScrollChanged</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">UiAction</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Scroll</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Unit</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">list</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">addOnScrollListener</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-o">...</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">notLoading</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">repoAdapter</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">loadStateFlow</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Only</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">emit</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">when</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">REFRESH</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadState</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">for</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">paging</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">source</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">changes</span><span class="devsite-syntax-o">.</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">distinctUntilChangedBy</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">it</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">source</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Only</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">react</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">to</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">cases</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">where</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">REFRESH</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">completes</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">e</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">NotLoading</span><span class="devsite-syntax-o">.</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">map</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">it</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">source</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">NotLoading</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">}</span>

<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">hasNotScrolledForCurrentSearch</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">uiState</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">map</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">it</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">hasNotScrolledForCurrentSearch</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">distinctUntilChanged</span><span class="devsite-syntax-p">()</span>

<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">shouldScrollToTop</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">combine</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">notLoading</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">hasNotScrolledForCurrentSearch</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">Boolean</span><span class="devsite-syntax-p">::</span><span class="devsite-syntax-ow">and</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">distinctUntilChanged</span><span class="devsite-syntax-p">()</span>

<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">lifecycleScope</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">launch</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">pagingData</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">collectLatest</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">repoAdapter</span><span class="devsite-syntax-p">::</span><span class="devsite-syntax-n">submitData</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">}</span>

<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">lifecycleScope</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">launch</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">shouldScrollToTop</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">collect</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">shouldScroll</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">shouldScroll</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">list</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">scrollToPosition</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<p>In the above, we use <code translate="no" dir="ltr">collectLatest</code> on the <code translate="no" dir="ltr">pagingData</code> <code translate="no" dir="ltr">Flow</code> so we can cancel collection on previous <code translate="no" dir="ltr">pagingData</code> emissions on new emissions of <code translate="no" dir="ltr">pagingData</code>. For the <code translate="no" dir="ltr">shouldScrollToTop</code> flag, the emissions of <code translate="no" dir="ltr">PagingDataAdapter.loadStateFlow</code> are synchronous with what is displayed in the UI, so it&#39;s safe to immediately call <code translate="no" dir="ltr">list.scrollToPosition(0)</code> as soon as the boolean flag emitted is true.</p>
<p>The type in a LoadStateFlow is a <code translate="no" dir="ltr">CombinedLoadStates</code> object.</p>
<p><code translate="no" dir="ltr">CombinedLoadStates</code> allows us to get the load state for the three different types of load operations:</p>
<ul>
<li><code translate="no" dir="ltr">CombinedLoadStates.refresh</code> -  represents the load state for loading the <code translate="no" dir="ltr">PagingData</code> for the first time.</li>
<li><code translate="no" dir="ltr">CombinedLoadStates.prepend</code> - represents the load state for loading data at the start of the list.</li>
<li><code translate="no" dir="ltr">CombinedLoadStates.append</code> - represents the load state for loading data at the end of the list.</li>
</ul>
<p>In our case, we want to reset the scroll position only when the refresh has completed i.e. <code translate="no" dir="ltr">LoadState</code> is <code translate="no" dir="ltr">refresh</code>, <code translate="no" dir="ltr">NotLoading</code>.</p>
<p>We can now remove <code translate="no" dir="ltr">binding.list.scrollToPosition(0)</code> from <code translate="no" dir="ltr">updateRepoListFromInput()</code>.</p>
<p>With all that done, your activity should look like:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Transact-SQL"><code translate="no" dir="ltr"><span class="devsite-syntax-k">class</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">SearchRepositoriesActivity</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">AppCompatActivity</span><span class="devsite-syntax-p">()</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">override</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">onCreate</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-nl">savedInstanceState</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Bundle</span><span class="devsite-syntax-vm">?</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">super</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">onCreate</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">savedInstanceState</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">binding</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ActivitySearchRepositoriesBinding</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">inflate</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">layoutInflater</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">view</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">binding</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">root</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">setContentView</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-k">view</span><span class="devsite-syntax-p">)</span>

<span class="devsite-syntax-w">        </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">get</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">view</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">model</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">viewModel</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ViewModelProvider</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">this</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Injection</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">provideViewModelFactory</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">owner</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">this</span><span class="devsite-syntax-p">))</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-k">get</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-nl">SearchRepositoriesViewModel</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-k">class</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">java</span><span class="devsite-syntax-p">)</span>

<span class="devsite-syntax-w">        </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">add</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">dividers</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-ow">between</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RecyclerView</span><span class="devsite-syntax-err">'</span><span class="devsite-syntax-n">s</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">row</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">items</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">decoration</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">DividerItemDecoration</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">this</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">DividerItemDecoration</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">VERTICAL</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">binding</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">list</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">addItemDecoration</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">decoration</span><span class="devsite-syntax-p">)</span>

<span class="devsite-syntax-w">        </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">bind</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">state</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">binding</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">bindState</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">uiState</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">viewModel</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-k">state</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">pagingData</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">viewModel</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">pagingDataFlow</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">uiActions</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">viewModel</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">accept</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-err">}</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-cm">/**</span>
<span class="devsite-syntax-cm">     * Binds the [UiState] provided  by the [SearchRepositoriesViewModel] to the UI,</span>
<span class="devsite-syntax-cm">     * and allows the UI to feed back user actions to it.</span>
<span class="devsite-syntax-cm">     */</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">private</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ActivitySearchRepositoriesBinding</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">bindState</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-nl">uiState</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">StateFlow&lt;UiState&gt;</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-nl">pagingData</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Flow&lt;PagingData&lt;Repo&gt;</span>&gt;<span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-nl">uiActions</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">UiAction</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Unit</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">repoAdapter</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ReposAdapter</span><span class="devsite-syntax-p">()</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">list</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">adapter</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">repoAdapter</span>

<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">bindSearch</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">uiState</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">uiState</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">onQueryChanged</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">uiActions</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">bindList</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">repoAdapter</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">repoAdapter</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">uiState</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">uiState</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">pagingData</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">pagingData</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">onScrollChanged</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">uiActions</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-err">}</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">private</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ActivitySearchRepositoriesBinding</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">bindSearch</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-nl">uiState</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">StateFlow&lt;UiState&gt;</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-nl">onQueryChanged</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">UiAction</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-k">Search</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Unit</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">searchRepo</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">setOnEditorActionListener</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">_</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">actionId</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">_</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">actionId</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">==</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">EditorInfo</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">IME_ACTION_GO</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">updateRepoListFromInput</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">onQueryChanged</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-k">true</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-err">}</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">else</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-k">false</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-err">}</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-err">}</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">searchRepo</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">setOnKeyListener</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">_</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">keyCode</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">event</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">event</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-k">action</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">==</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">KeyEvent</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">ACTION_DOWN</span><span class="devsite-syntax-w"> &amp;&amp; </span><span class="devsite-syntax-n">keyCode</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">==</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">KeyEvent</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">KEYCODE_ENTER</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">updateRepoListFromInput</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">onQueryChanged</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-k">true</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-err">}</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">else</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-k">false</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-err">}</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-err">}</span>

<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">lifecycleScope</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">launch</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">uiState</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-k">map</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">it</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">query</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">}</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">distinctUntilChanged</span><span class="devsite-syntax-p">()</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-k">collect</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-nl">searchRepo</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-n">setText</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-err">}</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-err">}</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">private</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ActivitySearchRepositoriesBinding</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">updateRepoListFromInput</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-nl">onQueryChanged</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">UiAction</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-k">Search</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Unit</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">searchRepo</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-nc">text</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-k">trim</span><span class="devsite-syntax-p">().</span><span class="devsite-syntax-n">let</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">it</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">isNotEmpty</span><span class="devsite-syntax-p">())</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">list</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">scrollToPosition</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">onQueryChanged</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">UiAction</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-k">Search</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">query</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">it</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">toString</span><span class="devsite-syntax-p">()))</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-err">}</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-err">}</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-err">}</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">private</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ActivitySearchRepositoriesBinding</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">bindList</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-nl">repoAdapter</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ReposAdapter</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-nl">uiState</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">StateFlow&lt;UiState&gt;</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-nl">pagingData</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Flow&lt;PagingData&lt;Repo&gt;</span>&gt;<span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-nl">onScrollChanged</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">UiAction</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-k">Scroll</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Unit</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">list</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">addOnScrollListener</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-k">object</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RecyclerView</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">OnScrollListener</span><span class="devsite-syntax-p">()</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">override</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">onScrolled</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-nl">recyclerView</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RecyclerView</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nl">dx</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">Int</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nl">dy</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">Int</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">dy</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">!=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">onScrollChanged</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">UiAction</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-k">Scroll</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">currentQuery</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">uiState</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-k">value</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">query</span><span class="devsite-syntax-p">))</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-err">}</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-err">}</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">notLoading</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">repoAdapter</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">loadStateFlow</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">Only</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">emit</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">when</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">REFRESH</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadState</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">for</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">paging</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">source</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">changes</span><span class="devsite-syntax-p">.</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">distinctUntilChangedBy</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">it</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">source</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">}</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">Only</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">react</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">to</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">cases</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">where</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">REFRESH</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">completes</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">e</span><span class="devsite-syntax-p">.,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">NotLoading</span><span class="devsite-syntax-p">.</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-k">map</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">it</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">source</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadState</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">NotLoading</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">}</span>

<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">hasNotScrolledForCurrentSearch</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">uiState</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-k">map</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">it</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">hasNotScrolledForCurrentSearch</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">}</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">distinctUntilChanged</span><span class="devsite-syntax-p">()</span>

<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">shouldScrollToTop</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">combine</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">notLoading</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">hasNotScrolledForCurrentSearch</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-k">Boolean</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-ow">and</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">distinctUntilChanged</span><span class="devsite-syntax-p">()</span>

<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">lifecycleScope</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">launch</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">pagingData</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">collectLatest</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-nl">repoAdapter</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-n">submitData</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-err">}</span>

<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">lifecycleScope</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">launch</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">shouldScrollToTop</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-k">collect</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">shouldScroll</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">shouldScroll</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">list</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">scrollToPosition</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-err">}</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-err">}</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-err">}</span>
<span class="devsite-syntax-err">}</span>
</code></pre></devsite-code>
<p>Our app should compile and run, but without the loading state footer and the <code translate="no" dir="ltr">Toast</code> that displays on error. In the next step, we will see how to display the loading state footer.</p>


        </google-codelab-step>
      
        <google-codelab-step label="Displaying the loading state in a footer" duration="8" step="9">
          
          <h2 class="step-title" id="9" data-text="Displaying the loading state in a footer" tabindex="-1">
              10. Displaying the loading state in a footer
          </h2>
          <p>In our app, we want to be able to display a footer based on the load status: when the list is loading, we want to show a progress spinner. In case of an error, we want to show the error and a retry button.</p>
<p class="image-container"><img alt="3f6f2cd47b55de92.png" style="width: 236.50px" src="/static/codelabs/android-paging/img/3f6f2cd47b55de92.png" srcset="https://developer.android.com/static/codelabs/android-paging/img/3f6f2cd47b55de92_36.png 36w,https://developer.android.com/static/codelabs/android-paging/img/3f6f2cd47b55de92_48.png 48w,https://developer.android.com/static/codelabs/android-paging/img/3f6f2cd47b55de92_72.png 72w,https://developer.android.com/static/codelabs/android-paging/img/3f6f2cd47b55de92_96.png 96w,https://developer.android.com/static/codelabs/android-paging/img/3f6f2cd47b55de92_480.png 480w,https://developer.android.com/static/codelabs/android-paging/img/3f6f2cd47b55de92_720.png 720w,https://developer.android.com/static/codelabs/android-paging/img/3f6f2cd47b55de92_856.png 856w,https://developer.android.com/static/codelabs/android-paging/img/3f6f2cd47b55de92_960.png 960w,https://developer.android.com/static/codelabs/android-paging/img/3f6f2cd47b55de92_1440.png 1440w,https://developer.android.com/static/codelabs/android-paging/img/3f6f2cd47b55de92_1920.png 1920w,https://developer.android.com/static/codelabs/android-paging/img/3f6f2cd47b55de92_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px">    <img alt="661da51b58c32b8c.png" style="width: 236.99px" src="/static/codelabs/android-paging/img/661da51b58c32b8c.png" srcset="https://developer.android.com/static/codelabs/android-paging/img/661da51b58c32b8c_36.png 36w,https://developer.android.com/static/codelabs/android-paging/img/661da51b58c32b8c_48.png 48w,https://developer.android.com/static/codelabs/android-paging/img/661da51b58c32b8c_72.png 72w,https://developer.android.com/static/codelabs/android-paging/img/661da51b58c32b8c_96.png 96w,https://developer.android.com/static/codelabs/android-paging/img/661da51b58c32b8c_480.png 480w,https://developer.android.com/static/codelabs/android-paging/img/661da51b58c32b8c_720.png 720w,https://developer.android.com/static/codelabs/android-paging/img/661da51b58c32b8c_856.png 856w,https://developer.android.com/static/codelabs/android-paging/img/661da51b58c32b8c_960.png 960w,https://developer.android.com/static/codelabs/android-paging/img/661da51b58c32b8c_1440.png 1440w,https://developer.android.com/static/codelabs/android-paging/img/661da51b58c32b8c_1920.png 1920w,https://developer.android.com/static/codelabs/android-paging/img/661da51b58c32b8c_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>The header/footer that we need to build follows the idea of a list that needs to be appended either at the beginning (as a header) or at the end (as a footer) of the actual list of items we&#39;re displaying. The header/footer is a list with only one element: a view that displays a progress bar or an error with a retry button, based on the Paging <code translate="no" dir="ltr">LoadState</code>.</p>
<p>As displaying a header/footer based on the loading state and implementing a retry mechanism are common tasks, the Paging 3 API helps us with both of these.</p>
<p>For <strong>header/footer implementation</strong> we&#39;ll use a <code translate="no" dir="ltr">LoadStateAdapter</code>. This implementation of <code translate="no" dir="ltr">RecyclerView.Adapter</code> is automatically notified of changes in load state. It makes sure that only <code translate="no" dir="ltr">Loading</code> and <code translate="no" dir="ltr">Error</code> states lead to items being displayed and notifies the <code translate="no" dir="ltr">RecyclerView</code> when an item is removed, inserted, or changed, depending on the <code translate="no" dir="ltr">LoadState</code>.</p>
<p>For the <strong>retry mechanism</strong> we use <code translate="no" dir="ltr">adapter.retry()</code>. Under the hood, this method ends up calling your <code translate="no" dir="ltr">PagingSource</code> implementation for the right page. The response will be automatically propagated via <code translate="no" dir="ltr">Flow&lt;PagingData&gt;</code>.</p>
<p>Let&#39;s see what our header/footer implementation looks like!</p>
<p>Like with any list, we have 3 files to create:</p>
<ul>
<li><strong>The layout file</strong> containing the UI elements for displaying progress, the error and the retry button</li>
<li><strong>The</strong> ﻿**<code translate="no" dir="ltr">ViewHolder</code>** **file** making the UI items visible based on the Paging <code translate="no" dir="ltr">LoadState</code></li>
<li><strong>The adapter file</strong> defining how to create and bind the <code translate="no" dir="ltr">ViewHolder</code>. Instead of extending a <code translate="no" dir="ltr">RecyclerView.Adapter</code>, we will extend <strong><code translate="no" dir="ltr">LoadStateAdapter</code></strong> from Paging 3.</li>
</ul>
<h2 is-upgraded id="create-the-view-layout" data-text="Create the view layout" tabindex="-1"><strong>Create the view layout</strong></h2>
<p>Create the <code translate="no" dir="ltr">repos_load_state_footer_view_item</code> layout for our repo load state. It should have a <code translate="no" dir="ltr">ProgressBar</code>, a <code translate="no" dir="ltr">TextView</code> (to display the error), and a retry <code translate="no" dir="ltr">Button</code>. The necessary strings and dimensions are already declared in the project.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="GDScript"><code translate="no" dir="ltr">&lt;<span class="devsite-syntax-err">?</span><span class="devsite-syntax-n">xml</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">version</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"1.0"</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">encoding</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"utf-8"</span><span class="devsite-syntax-err">?</span>&gt;
&lt;<span class="devsite-syntax-n">LinearLayout</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">xmlns</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"http://schemas.android.com/apk/res/android"</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_width</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"match_parent"</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_height</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"wrap_content"</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">xmlns</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">tools</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"http://schemas.android.com/tools"</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">orientation</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"vertical"</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">padding</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"8dp"</span>&gt;
<span class="devsite-syntax-w">    </span>&lt;<span class="devsite-syntax-n">TextView</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">id</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"@+id/error_msg"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">textColor</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"?android:textColorPrimary"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">textSize</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"@dimen/error_text_size"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_width</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"wrap_content"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_height</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"wrap_content"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_gravity</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"center"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">textAlignment</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"center"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">tools</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">text</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"Timeout"</span><span class="devsite-syntax-o">/</span>&gt;
<span class="devsite-syntax-w">    </span>&lt;<span class="devsite-syntax-n">ProgressBar</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">id</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"@+id/progress_bar"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">style</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"?android:attr/progressBarStyle"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_width</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"match_parent"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_height</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"wrap_content"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_gravity</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"center"</span><span class="devsite-syntax-o">/</span>&gt;
<span class="devsite-syntax-w">    </span>&lt;<span class="devsite-syntax-n">Button</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">id</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"@+id/retry_button"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_width</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"wrap_content"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_height</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"wrap_content"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_gravity</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"center"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">text</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"@string/retry"</span><span class="devsite-syntax-o">/</span>&gt;
&lt;<span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">LinearLayout</span>&gt;
</code></pre></devsite-code>
<h2 is-upgraded id="create-the-viewholder" data-text="Create the ViewHolder" tabindex="-1">Create the <strong><code translate="no" dir="ltr">ViewHolder</code></strong></h2>
<p>Create a new <code translate="no" dir="ltr">ViewHolder</code> called <code translate="no" dir="ltr">ReposLoadStateViewHolder</code> in the <code translate="no" dir="ltr">ui</code> folder**.** It should receive a retry function as a parameter, to be called when the retry button is pressed. Create a <code translate="no" dir="ltr">bind()</code> function that receives the <code translate="no" dir="ltr">LoadState</code> as a parameter and sets the visibility of each view depending on the <code translate="no" dir="ltr">LoadState</code>. An implementation of <code translate="no" dir="ltr">ReposLoadStateViewHolder</code> using <code translate="no" dir="ltr">ViewBinding</code> looks like this:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Scalate Server Page"><code translate="no" dir="ltr">class<span class="devsite-syntax-w"> </span>ReposLoadStateViewHolder(
<span class="devsite-syntax-w">        </span>private<span class="devsite-syntax-w"> </span>val<span class="devsite-syntax-w"> </span>binding:<span class="devsite-syntax-w"> </span>ReposLoadStateFooterViewItemBinding,
<span class="devsite-syntax-w">        </span>retry:<span class="devsite-syntax-w"> </span>()<span class="devsite-syntax-w"> </span>-&gt;<span class="devsite-syntax-w"> </span>Unit
)<span class="devsite-syntax-w"> </span>:<span class="devsite-syntax-w"> </span>RecyclerView.ViewHolder(binding.root)<span class="devsite-syntax-w"> </span>{

<span class="devsite-syntax-w">    </span>init<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">        </span>binding.retryButton.setOnClickListener<span class="devsite-syntax-w"> </span>{<span class="devsite-syntax-w"> </span>retry.invoke()<span class="devsite-syntax-w"> </span>}
<span class="devsite-syntax-w">    </span>}

<span class="devsite-syntax-w">    </span>fun<span class="devsite-syntax-w"> </span>bind(loadState:<span class="devsite-syntax-w"> </span>LoadState)<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">        </span>if<span class="devsite-syntax-w"> </span>(loadState<span class="devsite-syntax-w"> </span>is<span class="devsite-syntax-w"> </span>LoadState.Error)<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">            </span>binding.errorMsg.text<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>loadState.error.localizedMessage
<span class="devsite-syntax-w">        </span>}
<span class="devsite-syntax-w">        </span>binding.progressBar.isVisible<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>loadState<span class="devsite-syntax-w"> </span>is<span class="devsite-syntax-w"> </span>LoadState.Loading
<span class="devsite-syntax-w">        </span>binding.retryButton.isVisible<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>loadState<span class="devsite-syntax-w"> </span>is<span class="devsite-syntax-w"> </span>LoadState.Error
<span class="devsite-syntax-w">        </span>binding.errorMsg.isVisible<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>loadState<span class="devsite-syntax-w"> </span>is<span class="devsite-syntax-w"> </span>LoadState.Error
<span class="devsite-syntax-w">    </span>}

<span class="devsite-syntax-w">    </span>companion<span class="devsite-syntax-w"> </span>object<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">        </span>fun<span class="devsite-syntax-w"> </span>create(parent:<span class="devsite-syntax-w"> </span>ViewGroup,<span class="devsite-syntax-w"> </span>retry:<span class="devsite-syntax-w"> </span>()<span class="devsite-syntax-w"> </span>-&gt;<span class="devsite-syntax-w"> </span>Unit):<span class="devsite-syntax-w"> </span>ReposLoadStateViewHolder<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">            </span>val<span class="devsite-syntax-w"> </span>view<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>LayoutInflater.from(parent.context)
<span class="devsite-syntax-w">                    </span>.inflate(R.layout.repos_load_state_footer_view_item,<span class="devsite-syntax-w"> </span>parent,<span class="devsite-syntax-w"> </span>false)
<span class="devsite-syntax-w">            </span>val<span class="devsite-syntax-w"> </span>binding<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>ReposLoadStateFooterViewItemBinding.bind(view)
<span class="devsite-syntax-w">            </span>return<span class="devsite-syntax-w"> </span>ReposLoadStateViewHolder(binding,<span class="devsite-syntax-w"> </span>retry)
<span class="devsite-syntax-w">        </span>}
<span class="devsite-syntax-w">    </span>}
}
</code></pre></devsite-code>
<h2 is-upgraded id="create-the-loadstateadapter" data-text="Create the LoadStateAdapter" tabindex="-1">Create the <code translate="no" dir="ltr">LoadStateAdapter</code></h2>
<p>Create a <code translate="no" dir="ltr">ReposLoadStateAdapter</code> that extends <code translate="no" dir="ltr">LoadStateAdapter</code> in the <code translate="no" dir="ltr">ui</code> folder as well. The adapter should receive the retry function as a parameter, since the retry function will be passed to the <code translate="no" dir="ltr">ViewHolder</code> when constructed.</p>
<p>As with any <code translate="no" dir="ltr">Adapter</code>, we need to implement the <code translate="no" dir="ltr">onBind()</code> and <code translate="no" dir="ltr">onCreate()</code> methods. <code translate="no" dir="ltr">LoadStateAdapter</code> makes it easier as it passes the <code translate="no" dir="ltr">LoadState</code> in both of these functions. In <code translate="no" dir="ltr">onBindViewHolder()</code>, bind your <code translate="no" dir="ltr">ViewHolder</code>. In <code translate="no" dir="ltr">onCreateViewHolder()</code>, define how to create the <code translate="no" dir="ltr">ReposLoadStateViewHolder</code> based on the parent <code translate="no" dir="ltr">ViewGroup</code> and the retry function:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Scalate Server Page"><code translate="no" dir="ltr">class<span class="devsite-syntax-w"> </span>ReposLoadStateAdapter(private<span class="devsite-syntax-w"> </span>val<span class="devsite-syntax-w"> </span>retry:<span class="devsite-syntax-w"> </span>()<span class="devsite-syntax-w"> </span>-&gt;<span class="devsite-syntax-w"> </span>Unit)<span class="devsite-syntax-w"> </span>:<span class="devsite-syntax-w"> </span>LoadStateAdapter&lt;ReposLoadStateViewHolder&gt;()<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">    </span>override<span class="devsite-syntax-w"> </span>fun<span class="devsite-syntax-w"> </span>onBindViewHolder(holder:<span class="devsite-syntax-w"> </span>ReposLoadStateViewHolder,<span class="devsite-syntax-w"> </span>loadState:<span class="devsite-syntax-w"> </span>LoadState)<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">        </span>holder.bind(loadState)
<span class="devsite-syntax-w">    </span>}

<span class="devsite-syntax-w">    </span>override<span class="devsite-syntax-w"> </span>fun<span class="devsite-syntax-w"> </span>onCreateViewHolder(parent:<span class="devsite-syntax-w"> </span>ViewGroup,<span class="devsite-syntax-w"> </span>loadState:<span class="devsite-syntax-w"> </span>LoadState):<span class="devsite-syntax-w"> </span>ReposLoadStateViewHolder<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">        </span>return<span class="devsite-syntax-w"> </span>ReposLoadStateViewHolder.create(parent,<span class="devsite-syntax-w"> </span>retry)
<span class="devsite-syntax-w">    </span>}
}
</code></pre></devsite-code>
<p><strong>Bind the footer adapter with the list</strong></p>
<p>Now that we have all of the elements of our footer, let&#39;s bind them to our list. To do this, the <code translate="no" dir="ltr">PagingDataAdapter</code> has 3 useful methods:</p>
<ul>
<li><code translate="no" dir="ltr">withLoadStateHeader</code> - if we only want to display a header—this should be used when your list only supports adding items at the beginning of the list.</li>
<li><code translate="no" dir="ltr">withLoadStateFooter</code> - if we only want to display a footer—this should be used when your list only supports adding items at the end of the list.</li>
<li><code translate="no" dir="ltr">withLoadStateHeaderAndFooter</code>—if we want to display a header and a footer - if the list can be paged in both directions.</li>
</ul>
<p>Update the <code translate="no" dir="ltr">ActivitySearchRepositoriesBinding.bindState()</code> method and call <code translate="no" dir="ltr">withLoadStateHeaderAndFooter()</code> on the adapter. As a retry function, we can call <code translate="no" dir="ltr">adapter.retry()</code>.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Text only"><code translate="no" dir="ltr">   private fun ActivitySearchRepositoriesBinding.bindState(
        uiState: StateFlow&lt;UiState&gt;,
        pagingData: Flow&lt;PagingData&lt;Repo&gt;&gt;,
        uiActions: (UiAction) -&gt; Unit
    ) {
        val repoAdapter = ReposAdapter()
        list.adapter = repoAdapter.withLoadStateHeaderAndFooter(
            header = ReposLoadStateAdapter { repoAdapter.retry() },
            footer = ReposLoadStateAdapter { repoAdapter.retry() }
        )
        ...
    }
</code></pre></devsite-code>
<p>Since we have an infinite scrolling list, one easy way to get to see the footer is by putting your phone or emulator in airplane mode and scrolling until the end of the list.</p>
<p>Let&#39;s run the app!</p>


        </google-codelab-step>
      
        <google-codelab-step label="Displaying the loading state in Activity" duration="5" step="10">
          
          <h2 class="step-title" id="10" data-text="Displaying the loading state in Activity" tabindex="-1">
              11. Displaying the loading state in Activity
          </h2>
          <p>You might have noticed that we currently have two problems:</p>
<ul>
<li>While migrating to Paging 3 we lost the ability to display a message when the list of results in empty.</li>
<li>Whenever you search for a new query, the current query result stays on screen until we get a network response. That&#39;s bad user experience! Instead we should display a progress bar or a retry button.</li>
</ul>
<p class="image-container"><img alt="ab9ff1b8b033179e.png" style="width: 224.29px" src="/static/codelabs/android-paging/img/ab9ff1b8b033179e.png" srcset="https://developer.android.com/static/codelabs/android-paging/img/ab9ff1b8b033179e_36.png 36w,https://developer.android.com/static/codelabs/android-paging/img/ab9ff1b8b033179e_48.png 48w,https://developer.android.com/static/codelabs/android-paging/img/ab9ff1b8b033179e_72.png 72w,https://developer.android.com/static/codelabs/android-paging/img/ab9ff1b8b033179e_96.png 96w,https://developer.android.com/static/codelabs/android-paging/img/ab9ff1b8b033179e_480.png 480w,https://developer.android.com/static/codelabs/android-paging/img/ab9ff1b8b033179e_720.png 720w,https://developer.android.com/static/codelabs/android-paging/img/ab9ff1b8b033179e_856.png 856w,https://developer.android.com/static/codelabs/android-paging/img/ab9ff1b8b033179e_960.png 960w,https://developer.android.com/static/codelabs/android-paging/img/ab9ff1b8b033179e_1440.png 1440w,https://developer.android.com/static/codelabs/android-paging/img/ab9ff1b8b033179e_1920.png 1920w,https://developer.android.com/static/codelabs/android-paging/img/ab9ff1b8b033179e_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px">    <img alt="bd744ff3ddc280c3.png" style="width: 224.15px" src="/static/codelabs/android-paging/img/bd744ff3ddc280c3.png" srcset="https://developer.android.com/static/codelabs/android-paging/img/bd744ff3ddc280c3_36.png 36w,https://developer.android.com/static/codelabs/android-paging/img/bd744ff3ddc280c3_48.png 48w,https://developer.android.com/static/codelabs/android-paging/img/bd744ff3ddc280c3_72.png 72w,https://developer.android.com/static/codelabs/android-paging/img/bd744ff3ddc280c3_96.png 96w,https://developer.android.com/static/codelabs/android-paging/img/bd744ff3ddc280c3_480.png 480w,https://developer.android.com/static/codelabs/android-paging/img/bd744ff3ddc280c3_720.png 720w,https://developer.android.com/static/codelabs/android-paging/img/bd744ff3ddc280c3_856.png 856w,https://developer.android.com/static/codelabs/android-paging/img/bd744ff3ddc280c3_960.png 960w,https://developer.android.com/static/codelabs/android-paging/img/bd744ff3ddc280c3_1440.png 1440w,https://developer.android.com/static/codelabs/android-paging/img/bd744ff3ddc280c3_1920.png 1920w,https://developer.android.com/static/codelabs/android-paging/img/bd744ff3ddc280c3_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>The solution to both of these problems is to react to load state changes in our <code translate="no" dir="ltr">SearchRepositoriesActivity</code>.</p>
<h2 is-upgraded id="display-empty-list-message" data-text="Display empty list message" tabindex="-1"><strong>Display empty list message</strong></h2>
<p>First, let&#39;s bring back the empty list message. This message should be displayed only once the list is loaded and the number of items in the list is 0. To know when the list was loaded we will use the <code translate="no" dir="ltr">PagingDataAdapter.loadStateFlow</code> property. This <code translate="no" dir="ltr">Flow</code> emits every time there&#39;s a change in the load state via a <code translate="no" dir="ltr">CombinedLoadStates</code> object.</p>
<p><code translate="no" dir="ltr">CombinedLoadStates</code> gives us the load state for the <code translate="no" dir="ltr">PageSource</code> we defined or for the <code translate="no" dir="ltr">RemoteMediator</code> needed for network and database case (more about this later).</p>
<p>In <code translate="no" dir="ltr">SearchRepositoriesActivity.bindList()</code> we collect from <code translate="no" dir="ltr">loadStateFlow</code> directly. The list is empty when the <code translate="no" dir="ltr">refresh</code> state of <code translate="no" dir="ltr">CombinedLoadStates</code> is <code translate="no" dir="ltr">NotLoading</code> and <code translate="no" dir="ltr">adapter.itemCount == 0</code>. Then we toggle the visibility of <code translate="no" dir="ltr">emptyList</code> and <code translate="no" dir="ltr">list</code> respectively:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="GDScript"><code translate="no" dir="ltr"><span class="devsite-syntax-n">private</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ActivitySearchRepositoriesBinding</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">bindList</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">repoAdapter</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ReposAdapter</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">uiState</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">StateFlow&lt;UiState&gt;</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">pagingData</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Flow&lt;PagingData&lt;Repo&gt;</span>&gt;<span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">onScrollChanged</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">UiAction</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Scroll</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Unit</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-o">...</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">lifecycleScope</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">launch</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">repoAdapter</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">loadStateFlow</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">collect</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">isListEmpty</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">NotLoading</span><span class="devsite-syntax-w"> &amp;&amp; </span><span class="devsite-syntax-n">repoAdapter</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">itemCount</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">==</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">0</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">show</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">empty</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">list</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">emptyList</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">isVisible</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">isListEmpty</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Only</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">show</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">list</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">succeeds</span><span class="devsite-syntax-o">.</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">list</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">isVisible</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">!</span><span class="devsite-syntax-n">isListEmpty</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<p><strong>Display loading state</strong></p>
<p>Let&#39;s update our <code translate="no" dir="ltr">activity_search_repositories.xml</code> to include a retry button and a progress bar UI elements:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="GDScript"><code translate="no" dir="ltr">&lt;<span class="devsite-syntax-n">androidx</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">constraintlayout</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">widget</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">ConstraintLayout</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">xmlns</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"http://schemas.android.com/apk/res/android"</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">xmlns</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"http://schemas.android.com/apk/res-auto"</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">xmlns</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">tools</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"http://schemas.android.com/tools"</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_width</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"match_parent"</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_height</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"match_parent"</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">tools</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">".ui.SearchRepositoriesActivity"</span>&gt;
<span class="devsite-syntax-w">    </span>&lt;<span class="devsite-syntax-n">com</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">google</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">material</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">textfield</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">TextInputLayout</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">id</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"@+id/input_layout"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_width</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"0dp"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_height</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"wrap_content"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_marginEnd</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"8dp"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_marginStart</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"8dp"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_marginTop</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"8dp"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_marginLeft</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"8dp"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_marginRight</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"8dp"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">style</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"@style/Widget.MaterialComponents.TextInputLayout.OutlinedBox"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_constraintEnd_toEndOf</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"parent"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_constraintStart_toStartOf</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"parent"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_constraintTop_toTopOf</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"parent"</span>&gt;
<span class="devsite-syntax-w">        </span>&lt;<span class="devsite-syntax-n">EditText</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">id</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"@+id/search_repo"</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_width</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"match_parent"</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_height</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"wrap_content"</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">hint</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"@string/search_hint"</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">imeOptions</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"actionSearch"</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">inputType</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"textNoSuggestions"</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">selectAllOnFocus</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"true"</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">tools</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">text</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"Android"</span><span class="devsite-syntax-o">/</span>&gt;
<span class="devsite-syntax-w">    </span>&lt;<span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">com</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">google</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">material</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">textfield</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">TextInputLayout</span>&gt;

<span class="devsite-syntax-w">    </span>&lt;<span class="devsite-syntax-n">androidx</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">recyclerview</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">widget</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">RecyclerView</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">id</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"@+id/list"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_width</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"0dp"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_height</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"0dp"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">paddingVertical</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"@dimen/row_item_margin_vertical"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">scrollbars</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"vertical"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layoutManager</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"LinearLayoutManager"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_constraintBottom_toBottomOf</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"parent"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_constraintEnd_toEndOf</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"parent"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_constraintStart_toStartOf</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"parent"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_constraintTop_toBottomOf</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"@+id/input_layout"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">tools</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">ignore</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"UnusedAttribute"</span><span class="devsite-syntax-o">/</span>&gt;

<span class="devsite-syntax-w">    </span>&lt;<span class="devsite-syntax-n">ProgressBar</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">id</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"@+id/progress_bar"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">style</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"?android:attr/progressBarStyle"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_width</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"match_parent"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_height</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"wrap_content"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_gravity</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"center"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_constraintLeft_toLeftOf</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"parent"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_constraintRight_toRightOf</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"parent"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_constraintTop_toTopOf</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"parent"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_constraintBottom_toBottomOf</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"parent"</span><span class="devsite-syntax-o">/</span>&gt;

<span class="devsite-syntax-w">    </span>&lt;<span class="devsite-syntax-n">Button</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">id</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"@+id/retry_button"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_width</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"wrap_content"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_height</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"wrap_content"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">text</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"@string/retry"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_constraintLeft_toLeftOf</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"parent"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_constraintRight_toRightOf</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"parent"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_constraintTop_toTopOf</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"parent"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_constraintBottom_toBottomOf</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"parent"</span><span class="devsite-syntax-o">/</span>&gt;

<span class="devsite-syntax-w">    </span>&lt;<span class="devsite-syntax-n">TextView</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">id</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"@+id/emptyList"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_width</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"0dp"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_height</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"match_parent"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">gravity</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"center"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">text</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"@string/no_results"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">textSize</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"@dimen/repo_name_size"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">visibility</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"gone"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_constraintBottom_toBottomOf</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"parent"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_constraintEnd_toEndOf</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"parent"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_constraintStart_toStartOf</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"parent"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_constraintTop_toTopOf</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"parent"</span><span class="devsite-syntax-o">/</span>&gt;

&lt;<span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">androidx</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">constraintlayout</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">widget</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">ConstraintLayout</span>&gt;
</code></pre></devsite-code>
<p>Our retry button should trigger a reload of the <code translate="no" dir="ltr">PagingData</code>. To do this, we call <code translate="no" dir="ltr">adapter.retry()</code> in the <code translate="no" dir="ltr">onClickListener</code> implementation, like we did for the header/footer:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Scilab"><code translate="no" dir="ltr"><span class="devsite-syntax-c1">// SearchRepositoriesActivity.kt</span>

<span class="devsite-syntax-w">   </span><span class="devsite-syntax-n">private</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ActivitySearchRepositoriesBinding</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">bindList</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">repoAdapter</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ReposAdapter</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">uiState</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">StateFlow&lt;UiState&gt;</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">pagingData</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Flow&lt;PagingData&lt;Repo&gt;</span>&gt;<span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">onScrollChanged</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">UiAction</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Scroll</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Unit</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">retryButton</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">setOnClickListener</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">repoAdapter</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">retry</span><span class="devsite-syntax-p">()</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">...</span>
<span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<p>Next, let&#39;s react to load state changes in <code translate="no" dir="ltr">SearchRepositoriesActivity.bindList</code>. Since we only want our progress bar to be displayed when we have a new query, we need to rely on the load type from our paging source, specifically <code translate="no" dir="ltr">CombinedLoadStates.source.refresh</code> and on the <code translate="no" dir="ltr">LoadState</code>: <code translate="no" dir="ltr">Loading</code> or <code translate="no" dir="ltr">Error</code>. Also, one piece of functionality we commented out in a previous step was displaying a <code translate="no" dir="ltr">Toast</code> when we got an error, so let&#39;s make sure we bring that in as well. To display the error message we will have to check whether <code translate="no" dir="ltr">CombinedLoadStates.prepend</code> or <code translate="no" dir="ltr">CombinedLoadStates.append</code> is an instance of <code translate="no" dir="ltr">LoadState.Error</code> and retrieve the error message from the error.</p>
<p>Let&#39;s update our <code translate="no" dir="ltr">ActivitySearchRepositoriesBinding.bindList</code> in <code translate="no" dir="ltr">SearchRepositoriesActivity</code> method to have this functionality:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="GDScript"><code translate="no" dir="ltr"><span class="devsite-syntax-n">private</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ActivitySearchRepositoriesBinding</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">bindList</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">repoAdapter</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ReposAdapter</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">uiState</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">StateFlow&lt;UiState&gt;</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">pagingData</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Flow&lt;PagingData&lt;Repo&gt;</span>&gt;<span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">onScrollChanged</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">UiAction</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Scroll</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Unit</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-o">...</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">lifecycleScope</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">launch</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">repoAdapter</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">loadStateFlow</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">collect</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">isListEmpty</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">NotLoading</span><span class="devsite-syntax-w"> &amp;&amp; </span><span class="devsite-syntax-n">repoAdapter</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">itemCount</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">==</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">0</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">show</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">empty</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">list</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">emptyList</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">isVisible</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">isListEmpty</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Only</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">show</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">list</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">succeeds</span><span class="devsite-syntax-o">.</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">list</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">isVisible</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">!</span><span class="devsite-syntax-n">isListEmpty</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Show</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">loading</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">spinner</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">during</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">initial</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb">load</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-ow">or</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-o">.</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">progressBar</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">isVisible</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">source</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Loading</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Show</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">retry</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">state</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">initial</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb">load</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-ow">or</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fails</span><span class="devsite-syntax-o">.</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">retryButton</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">isVisible</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">source</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Error</span>

<span class="devsite-syntax-w">                </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Toast</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">on</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">any</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">error</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">regardless</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">of</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">whether</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">it</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">came</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">from</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RemoteMediator</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-ow">or</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">PagingSource</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">errorState</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">source</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">append</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">as</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Error</span>
<span class="devsite-syntax-w">                    </span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">source</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">prepend</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">as</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Error</span>
<span class="devsite-syntax-w">                    </span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">append</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">as</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Error</span>
<span class="devsite-syntax-w">                    </span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">prepend</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">as</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Error</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">errorState</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">let</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">                    </span><span class="devsite-syntax-n">Toast</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">makeText</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">                        </span><span class="devsite-syntax-n">this</span><span class="devsite-syntax-err">@</span><span class="devsite-syntax-n">SearchRepositoriesActivity</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">                        </span><span class="devsite-syntax-s2">"</span><span class="devsite-syntax-se">\uD83D\uDE28</span><span class="devsite-syntax-s2"> Wooops ${it.error}"</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">                        </span><span class="devsite-syntax-n">Toast</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">LENGTH_LONG</span>
<span class="devsite-syntax-w">                    </span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">show</span><span class="devsite-syntax-p">()</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<p>Now let&#39;s run the app and check out how it works!</p>
<p>That&#39;s it! With the current setup, the Paging library components are the ones triggering the API requests at the right time, handling the in-memory cache, and displaying the data. Run the app and try searching for repositories.</p>


        </google-codelab-step>
      
        <google-codelab-step label="Adding list separators" duration="10" step="11">
          
          <h2 class="step-title" id="11" data-text="Adding list separators" tabindex="-1">
              12. Adding list separators
          </h2>
          <p>One way to improve your list&#39;s readability is to add separators. For example, in our app, since the repositories are ordered by the number of stars descending, we could have separators every 10k stars. To help implement this, the Paging 3 API allows inserting separators into <code translate="no" dir="ltr">PagingData</code>.</p>
<p class="image-container"><img alt="573969750b4c719c.png" style="width: 203.50px" src="/static/codelabs/android-paging/img/573969750b4c719c.png" srcset="https://developer.android.com/static/codelabs/android-paging/img/573969750b4c719c_36.png 36w,https://developer.android.com/static/codelabs/android-paging/img/573969750b4c719c_48.png 48w,https://developer.android.com/static/codelabs/android-paging/img/573969750b4c719c_72.png 72w,https://developer.android.com/static/codelabs/android-paging/img/573969750b4c719c_96.png 96w,https://developer.android.com/static/codelabs/android-paging/img/573969750b4c719c_480.png 480w,https://developer.android.com/static/codelabs/android-paging/img/573969750b4c719c_720.png 720w,https://developer.android.com/static/codelabs/android-paging/img/573969750b4c719c_856.png 856w,https://developer.android.com/static/codelabs/android-paging/img/573969750b4c719c_960.png 960w,https://developer.android.com/static/codelabs/android-paging/img/573969750b4c719c_1440.png 1440w,https://developer.android.com/static/codelabs/android-paging/img/573969750b4c719c_1920.png 1920w,https://developer.android.com/static/codelabs/android-paging/img/573969750b4c719c_2880.png 2880w" sizes="(max-width: 840px) 100vw, 856px"></p>
<p>Adding separators in <code translate="no" dir="ltr">PagingData</code> will lead to the modification of the list we display on our screen. We no longer display just <code translate="no" dir="ltr">Repo</code> objects but also separator objects. Therefore, we have to change the UI model we&#39;re exposing from the <code translate="no" dir="ltr">ViewModel</code> from <code translate="no" dir="ltr">Repo</code> to another type that can encapsulate both types: <code translate="no" dir="ltr">RepoItem</code> and <code translate="no" dir="ltr">SeparatorItem</code>. Next, we&#39;ll have to update our UI to support separators:</p>
<ul>
<li>Add a layout and <code translate="no" dir="ltr">ViewHolder</code> for separators.</li>
<li>Update <code translate="no" dir="ltr">RepoAdapter</code> to support creating and binding both separators and repositories.</li>
</ul>
<p>Let&#39;s take this step by step and see what the implementation looks like.</p>
<h2 is-upgraded id="change-the-ui-model" data-text="Change the UI model" tabindex="-1"><strong>Change the UI model</strong></h2>
<p>Currently <code translate="no" dir="ltr">SearchRepositoriesViewModel.searchRepo()</code> returns <code translate="no" dir="ltr">Flow&lt;PagingData&lt;Repo&gt;&gt;</code>. To support both repositories and separators, we&#39;ll create a <code translate="no" dir="ltr">UiModel</code> sealed class in the same file with <code translate="no" dir="ltr">SearchRepositoriesViewModel</code>. We can have 2 types of <code translate="no" dir="ltr">UiModel</code> objects: <code translate="no" dir="ltr">RepoItem</code> and <code translate="no" dir="ltr">SeparatorItem</code>.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Scalate Server Page"><code translate="no" dir="ltr">sealed<span class="devsite-syntax-w"> </span>class<span class="devsite-syntax-w"> </span>UiModel<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">    </span>data<span class="devsite-syntax-w"> </span>class<span class="devsite-syntax-w"> </span>RepoItem(val<span class="devsite-syntax-w"> </span>repo:<span class="devsite-syntax-w"> </span>Repo)<span class="devsite-syntax-w"> </span>:<span class="devsite-syntax-w"> </span>UiModel()
<span class="devsite-syntax-w">    </span>data<span class="devsite-syntax-w"> </span>class<span class="devsite-syntax-w"> </span>SeparatorItem(val<span class="devsite-syntax-w"> </span>description:<span class="devsite-syntax-w"> </span>String)<span class="devsite-syntax-w"> </span>:<span class="devsite-syntax-w"> </span>UiModel()
}
</code></pre></devsite-code>
<p>Because we want to separate repositories based on 10k stars, let&#39;s create an extension property on <code translate="no" dir="ltr">RepoItem</code> that rounds up the number of stars for us:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="scdoc"><code translate="no" dir="ltr">private val UiModel.RepoItem.roundedStarCount: Int
    get() = this.repo.stars / 10_000
</code></pre></devsite-code>
<h2 is-upgraded id="insert-separators" data-text="Insert separators" tabindex="-1"><strong>Insert separators</strong></h2>
<p><code translate="no" dir="ltr">SearchRepositoriesViewModel.searchRepo()</code> should now return <code translate="no" dir="ltr">Flow&lt;PagingData&lt;UiModel&gt;&gt;</code>.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Scalate Server Page"><code translate="no" dir="ltr">class<span class="devsite-syntax-w"> </span>SearchRepositoriesViewModel(
<span class="devsite-syntax-w">    </span>private<span class="devsite-syntax-w"> </span>val<span class="devsite-syntax-w"> </span>repository:<span class="devsite-syntax-w"> </span>GithubRepository,
<span class="devsite-syntax-w">    </span>private<span class="devsite-syntax-w"> </span>val<span class="devsite-syntax-w"> </span>savedStateHandle:<span class="devsite-syntax-w"> </span>SavedStateHandle
)<span class="devsite-syntax-w"> </span>:<span class="devsite-syntax-w"> </span>ViewModel()<span class="devsite-syntax-w"> </span>{

<span class="devsite-syntax-w">    </span>...

<span class="devsite-syntax-w">    </span>fun<span class="devsite-syntax-w"> </span>searchRepo(queryString:<span class="devsite-syntax-w"> </span>String):<span class="devsite-syntax-w"> </span>Flow&lt;PagingData&lt;UiModel&gt;&gt;<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">        </span>...<span class="devsite-syntax-w"> </span>
<span class="devsite-syntax-w">    </span>}
}
</code></pre></devsite-code>
<p>Let&#39;s see how the implementation changes! Currently, <code translate="no" dir="ltr">repository.getSearchResultStream(queryString)</code> returns a <code translate="no" dir="ltr">Flow&lt;PagingData&lt;Repo&gt;&gt;</code>, so the first operation we need to add is to transform each <code translate="no" dir="ltr">Repo</code> into a <code translate="no" dir="ltr">UiModel.RepoItem</code>. To do this, we can use the <code translate="no" dir="ltr">Flow.map</code> operator and then map each <code translate="no" dir="ltr">PagingData</code> to build a new <code translate="no" dir="ltr">UiModel.Repo</code> from the current <code translate="no" dir="ltr">Repo</code> item, resulting in a <code translate="no" dir="ltr">Flow&lt;PagingData&lt;UiModel.RepoItem&gt;&gt;</code>:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Scalate Server Page"><code translate="no" dir="ltr">...
val<span class="devsite-syntax-w"> </span>newResult:<span class="devsite-syntax-w"> </span>Flow&lt;PagingData&lt;UiModel&gt;&gt;<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>repository.getSearchResultStream(queryString)
<span class="devsite-syntax-w">                </span>.map<span class="devsite-syntax-w"> </span>{<span class="devsite-syntax-w"> </span>pagingData<span class="devsite-syntax-w"> </span>-&gt;<span class="devsite-syntax-w"> </span>pagingData.map<span class="devsite-syntax-w"> </span>{<span class="devsite-syntax-w"> </span>UiModel.RepoItem(it)<span class="devsite-syntax-w"> </span>}<span class="devsite-syntax-w"> </span>}
...<span class="devsite-syntax-w"> </span>
</code></pre></devsite-code>
<p>Now we can insert the separators! For each emission of the <code translate="no" dir="ltr">Flow</code>, we&#39;ll call <code translate="no" dir="ltr">PagingData.insertSeparators()</code>. This method returns a <code translate="no" dir="ltr">PagingData</code> containing each original element, with an optional separator that you will generate, given the elements before and after. In boundary conditions (at the beginning or end of the list) the respective before or after elements will be <code translate="no" dir="ltr">null</code>. If a separator doesn&#39;t need to be created, return <code translate="no" dir="ltr">null</code>.</p>
<p>Because we&#39;re changing the type of <code translate="no" dir="ltr">PagingData</code> elements from <code translate="no" dir="ltr">UiModel.Repo</code> to <code translate="no" dir="ltr">UiModel</code>, make sure you explicitly set the type arguments of the <code translate="no" dir="ltr">insertSeparators()</code> method.</p>
<p>Here&#39;s what the <code translate="no" dir="ltr">searchRepo()</code> method should look like:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Genshi"><code translate="no" dir="ltr"><span class="devsite-syntax-w">   </span>private<span class="devsite-syntax-w"> </span>fun<span class="devsite-syntax-w"> </span>searchRepo(queryString:<span class="devsite-syntax-w"> </span>String):<span class="devsite-syntax-w"> </span>Flow&lt;PagingData&lt;UiModel&gt;&gt;<span class="devsite-syntax-w"> </span>=
<span class="devsite-syntax-w">        </span>repository.getSearchResultStream(queryString)
<span class="devsite-syntax-w">            </span>.map<span class="devsite-syntax-w"> </span>{<span class="devsite-syntax-w"> </span>pagingData<span class="devsite-syntax-w"> </span>-&gt;<span class="devsite-syntax-w"> </span>pagingData.map<span class="devsite-syntax-w"> </span>{<span class="devsite-syntax-w"> </span>UiModel.RepoItem(it)<span class="devsite-syntax-w"> </span>}<span class="devsite-syntax-w"> </span>}
<span class="devsite-syntax-w">            </span>.map<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">                </span>it.insertSeparators<span class="devsite-syntax-w"> </span>{<span class="devsite-syntax-w"> </span>before,<span class="devsite-syntax-w"> </span>after<span class="devsite-syntax-w"> </span>-&gt;
<span class="devsite-syntax-w">                    </span>if<span class="devsite-syntax-w"> </span>(after<span class="devsite-syntax-w"> </span>==<span class="devsite-syntax-w"> </span>null)<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">                        </span>//<span class="devsite-syntax-w"> </span>we're<span class="devsite-syntax-w"> </span>at<span class="devsite-syntax-w"> </span>the<span class="devsite-syntax-w"> </span>end<span class="devsite-syntax-w"> </span>of<span class="devsite-syntax-w"> </span>the<span class="devsite-syntax-w"> </span>list
<span class="devsite-syntax-w">                        </span>return@insertSeparators<span class="devsite-syntax-w"> </span>null
<span class="devsite-syntax-w">                    </span>}

<span class="devsite-syntax-w">                    </span>if<span class="devsite-syntax-w"> </span>(before<span class="devsite-syntax-w"> </span>==<span class="devsite-syntax-w"> </span>null)<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">                        </span>//<span class="devsite-syntax-w"> </span>we're<span class="devsite-syntax-w"> </span>at<span class="devsite-syntax-w"> </span>the<span class="devsite-syntax-w"> </span>beginning<span class="devsite-syntax-w"> </span>of<span class="devsite-syntax-w"> </span>the<span class="devsite-syntax-w"> </span>list
<span class="devsite-syntax-w">                        </span>return@insertSeparators<span class="devsite-syntax-w"> </span>UiModel.SeparatorItem("<span class="devsite-syntax-cp">${</span><span class="devsite-syntax-n">after</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">roundedStarCount</span><span class="devsite-syntax-cp">}</span>0.000+<span class="devsite-syntax-w"> </span>stars")
<span class="devsite-syntax-w">                    </span>}
<span class="devsite-syntax-w">                    </span>//<span class="devsite-syntax-w"> </span>check<span class="devsite-syntax-w"> </span>between<span class="devsite-syntax-w"> </span>2<span class="devsite-syntax-w"> </span>items
<span class="devsite-syntax-w">                    </span>if<span class="devsite-syntax-w"> </span>(before.roundedStarCount<span class="devsite-syntax-w"> &gt; </span>after.roundedStarCount)<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">                        </span>if<span class="devsite-syntax-w"> </span>(after.roundedStarCount<span class="devsite-syntax-w"> </span>&gt;=<span class="devsite-syntax-w"> </span>1)<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">                            </span>UiModel.SeparatorItem("<span class="devsite-syntax-cp">${</span><span class="devsite-syntax-n">after</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">roundedStarCount</span><span class="devsite-syntax-cp">}</span>0.000+<span class="devsite-syntax-w"> </span>stars")
<span class="devsite-syntax-w">                        </span>}<span class="devsite-syntax-w"> </span>else<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">                            </span>UiModel.SeparatorItem("&lt;<span class="devsite-syntax-w"> </span>10.000+<span class="devsite-syntax-w"> </span>stars")
<span class="devsite-syntax-w">                        </span>}
<span class="devsite-syntax-w">                    </span>}<span class="devsite-syntax-w"> </span>else<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">                        </span>//<span class="devsite-syntax-w"> </span>no<span class="devsite-syntax-w"> </span>separator
<span class="devsite-syntax-w">                        </span>null
<span class="devsite-syntax-w">                    </span>}
<span class="devsite-syntax-w">                </span>}
<span class="devsite-syntax-w">            </span>}
</code></pre></devsite-code>
<h2 is-upgraded id="support-multiple-view-types" data-text="Support multiple view types" tabindex="-1"><strong>Support multiple view types</strong></h2>
<p><code translate="no" dir="ltr">SeparatorItem</code> objects need to be displayed in our <code translate="no" dir="ltr">RecyclerView</code>. We&#39;re only displaying a string here, so let&#39;s create a <code translate="no" dir="ltr">separator_view_item</code> layout with a <code translate="no" dir="ltr">TextView</code> in the <code translate="no" dir="ltr">res/layout</code> folder:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="GDScript"><code translate="no" dir="ltr">&lt;<span class="devsite-syntax-err">?</span><span class="devsite-syntax-n">xml</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">version</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"1.0"</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">encoding</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"utf-8"</span><span class="devsite-syntax-err">?</span>&gt;
&lt;<span class="devsite-syntax-n">androidx</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">constraintlayout</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">widget</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">ConstraintLayout</span><span class="devsite-syntax-w"> </span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">xmlns</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"http://schemas.android.com/apk/res/android"</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">xmlns</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"http://schemas.android.com/apk/res-auto"</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">xmlns</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">tools</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"http://schemas.android.com/tools"</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_width</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"match_parent"</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_height</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"wrap_content"</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">background</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"@color/separatorBackground"</span>&gt;

<span class="devsite-syntax-w">    </span>&lt;<span class="devsite-syntax-n">TextView</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">id</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"@+id/separator_description"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_width</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"0dp"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_height</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"wrap_content"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">padding</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"@dimen/row_item_margin_horizontal"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">textColor</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"@color/separatorText"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">android</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">textSize</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"@dimen/repo_name_size"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_constraintEnd_toEndOf</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"parent"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_constraintStart_toStartOf</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"parent"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">app</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">layout_constraintTop_toTopOf</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"parent"</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">tools</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">text</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-s2">"10000+ stars"</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">/</span>&gt;
&lt;<span class="devsite-syntax-o">/</span><span class="devsite-syntax-n">androidx</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">constraintlayout</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">widget</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">ConstraintLayout</span>&gt;
</code></pre></devsite-code>
<p>Let&#39;s create a <code translate="no" dir="ltr">SeparatorViewHolder</code> in the <code translate="no" dir="ltr">ui</code> folder, where we just bind a string to the <code translate="no" dir="ltr">TextView</code>:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Scalate Server Page"><code translate="no" dir="ltr">class<span class="devsite-syntax-w"> </span>SeparatorViewHolder(view:<span class="devsite-syntax-w"> </span>View)<span class="devsite-syntax-w"> </span>:<span class="devsite-syntax-w"> </span>RecyclerView.ViewHolder(view)<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">    </span>private<span class="devsite-syntax-w"> </span>val<span class="devsite-syntax-w"> </span>description:<span class="devsite-syntax-w"> </span>TextView<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>view.findViewById(R.id.separator_description)

<span class="devsite-syntax-w">    </span>fun<span class="devsite-syntax-w"> </span>bind(separatorText:<span class="devsite-syntax-w"> </span>String)<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">        </span>description.text<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>separatorText
<span class="devsite-syntax-w">    </span>}

<span class="devsite-syntax-w">    </span>companion<span class="devsite-syntax-w"> </span>object<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">        </span>fun<span class="devsite-syntax-w"> </span>create(parent:<span class="devsite-syntax-w"> </span>ViewGroup):<span class="devsite-syntax-w"> </span>SeparatorViewHolder<span class="devsite-syntax-w"> </span>{
<span class="devsite-syntax-w">            </span>val<span class="devsite-syntax-w"> </span>view<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>LayoutInflater.from(parent.context)
<span class="devsite-syntax-w">                    </span>.inflate(R.layout.separator_view_item,<span class="devsite-syntax-w"> </span>parent,<span class="devsite-syntax-w"> </span>false)
<span class="devsite-syntax-w">            </span>return<span class="devsite-syntax-w"> </span>SeparatorViewHolder(view)
<span class="devsite-syntax-w">        </span>}
<span class="devsite-syntax-w">    </span>}
}
</code></pre></devsite-code>
<p>Update <code translate="no" dir="ltr">ReposAdapter</code> to support a <code translate="no" dir="ltr">UiModel</code> instead of a <code translate="no" dir="ltr">Repo</code>:</p>
<ul>
<li>Update the <code translate="no" dir="ltr">PagingDataAdapter</code> parameter from <code translate="no" dir="ltr">Repo</code> to <code translate="no" dir="ltr">UiModel</code>.</li>
<li>Implement a <code translate="no" dir="ltr">UiModel</code> comparator and replace the <code translate="no" dir="ltr">REPO_COMPARATOR</code> with it.</li>
<li>Create the <code translate="no" dir="ltr">SeparatorViewHolder</code> and bind it with the description of <code translate="no" dir="ltr">UiModel.SeparatorItem</code>.</li>
</ul>
<p>As we now need to display 2 different ViewHolders, replace RepoViewHolder with ViewHolder:</p>
<ul>
<li>Update the <code translate="no" dir="ltr">PagingDataAdapter</code> parameter</li>
<li>Update the <code translate="no" dir="ltr">onCreateViewHolder</code> return type</li>
<li>Update the <code translate="no" dir="ltr">onBindViewHolder</code> <code translate="no" dir="ltr">holder</code> parameter</li>
</ul>
<p>Here&#39;s what your final <code translate="no" dir="ltr">ReposAdapter</code> will look like:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Perl6"><code translate="no" dir="ltr"><span class="devsite-syntax-k">class</span> <span class="devsite-syntax-n">ReposAdapter</span> : <span class="devsite-syntax-n">PagingDataAdapter&lt;UiModel</span>, <span class="devsite-syntax-n">ViewHolder</span>&gt;(<span class="devsite-syntax-n">UIMODEL_COMPARATOR</span>) {

    <span class="devsite-syntax-n">override</span> <span class="devsite-syntax-n">fun</span> <span class="devsite-syntax-n">onCreateViewHolder</span>(<span class="devsite-syntax-n">parent:</span> <span class="devsite-syntax-n">ViewGroup</span>, <span class="devsite-syntax-n">viewType:</span> <span class="devsite-syntax-nb">Int</span>): <span class="devsite-syntax-n">ViewHolder</span> {
        <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-k">if</span> (<span class="devsite-syntax-n">viewType</span> == <span class="devsite-syntax-n">R</span>.<span class="devsite-syntax-n">layout</span>.<span class="devsite-syntax-n">repo_view_item</span>) {
            <span class="devsite-syntax-n">RepoViewHolder</span>.<span class="devsite-syntax-n">create</span>(<span class="devsite-syntax-nb">parent</span>)
        } <span class="devsite-syntax-k">else</span> {
            <span class="devsite-syntax-n">SeparatorViewHolder</span>.<span class="devsite-syntax-n">create</span>(<span class="devsite-syntax-nb">parent</span>)
        }
    }

    <span class="devsite-syntax-n">override</span> <span class="devsite-syntax-n">fun</span> <span class="devsite-syntax-n">getItemViewType</span>(<span class="devsite-syntax-n">position:</span> <span class="devsite-syntax-nb">Int</span>): <span class="devsite-syntax-nb">Int</span> {
        <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-k">when</span> (<span class="devsite-syntax-n">getItem</span>(<span class="devsite-syntax-n">position</span>)) {
            <span class="devsite-syntax-k">is</span> <span class="devsite-syntax-n">UiModel</span>.<span class="devsite-syntax-n">RepoItem</span> -&gt; <span class="devsite-syntax-n">R</span>.<span class="devsite-syntax-n">layout</span>.<span class="devsite-syntax-n">repo_view_item</span>
            <span class="devsite-syntax-k">is</span> <span class="devsite-syntax-n">UiModel</span>.<span class="devsite-syntax-n">SeparatorItem</span> -&gt; <span class="devsite-syntax-n">R</span>.<span class="devsite-syntax-n">layout</span>.<span class="devsite-syntax-n">separator_view_item</span>
            <span class="devsite-syntax-n">null</span> -&gt; <span class="devsite-syntax-nb">throw</span> <span class="devsite-syntax-n">UnsupportedOperationException</span>(<span class="devsite-syntax-s">"Unknown view"</span>)
        }
    }

    <span class="devsite-syntax-n">override</span> <span class="devsite-syntax-n">fun</span> <span class="devsite-syntax-n">onBindViewHolder</span>(<span class="devsite-syntax-n">holder:</span> <span class="devsite-syntax-n">ViewHolder</span>, <span class="devsite-syntax-n">position:</span> <span class="devsite-syntax-nb">Int</span>) {
        <span class="devsite-syntax-nb">val</span> <span class="devsite-syntax-n">uiModel</span> = <span class="devsite-syntax-n">getItem</span>(<span class="devsite-syntax-n">position</span>)
        <span class="devsite-syntax-n">uiModel</span>.<span class="devsite-syntax-k">let</span> {
            <span class="devsite-syntax-k">when</span> (<span class="devsite-syntax-n">uiModel</span>) {
                <span class="devsite-syntax-k">is</span> <span class="devsite-syntax-n">UiModel</span>.<span class="devsite-syntax-n">RepoItem</span> -&gt; (<span class="devsite-syntax-n">holder</span> <span class="devsite-syntax-n">as</span> <span class="devsite-syntax-n">RepoViewHolder</span>).<span class="devsite-syntax-n">bind</span>(<span class="devsite-syntax-n">uiModel</span>.<span class="devsite-syntax-n">repo</span>)
                <span class="devsite-syntax-k">is</span> <span class="devsite-syntax-n">UiModel</span>.<span class="devsite-syntax-n">SeparatorItem</span> -&gt; (<span class="devsite-syntax-n">holder</span> <span class="devsite-syntax-n">as</span> <span class="devsite-syntax-n">SeparatorViewHolder</span>).<span class="devsite-syntax-n">bind</span>(<span class="devsite-syntax-n">uiModel</span>.<span class="devsite-syntax-n">description</span>)
            }
        }
    }

    <span class="devsite-syntax-n">companion</span> <span class="devsite-syntax-n">object</span> {
        <span class="devsite-syntax-nb">private</span> <span class="devsite-syntax-nb">val</span> <span class="devsite-syntax-n">UIMODEL_COMPARATOR</span> = <span class="devsite-syntax-n">object</span> : <span class="devsite-syntax-n">DiffUtil</span>.<span class="devsite-syntax-n">ItemCallback&lt;UiModel&gt;</span>() {
            <span class="devsite-syntax-n">override</span> <span class="devsite-syntax-n">fun</span> <span class="devsite-syntax-n">areItemsTheSame</span>(<span class="devsite-syntax-n">oldItem:</span> <span class="devsite-syntax-n">UiModel</span>, <span class="devsite-syntax-n">newItem:</span> <span class="devsite-syntax-n">UiModel</span>): <span class="devsite-syntax-n">Boolean</span> {
                <span class="devsite-syntax-k">return</span> (<span class="devsite-syntax-n">oldItem</span> <span class="devsite-syntax-k">is</span> <span class="devsite-syntax-n">UiModel</span>.<span class="devsite-syntax-n">RepoItem</span> &amp;&amp; <span class="devsite-syntax-n">newItem</span> <span class="devsite-syntax-k">is</span> <span class="devsite-syntax-n">UiModel</span>.<span class="devsite-syntax-n">RepoItem</span> &amp;&amp;
                        <span class="devsite-syntax-n">oldItem</span>.<span class="devsite-syntax-n">repo</span>.<span class="devsite-syntax-n">fullName</span> == <span class="devsite-syntax-n">newItem</span>.<span class="devsite-syntax-n">repo</span>.<span class="devsite-syntax-n">fullName</span>) ||
                        (<span class="devsite-syntax-n">oldItem</span> <span class="devsite-syntax-k">is</span> <span class="devsite-syntax-n">UiModel</span>.<span class="devsite-syntax-n">SeparatorItem</span> &amp;&amp; <span class="devsite-syntax-n">newItem</span> <span class="devsite-syntax-k">is</span> <span class="devsite-syntax-n">UiModel</span>.<span class="devsite-syntax-n">SeparatorItem</span> &amp;&amp;
                                <span class="devsite-syntax-n">oldItem</span>.<span class="devsite-syntax-n">description</span> == <span class="devsite-syntax-n">newItem</span>.<span class="devsite-syntax-n">description</span>)
            }

            <span class="devsite-syntax-n">override</span> <span class="devsite-syntax-n">fun</span> <span class="devsite-syntax-n">areContentsTheSame</span>(<span class="devsite-syntax-n">oldItem:</span> <span class="devsite-syntax-n">UiModel</span>, <span class="devsite-syntax-n">newItem:</span> <span class="devsite-syntax-n">UiModel</span>): <span class="devsite-syntax-n">Boolean</span> =
                    <span class="devsite-syntax-n">oldItem</span> == <span class="devsite-syntax-n">newItem</span>
        }
    }
}
</code></pre></devsite-code>
<p>That&#39;s it! When running the app you should be able to see the separators!</p>


        </google-codelab-step>
      
        <google-codelab-step label="Paging from network and database" duration="2" step="12">
          
          <h2 class="step-title" id="12" data-text="Paging from network and database" tabindex="-1">
              13. Paging from network and database
          </h2>
          <p>Let&#39;s add offline support to our app by saving the data in a local database. That way, the database will be the source of truth for our app and we will always load data from there. Whenever we don&#39;t have any more data, we request more from the network and then save it in the database. Because the database is the source of truth, the UI will be automatically updated when more data is saved.</p>
<p>Here&#39;s what we need to do to add offline support:</p>
<ol type="1">
<li>Create a Room database, a table to save the <code translate="no" dir="ltr">Repo</code> objects in, and a DAO that we&#39;ll use to work with the <code translate="no" dir="ltr">Repo</code> objects.</li>
<li>Define how to load data from the network when we reach the end of the data in the database by implementing a <code translate="no" dir="ltr">RemoteMediator</code>.</li>
<li>Build a <code translate="no" dir="ltr">Pager</code> based on the Repos table as a data source and the <code translate="no" dir="ltr">RemoteMediator</code> for loading and saving data.</li>
</ol>
<aside class="warning"><p><strong>Note: </strong><code translate="no" dir="ltr">RemoteMediator</code> API is currently <strong>experimental</strong>. All classes implementing <code translate="no" dir="ltr">RemoteMediator</code> should be annotated with <code translate="no" dir="ltr">@OptIn(ExperimentalPagingApi::class)</code>.</p>
<p>When using this <code translate="no" dir="ltr">OptIn</code> annotation, make sure that in your app&#39;s <code translate="no" dir="ltr">build.gradle</code> file you have <code translate="no" dir="ltr">freeCompilerArgs += ["-Xopt-in=kotlin.RequiresOptIn"]</code> in your <code translate="no" dir="ltr">kotlinOptions</code>.</p>
<p>⚠️ Experimental APIs are likely to change in the future.</p>
</aside>
<p>Let&#39;s take each of these steps!</p>


        </google-codelab-step>
      
        <google-codelab-step label="Define the Room database, table, and DAO" duration="5" step="13">
          
          <h2 class="step-title" id="13" data-text="Define the Room database, table, and DAO" tabindex="-1">
              14. Define the Room database, table, and DAO
          </h2>
          <p>Our <code translate="no" dir="ltr">Repo</code> objects need to be saved in the database, so let&#39;s start by making the <code translate="no" dir="ltr">Repo</code> class an entity, with <code translate="no" dir="ltr">tableName = "repos"</code>, where the <code translate="no" dir="ltr">Repo.id</code> is the primary key. To do this, annotate the <code translate="no" dir="ltr">Repo</code> class with <code translate="no" dir="ltr">@Entity(tableName = "repos")</code> and add the <code translate="no" dir="ltr">@PrimaryKey</code> annotation to <code translate="no" dir="ltr">id</code>. This is what your <code translate="no" dir="ltr">Repo</code> class should look like now:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Scalate Server Page"><code translate="no" dir="ltr">@Entity(tableName<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>"repos")
data<span class="devsite-syntax-w"> </span>class<span class="devsite-syntax-w"> </span>Repo(
<span class="devsite-syntax-w">    </span>@PrimaryKey<span class="devsite-syntax-w"> </span>@field:SerializedName("id")<span class="devsite-syntax-w"> </span>val<span class="devsite-syntax-w"> </span>id:<span class="devsite-syntax-w"> </span>Long,
<span class="devsite-syntax-w">    </span>@field:SerializedName("name")<span class="devsite-syntax-w"> </span>val<span class="devsite-syntax-w"> </span>name:<span class="devsite-syntax-w"> </span>String,
<span class="devsite-syntax-w">    </span>@field:SerializedName("full_name")<span class="devsite-syntax-w"> </span>val<span class="devsite-syntax-w"> </span>fullName:<span class="devsite-syntax-w"> </span>String,
<span class="devsite-syntax-w">    </span>@field:SerializedName("description")<span class="devsite-syntax-w"> </span>val<span class="devsite-syntax-w"> </span>description:<span class="devsite-syntax-w"> </span>String?,
<span class="devsite-syntax-w">    </span>@field:SerializedName("html_url")<span class="devsite-syntax-w"> </span>val<span class="devsite-syntax-w"> </span>url:<span class="devsite-syntax-w"> </span>String,
<span class="devsite-syntax-w">    </span>@field:SerializedName("stargazers_count")<span class="devsite-syntax-w"> </span>val<span class="devsite-syntax-w"> </span>stars:<span class="devsite-syntax-w"> </span>Int,
<span class="devsite-syntax-w">    </span>@field:SerializedName("forks_count")<span class="devsite-syntax-w"> </span>val<span class="devsite-syntax-w"> </span>forks:<span class="devsite-syntax-w"> </span>Int,
<span class="devsite-syntax-w">    </span>@field:SerializedName("language")<span class="devsite-syntax-w"> </span>val<span class="devsite-syntax-w"> </span>language:<span class="devsite-syntax-w"> </span>String?
)
</code></pre></devsite-code>
<p>Create a new <code translate="no" dir="ltr">db</code> package. This is where we will implement the class that accesses data in the database and the class that defines the database.</p>
<p>Implement the data access object (DAO) to access the <code translate="no" dir="ltr">repos</code> table by creating a <code translate="no" dir="ltr">RepoDao</code> interface, annotated with <code translate="no" dir="ltr">@Dao</code>. We need the following actions on <code translate="no" dir="ltr">Repo</code>:</p>
<ul>
<li>Insert a list of <code translate="no" dir="ltr">Repo</code> objects. If the <code translate="no" dir="ltr">Repo</code> objects are already in the table, then replace them.</li>
</ul>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Transact-SQL"><code translate="no" dir="ltr"><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nv">@Insert</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">onConflict</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">OnConflictStrategy</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-nf">REPLACE</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">suspend</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">insertAll</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-nl">repos</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">List&lt;Repo&gt;</span><span class="devsite-syntax-p">)</span>
</code></pre></devsite-code>
<ul>
<li>Query for repos that contain the query string in the name or in the description and sort those results in descending order by the number of stars and then alphabetically by name. Instead of returning a <code translate="no" dir="ltr">List&lt;Repo&gt;</code>, return <code translate="no" dir="ltr">PagingSource&lt;Int, Repo&gt;</code>. That way, the <code translate="no" dir="ltr">repos</code> table becomes the source of data for Paging.</li>
</ul>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Transact-SQL"><code translate="no" dir="ltr"><span class="devsite-syntax-nv">@Query</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-ss">"SELECT * FROM repos WHERE "</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">+</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-ss">"name LIKE :queryString OR description LIKE :queryString "</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">+</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-ss">"ORDER BY stars DESC, name ASC"</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">reposByName</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-nl">queryString</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">String</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">PagingSource&lt;Int</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Repo</span>&gt;
</code></pre></devsite-code>
<ul>
<li>Clear all data in the <code translate="no" dir="ltr">Repos</code> table.</li>
</ul>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Transact-SQL"><code translate="no" dir="ltr"><span class="devsite-syntax-nv">@Query</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-ss">"DELETE FROM repos"</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-n">suspend</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">clearRepos</span><span class="devsite-syntax-p">()</span>
</code></pre></devsite-code>
<p>This is what your <code translate="no" dir="ltr">RepoDao</code> should look like:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Transact-SQL"><code translate="no" dir="ltr"><span class="devsite-syntax-nv">@Dao</span>
<span class="devsite-syntax-n">interface</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RepoDao</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-nv">@Insert</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">onConflict</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">OnConflictStrategy</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-nf">REPLACE</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">suspend</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">insertAll</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-nl">repos</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">List&lt;Repo&gt;</span><span class="devsite-syntax-p">)</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-nv">@Query</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-ss">"SELECT * FROM repos WHERE "</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">+</span>
<span class="devsite-syntax-w">   </span><span class="devsite-syntax-ss">"name LIKE :queryString OR description LIKE :queryString "</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">+</span>
<span class="devsite-syntax-w">   </span><span class="devsite-syntax-ss">"ORDER BY stars DESC, name ASC"</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">reposByName</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-nl">queryString</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">String</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">PagingSource&lt;Int</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Repo</span>&gt;

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-nv">@Query</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-ss">"DELETE FROM repos"</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">suspend</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">clearRepos</span><span class="devsite-syntax-p">()</span>
<span class="devsite-syntax-err">}</span>
</code></pre></devsite-code>
<p>Implement the Repo database:</p>
<ul>
<li>Create an abstract class <code translate="no" dir="ltr">RepoDatabase</code> that extends <code translate="no" dir="ltr">RoomDatabase</code>.</li>
<li>Annotate the class with <code translate="no" dir="ltr">@Database</code>, set the list of entities to contain the <code translate="no" dir="ltr">Repo</code> class, and set the database version to 1. For the purpose of this codelab we don&#39;t need to export the schema.</li>
<li>Define an abstract function that returns the <code translate="no" dir="ltr">ReposDao</code>.</li>
<li>Create a <code translate="no" dir="ltr">getInstance()</code> function in a <code translate="no" dir="ltr">companion object</code> that builds the <code translate="no" dir="ltr">RepoDatabase</code> object if it doesn&#39;t exist already.</li>
</ul>
<p>Here&#39;s what your <code translate="no" dir="ltr">RepoDatabase</code> looks like:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="GDScript"><code translate="no" dir="ltr"><span class="devsite-syntax-err">@</span><span class="devsite-syntax-n">Database</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">entities</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">Repo</span><span class="devsite-syntax-p">::</span><span class="devsite-syntax-k">class</span><span class="devsite-syntax-p">],</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">version</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">1</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">exportSchema</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-bp">false</span>
<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-n">abstract</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">class</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RepoDatabase</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RoomDatabase</span><span class="devsite-syntax-p">()</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">abstract</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">reposDao</span><span class="devsite-syntax-p">():</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RepoDao</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">companion</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">object</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>

<span class="devsite-syntax-w">        </span><span class="devsite-syntax-err">@</span><span class="devsite-syntax-n">Volatile</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">private</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">var</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">INSTANCE</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RepoDatabase</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb devsite-syntax-nb-Type">null</span>

<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">getInstance</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Context</span><span class="devsite-syntax-p">):</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RepoDatabase</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">INSTANCE</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">synchronized</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">this</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">                    </span><span class="devsite-syntax-n">INSTANCE</span>
<span class="devsite-syntax-w">                            </span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">buildDatabase</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">also</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">INSTANCE</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">it</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-p">}</span>

<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">private</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">buildDatabase</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Context</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">Room</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">databaseBuilder</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">applicationContext</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">                        </span><span class="devsite-syntax-n">RepoDatabase</span><span class="devsite-syntax-p">::</span><span class="devsite-syntax-k">class</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">java</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-s2">"Github.db"</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">                        </span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">build</span><span class="devsite-syntax-p">()</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<p>Now that we&#39;ve set up our database, let&#39;s see how we request data from the network and save it in the database.</p>


        </google-codelab-step>
      
        <google-codelab-step label="Request and save data - overview" duration="5" step="14">
          
          <h2 class="step-title" id="14" data-text="Request and save data - overview" tabindex="-1">
              15. Request and save data - overview
          </h2>
          <p>The Paging library uses the database as a source of truth for the data that needs to be displayed in the UI. Whenever we don&#39;t have any more data in the database, we need to request more from the network. To help with this, Paging 3 defines the <code translate="no" dir="ltr">RemoteMediator</code> abstract class, with one method that needs to be implemented: <code translate="no" dir="ltr">load()</code>. This method will be called whenever we need to load more data from the network. This class returns a <code translate="no" dir="ltr">MediatorResult</code> object, that can either be:</p>
<ul>
<li><code translate="no" dir="ltr">Error</code> - if we got an error while requesting data from the network.</li>
<li><code translate="no" dir="ltr">Success</code> - If we successfully got data from the network. Here, we also need to pass in a signal that tells whether more data can be loaded or not. For example, if the network response was successful but we got an empty list of repositories, it means that there is no more data to be loaded.</li>
</ul>
<p>In the <code translate="no" dir="ltr">data</code> package, let&#39;s create a new class called <code translate="no" dir="ltr">GithubRemoteMediator</code> that extends <code translate="no" dir="ltr">RemoteMediator</code>. This class will be recreated for every new query, so it will receive the following as parameters:</p>
<ul>
<li>The query <code translate="no" dir="ltr">String</code>.</li>
<li>The <code translate="no" dir="ltr">GithubService</code> - so we can make network requests.</li>
<li>The <code translate="no" dir="ltr">RepoDatabase</code> - so we can save data we got from the network request.</li>
</ul>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Scalate Server Page"><code translate="no" dir="ltr">@OptIn(ExperimentalPagingApi::class)
class<span class="devsite-syntax-w"> </span>GithubRemoteMediator(
<span class="devsite-syntax-w">    </span>private<span class="devsite-syntax-w"> </span>val<span class="devsite-syntax-w"> </span>query:<span class="devsite-syntax-w"> </span>String,
<span class="devsite-syntax-w">    </span>private<span class="devsite-syntax-w"> </span>val<span class="devsite-syntax-w"> </span>service:<span class="devsite-syntax-w"> </span>GithubService,
<span class="devsite-syntax-w">    </span>private<span class="devsite-syntax-w"> </span>val<span class="devsite-syntax-w"> </span>repoDatabase:<span class="devsite-syntax-w"> </span>RepoDatabase
)<span class="devsite-syntax-w"> </span>:<span class="devsite-syntax-w"> </span>RemoteMediator&lt;Int,<span class="devsite-syntax-w"> </span>Repo&gt;()<span class="devsite-syntax-w"> </span>{

<span class="devsite-syntax-w">    </span>override<span class="devsite-syntax-w"> </span>suspend<span class="devsite-syntax-w"> </span>fun<span class="devsite-syntax-w"> </span>load(loadType:<span class="devsite-syntax-w"> </span>LoadType,<span class="devsite-syntax-w"> </span>state:<span class="devsite-syntax-w"> </span>PagingState&lt;Int,<span class="devsite-syntax-w"> </span>Repo&gt;):<span class="devsite-syntax-w"> </span>MediatorResult<span class="devsite-syntax-w"> </span>{

<span class="devsite-syntax-w">   </span>}
}
</code></pre></devsite-code>
<p>To be able to build the network request, the load method has 2 parameters that should give us all the information we need:</p>
<ul>
<li><code translate="no" dir="ltr">PagingState</code> - this gives us information about the pages that were loaded before, the most recently accessed index in the list, and the <code translate="no" dir="ltr">PagingConfig</code> we defined when initializing the paging stream.</li>
<li><code translate="no" dir="ltr">LoadType</code> - this tells us whether we need to load data at the end (<code translate="no" dir="ltr">LoadType.APPEND</code>) or at the beginning of the data (<code translate="no" dir="ltr">LoadType.PREPEND</code>) that we previously loaded, or if this the first time we&#39;re loading data (<code translate="no" dir="ltr">LoadType.REFRESH</code>).</li>
</ul>
<p>For example, if the load type is <code translate="no" dir="ltr">LoadType.APPEND</code> then we retrieve the last item that was loaded from the <code translate="no" dir="ltr">PagingState</code>. Based on that we should be able to find out how to load the next batch of <code translate="no" dir="ltr">Repo</code> objects, by computing the next page to be loaded.</p>
<p>In the next section you&#39;ll find out how to compute keys for the next and previous pages to be loaded.</p>


        </google-codelab-step>
      
        <google-codelab-step label="Compute and save remote page keys" duration="5" step="15">
          
          <h2 class="step-title" id="15" data-text="Compute and save remote page keys" tabindex="-1">
              16. Compute and save remote page keys
          </h2>
          <p>For the purposes of the Github API, the page key that we use to request pages of repos is just a page index that is incremented when getting the next page. This means that given a <code translate="no" dir="ltr">Repo</code> object, the next batch of <code translate="no" dir="ltr">Repo</code> objects can be requested based on <em>page index + 1</em>. The previous batch of <code translate="no" dir="ltr">Repo</code> objects can be requested based on <em>page index - 1</em>. All <code translate="no" dir="ltr">Repo</code> objects received on a certain page response will have the same next and previous keys.</p>
<p>When we get the last item loaded from the <code translate="no" dir="ltr">PagingState</code>, there&#39;s no way to know the index of the page it belonged to. To solve this problem, we can add another table that stores the next and previous page keys for each <code translate="no" dir="ltr">Repo</code>; we can call it <code translate="no" dir="ltr">remote_keys</code>. While this can be done in the <code translate="no" dir="ltr">Repo</code> table, creating a new table for the next and previous remote keys associated with a <code translate="no" dir="ltr">Repo</code> allows us to have a better  <a href="https://en.wikipedia.org/wiki/Separation_of_concerns" target="_blank">separation of concerns</a>.</p>
<p>In the <code translate="no" dir="ltr">db</code> package, let&#39;s create a new data class called <code translate="no" dir="ltr">RemoteKeys</code>, annotate it with <code translate="no" dir="ltr">@Entity</code>, and add 3 properties: the repo <code translate="no" dir="ltr">id</code> (which is also the primary key), and the previous and next keys (which can be <code translate="no" dir="ltr">null</code> when we can&#39;t append or prepend data).</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Scalate Server Page"><code translate="no" dir="ltr">@Entity(tableName<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>"remote_keys")
data<span class="devsite-syntax-w"> </span>class<span class="devsite-syntax-w"> </span>RemoteKeys(
<span class="devsite-syntax-w">    </span>@PrimaryKey
<span class="devsite-syntax-w">    </span>val<span class="devsite-syntax-w"> </span>repoId:<span class="devsite-syntax-w"> </span>Long,
<span class="devsite-syntax-w">    </span>val<span class="devsite-syntax-w"> </span>prevKey:<span class="devsite-syntax-w"> </span>Int?,
<span class="devsite-syntax-w">    </span>val<span class="devsite-syntax-w"> </span>nextKey:<span class="devsite-syntax-w"> </span>Int?
)
</code></pre></devsite-code>
<p>Let&#39;s create a <code translate="no" dir="ltr">RemoteKeysDao</code> interface. We will need the following capabilities:</p>
<ul>
<li><strong>Insert a list of</strong> ﻿**<code translate="no" dir="ltr">RemoteKeys</code>**, as whenever we get <code translate="no" dir="ltr">Repos</code> from the network we will generate the remote keys for them.</li>
<li><strong>Get a</strong> ﻿**<code translate="no" dir="ltr">RemoteKey</code>** based on a <code translate="no" dir="ltr">Repo</code> <code translate="no" dir="ltr">id</code>.</li>
<li><strong>Clear the</strong> ﻿**<code translate="no" dir="ltr">RemoteKeys</code>**, which we will use whenever we have a new query.</li>
</ul>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Transact-SQL"><code translate="no" dir="ltr"><span class="devsite-syntax-nv">@Dao</span>
<span class="devsite-syntax-n">interface</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RemoteKeysDao</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">{</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-nv">@Insert</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">onConflict</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">OnConflictStrategy</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-nf">REPLACE</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">suspend</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">insertAll</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-nl">remoteKey</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">List&lt;RemoteKeys&gt;</span><span class="devsite-syntax-p">)</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-nv">@Query</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-ss">"SELECT * FROM remote_keys WHERE repoId = :repoId"</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">suspend</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">remoteKeysRepoId</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-nl">repoId</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Long</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RemoteKeys</span><span class="devsite-syntax-vm">?</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-nv">@Query</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-ss">"DELETE FROM remote_keys"</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">suspend</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">clearRemoteKeys</span><span class="devsite-syntax-p">()</span>
<span class="devsite-syntax-err">}</span>
</code></pre></devsite-code>
<p>Let&#39;s add the <code translate="no" dir="ltr">RemoteKeys</code> table to our database and provide access to the <code translate="no" dir="ltr">RemoteKeysDao</code>. To do this, update the <code translate="no" dir="ltr">RepoDatabase</code> as follows:</p>
<ul>
<li>Add RemoteKeys to the list of entities.</li>
<li>Expose the <code translate="no" dir="ltr">RemoteKeysDao</code> as an abstract function.</li>
</ul>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="GDScript"><code translate="no" dir="ltr"><span class="devsite-syntax-err">@</span><span class="devsite-syntax-n">Database</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">entities</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">Repo</span><span class="devsite-syntax-p">::</span><span class="devsite-syntax-k">class</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RemoteKeys</span><span class="devsite-syntax-p">::</span><span class="devsite-syntax-k">class</span><span class="devsite-syntax-p">],</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">version</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">1</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">exportSchema</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-bp">false</span>
<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-n">abstract</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">class</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RepoDatabase</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RoomDatabase</span><span class="devsite-syntax-p">()</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">abstract</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">reposDao</span><span class="devsite-syntax-p">():</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RepoDao</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">abstract</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">remoteKeysDao</span><span class="devsite-syntax-p">():</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RemoteKeysDao</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-o">...</span><span class="devsite-syntax-w"> </span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">rest</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">of</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">class</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">doesn</span><span class="devsite-syntax-s1">'t change</span>
<span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<aside class="warning"><p><strong>Note:</strong> If you ran and installed the application at the previous step, adding the <code translate="no" dir="ltr">RemoteKeys</code> entity changes the database schema. This means that you will have to increase the database <code translate="no" dir="ltr">version</code> to 2 and when building your database, before calling <code translate="no" dir="ltr">build()</code>, call <code translate="no" dir="ltr">.fallbackToDestructiveMigration()</code>.</p>
</aside>


        </google-codelab-step>
      
        <google-codelab-step label="Request and save data - implementation" duration="5" step="16">
          
          <h2 class="step-title" id="16" data-text="Request and save data - implementation" tabindex="-1">
              17. Request and save data - implementation
          </h2>
          <p>Now that we saved the remote keys, let&#39;s get back to <code translate="no" dir="ltr">GithubRemoteMediator</code> and see how to use them. This class will replace our <code translate="no" dir="ltr">GithubPagingSource</code>. Let&#39;s copy the <code translate="no" dir="ltr">GITHUB_STARTING_PAGE_INDEX</code> declaration from <code translate="no" dir="ltr">GithubPagingSource</code> in our <code translate="no" dir="ltr">GithubRemoteMediator</code> and delete the <code translate="no" dir="ltr">GithubPagingSource</code> class.</p>
<p>Let&#39;s see how we can implement the <code translate="no" dir="ltr">GithubRemoteMediator.load()</code> method:</p>
<ol type="1">
<li>Find out what page we need to load from the network, based on the <code translate="no" dir="ltr">LoadType</code>.</li>
<li>Trigger the network request.</li>
<li>Once the network request completes, if the received list of repositories is <strong>not empty</strong>, then do the following:</li>
<li>We compute the <code translate="no" dir="ltr">RemoteKeys</code> for every <code translate="no" dir="ltr">Repo</code>.</li>
<li>If this is a new query (<code translate="no" dir="ltr">loadType = REFRESH</code>) then we clear the database.</li>
<li>Save the <code translate="no" dir="ltr">RemoteKeys</code> and <code translate="no" dir="ltr">Repos</code> in the database.</li>
<li>Return <code translate="no" dir="ltr">MediatorResult.Success(endOfPaginationReached = false)</code>.</li>
<li>If the list of repos was empty then we return <code translate="no" dir="ltr">MediatorResult.Success(endOfPaginationReached = true)</code>. If we get an error requesting data we return <code translate="no" dir="ltr">MediatorResult.Error</code>.</li>
</ol>
<p>Here&#39;s how the code looks like overall. We&#39;ll replace the TODOs later on.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="GDScript"><code translate="no" dir="ltr"><span class="devsite-syntax-n">override</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">suspend</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb">load</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">loadType</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadType</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">state</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">PagingState&lt;Int</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Repo</span>&gt;<span class="devsite-syntax-p">):</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">MediatorResult</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">page</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">when</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">loadType</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">LoadType</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">REFRESH</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">         </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">TODO</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">LoadType</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">PREPEND</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">TODO</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">LoadType</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">APPEND</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">TODO</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">apiQuery</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">query</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">+</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">IN_QUALIFIER</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">try</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">apiResponse</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">service</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">searchRepos</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">apiQuery</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">page</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">state</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">config</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">pageSize</span><span class="devsite-syntax-p">)</span>

<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">repos</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">apiResponse</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">items</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">endOfPaginationReached</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">repos</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">isEmpty</span><span class="devsite-syntax-p">()</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">repoDatabase</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">withTransaction</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">clear</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">all</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">tables</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-ow">in</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">database</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">loadType</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">==</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadType</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">REFRESH</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">repoDatabase</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">remoteKeysDao</span><span class="devsite-syntax-p">()</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">clearRemoteKeys</span><span class="devsite-syntax-p">()</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">repoDatabase</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">reposDao</span><span class="devsite-syntax-p">()</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">clearRepos</span><span class="devsite-syntax-p">()</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">prevKey</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">page</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">==</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">GITHUB_STARTING_PAGE_INDEX</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb devsite-syntax-nb-Type">null</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">else</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">page</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">1</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">nextKey</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">endOfPaginationReached</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb devsite-syntax-nb-Type">null</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">else</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">page</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">+</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">1</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">keys</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">repos</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">map</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">RemoteKeys</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">repoId</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">it</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">id</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">prevKey</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">prevKey</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">nextKey</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">nextKey</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">repoDatabase</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">remoteKeysDao</span><span class="devsite-syntax-p">()</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">insertAll</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">keys</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">repoDatabase</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">reposDao</span><span class="devsite-syntax-p">()</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">insertAll</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">repos</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">MediatorResult</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Success</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">endOfPaginationReached</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">endOfPaginationReached</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">catch</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">exception</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">IOException</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">MediatorResult</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Error</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">exception</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">catch</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">exception</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">HttpException</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">MediatorResult</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Error</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">exception</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<p>Let&#39;s see how we find the page to load based on the <code translate="no" dir="ltr">LoadType</code>.</p>


        </google-codelab-step>
      
        <google-codelab-step label="Getting the page based on the LoadType" duration="5" step="17">
          
          <h2 class="step-title" id="17" data-text="Getting the page based on the LoadType" tabindex="-1">
              18. Getting the page based on the LoadType
          </h2>
          <p>Now that we know what happens in the <code translate="no" dir="ltr">GithubRemoteMediator.load()</code> method once we have the page key, let&#39;s see how we compute it. This will depend on the <code translate="no" dir="ltr">LoadType</code>.</p>
<h2 is-upgraded id="loadtype.append" data-text="LoadType.APPEND" tabindex="-1"><strong>LoadType.APPEND</strong></h2>
<p>When we need to load data at <strong>the end of the currently loaded data set</strong>, the load parameter is <code translate="no" dir="ltr">LoadType.APPEND</code>. So now, based on the last item in the database we need to compute the network page key.</p>
<ol type="1">
<li>We need to get the remote key of the <strong>last </strong><code translate="no" dir="ltr">Repo</code> item loaded from the database—let&#39;s separate this in a function:</li>
</ol>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Text only"><code translate="no" dir="ltr">    private suspend fun getRemoteKeyForLastItem(state: PagingState&lt;Int, Repo&gt;): RemoteKeys? {
        // Get the last page that was retrieved, that contained items.
        // From that last page, get the last item
        return state.pages.lastOrNull() { it.data.isNotEmpty() }?.data?.lastOrNull()
                ?.let { repo -&gt;
                    // Get the remote keys of the last item retrieved
repoDatabase.remoteKeysDao().remoteKeysRepoId(repo.id)
                }
    }
</code></pre></devsite-code>
<ol type="1" start="2">
<li>If <code translate="no" dir="ltr">remoteKeys</code> is null, that means the refresh result is not in the database yet. We can return Success with <code translate="no" dir="ltr">endOfPaginationReached = false</code> because Paging will call this method again if RemoteKeys becomes non-null. If remoteKeys is <strong>not </strong><code translate="no" dir="ltr">null</code> but its <code translate="no" dir="ltr">nextKey</code> is <code translate="no" dir="ltr">null</code>, that means we&#39;ve reached the end of pagination for append.</li>
</ol>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="GDScript"><code translate="no" dir="ltr"><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">page</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">when</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">loadType</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">LoadType</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">APPEND</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">remoteKeys</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">getRemoteKeyForLastItem</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">state</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">If</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">remoteKeys</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb devsite-syntax-nb-Type">null</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">that</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">means</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">result</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-ow">not</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-ow">in</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">database</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">yet</span><span class="devsite-syntax-o">.</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">We</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">can</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Success</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">with</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">endOfPaginationReached</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-bp">false</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">because</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Paging</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">will</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">call</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">this</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">method</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">again</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RemoteKeys</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">becomes</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">non</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-nb devsite-syntax-nb-Type">null</span><span class="devsite-syntax-o">.</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">If</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">remoteKeys</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">NOT</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">NULL</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">but</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">its</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">nextKey</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb devsite-syntax-nb-Type">null</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">that</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">means</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">we</span><span class="devsite-syntax-s1">'ve reached</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">end</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">of</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">pagination</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">for</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">append</span><span class="devsite-syntax-o">.</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">nextKey</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">remoteKeys</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">nextKey</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">nextKey</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">==</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb devsite-syntax-nb-Type">null</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">MediatorResult</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Success</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">endOfPaginationReached</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">remoteKeys</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">!=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb devsite-syntax-nb-Type">null</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">nextKey</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-o">...</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<h2 is-upgraded id="loadtype.prepend" data-text="LoadType.PREPEND" tabindex="-1"><strong>LoadType.PREPEND</strong></h2>
<p>When we need to load data at <strong>the beginning of the currently loaded data set</strong>, the load parameter is <code translate="no" dir="ltr">LoadType.PREPEND</code>. Based on the first item in the database we need to compute the network page key.</p>
<ol type="1">
<li>We need to get the remote key of the <strong>first </strong><code translate="no" dir="ltr">Repo</code> item loaded from the database—let&#39;s separate this in a function:</li>
</ol>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Text only"><code translate="no" dir="ltr">private suspend fun getRemoteKeyForFirstItem(state: PagingState&lt;Int, Repo&gt;): RemoteKeys? {
    // Get the first page that was retrieved, that contained items.
    // From that first page, get the first item
    return state.pages.firstOrNull { it.data.isNotEmpty() }?.data?.firstOrNull()
            ?.let { repo -&gt;
                // Get the remote keys of the first items retrieved
                repoDatabase.remoteKeysDao().remoteKeysRepoId(repo.id)
            }
}
</code></pre></devsite-code>
<ol type="1" start="2">
<li>If <code translate="no" dir="ltr">remoteKeys</code> is null, that means the refresh result is not in the database yet. We can return Success with <code translate="no" dir="ltr">endOfPaginationReached = false</code> because Paging will call this method again if RemoteKeys becomes non-null. If remoteKeys is <strong>not </strong><code translate="no" dir="ltr">null</code> but its <code translate="no" dir="ltr">prevKey</code> is <code translate="no" dir="ltr">null</code>, that means we&#39;ve reached the end of pagination for prepend.</li>
</ol>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="GDScript"><code translate="no" dir="ltr"><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">page</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">when</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">loadType</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">LoadType</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">PREPEND</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">remoteKeys</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">getRemoteKeyForFirstItem</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">state</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">If</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">remoteKeys</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb devsite-syntax-nb-Type">null</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">that</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">means</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">result</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-ow">not</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-ow">in</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">database</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">yet</span><span class="devsite-syntax-o">.</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">prevKey</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">remoteKeys</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">prevKey</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">prevKey</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">==</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb devsite-syntax-nb-Type">null</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">MediatorResult</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Success</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">endOfPaginationReached</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">remoteKeys</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">!=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb devsite-syntax-nb-Type">null</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">prevKey</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span>

<span class="devsite-syntax-w">      </span><span class="devsite-syntax-o">...</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<h2 is-upgraded id="loadtype.refresh" data-text="LoadType.REFRESH" tabindex="-1"><strong>LoadType.REFRESH</strong></h2>
<p><code translate="no" dir="ltr">LoadType.REFRESH</code> gets called when it&#39;s the first time we&#39;re loading data, or when <code translate="no" dir="ltr">PagingDataAdapter.refresh()</code> is called; so now the point of reference for loading our data is the <code translate="no" dir="ltr">state.anchorPosition</code>. If this is the first load, then the <code translate="no" dir="ltr">anchorPosition</code> is <code translate="no" dir="ltr">null</code>.  When <code translate="no" dir="ltr">PagingDataAdapter.refresh()</code> is called, the <code translate="no" dir="ltr">anchorPosition</code> is the first visible position in the displayed list, so we will need to load the page that contains that specific item.</p>
<ol type="1">
<li>Based on the <code translate="no" dir="ltr">anchorPosition</code> from the <code translate="no" dir="ltr">state</code>, we can get the closest <code translate="no" dir="ltr">Repo</code> item to that position by calling <code translate="no" dir="ltr">state.closestItemToPosition()</code>.</li>
<li>Based on the <code translate="no" dir="ltr">Repo</code> item, we can get the <code translate="no" dir="ltr">RemoteKeys</code> from the database.</li>
</ol>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="GDScript"><code translate="no" dir="ltr"><span class="devsite-syntax-n">private</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">suspend</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">getRemoteKeyClosestToCurrentPosition</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">state</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">PagingState&lt;Int</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Repo</span>&gt;
<span class="devsite-syntax-p">):</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RemoteKeys</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">The</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">paging</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">library</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">trying</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">to</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb">load</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">data</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">after</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">anchor</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">position</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Get</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">item</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">closest</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">to</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">anchor</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">position</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">state</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">anchorPosition</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">let</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">position</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">state</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">closestItemToPosition</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">position</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">id</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">let</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">repoId</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span>
<span class="devsite-syntax-w">   </span><span class="devsite-syntax-n">repoDatabase</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">remoteKeysDao</span><span class="devsite-syntax-p">()</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">remoteKeysRepoId</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">repoId</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<ol type="1" start="3">
<li>If <code translate="no" dir="ltr">remoteKey</code> is not null, then we can get the <code translate="no" dir="ltr">nextKey</code> from it. In the Github API the page keys are incremented sequentially. So to get the page that contains the current item, we just subtract 1 from <code translate="no" dir="ltr">remoteKey.nextKey</code>.</li>
<li>If <code translate="no" dir="ltr">RemoteKey</code> is <code translate="no" dir="ltr">null</code> (because the <code translate="no" dir="ltr">anchorPosition</code> was <code translate="no" dir="ltr">null</code>), then the page we need to load is the initial one: <code translate="no" dir="ltr">GITHUB_STARTING_PAGE_INDEX</code></li>
</ol>
<p>Now, the full page computation looks like this:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="GDScript"><code translate="no" dir="ltr"><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">page</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">when</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">loadType</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">LoadType</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">REFRESH</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">remoteKeys</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">getRemoteKeyClosestToCurrentPosition</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">state</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">remoteKeys</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">nextKey</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">minus</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">1</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">GITHUB_STARTING_PAGE_INDEX</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">LoadType</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">PREPEND</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">remoteKeys</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">getRemoteKeyForFirstItem</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">state</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">prevKey</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">remoteKeys</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">prevKey</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">prevKey</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">==</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb devsite-syntax-nb-Type">null</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">MediatorResult</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Success</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">endOfPaginationReached</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">remoteKeys</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">!=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb devsite-syntax-nb-Type">null</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">prevKey</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">LoadType</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">APPEND</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">remoteKeys</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">getRemoteKeyForLastItem</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">state</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">nextKey</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">remoteKeys</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">nextKey</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">nextKey</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">==</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb devsite-syntax-nb-Type">null</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">MediatorResult</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Success</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">endOfPaginationReached</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">remoteKeys</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">!=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb devsite-syntax-nb-Type">null</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">nextKey</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>


        </google-codelab-step>
      
        <google-codelab-step label="Update the paging Flow creation" duration="5" step="18">
          
          <h2 class="step-title" id="18" data-text="Update the paging Flow creation" tabindex="-1">
              19. Update the paging Flow creation
          </h2>
          <p>Now that we have the <code translate="no" dir="ltr">GithubRemoteMediator</code> and the <code translate="no" dir="ltr">PagingSource</code> in our <code translate="no" dir="ltr">ReposDao</code> implemented, we need to update <code translate="no" dir="ltr">GithubRepository.getSearchResultStream</code> to use them.</p>
<p>In order to do this, <code translate="no" dir="ltr">GithubRepository</code> needs access to the database. Let&#39;s pass the database as a parameter in the constructor. Also, since this class will use <code translate="no" dir="ltr">GithubRemoteMediator</code>:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Scalate Server Page"><code translate="no" dir="ltr">class<span class="devsite-syntax-w"> </span>GithubRepository(
<span class="devsite-syntax-w">        </span>private<span class="devsite-syntax-w"> </span>val<span class="devsite-syntax-w"> </span>service:<span class="devsite-syntax-w"> </span>GithubService,
<span class="devsite-syntax-w">        </span>private<span class="devsite-syntax-w"> </span>val<span class="devsite-syntax-w"> </span>database:<span class="devsite-syntax-w"> </span>RepoDatabase
)<span class="devsite-syntax-w"> </span>{<span class="devsite-syntax-w"> </span>...<span class="devsite-syntax-w"> </span>}
</code></pre></devsite-code>
<p>Update the <code translate="no" dir="ltr">Injection</code> file:</p>
<ul>
<li><code translate="no" dir="ltr">provideGithubRepository</code> method should get a context as a parameter and in the <code translate="no" dir="ltr">GithubRepository</code> constructor invoke <code translate="no" dir="ltr">RepoDatabase.getInstance</code>.</li>
<li><code translate="no" dir="ltr">provideViewModelFactory</code> method should get a context as a parameter and pass it to <code translate="no" dir="ltr">provideGithubRepository</code>.</li>
</ul>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Text only"><code translate="no" dir="ltr">object Injection {
    private fun provideGithubRepository(context: Context): GithubRepository {
        return GithubRepository(GithubService.create(), RepoDatabase.getInstance(context))
    }

    fun provideViewModelFactory(context: Context, owner: SavedStateRegistryOwner): ViewModelProvider.Factory {
        return ViewModelFactory(owner, provideGithubRepository(context))
    }
}
</code></pre></devsite-code>
<p>Update the <code translate="no" dir="ltr">SearchRepositoriesActivity.onCreate()</code> method and pass the context to <code translate="no" dir="ltr">Injection.provideViewModelFactory()</code>:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Scilab"><code translate="no" dir="ltr"><span class="devsite-syntax-w">       </span><span class="devsite-syntax-c1">// get the view model</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">viewModel</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ViewModelProvider</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">this</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Injection</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">provideViewModelFactory</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">this</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">owner</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">this</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-k">get</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">SearchRepositoriesViewModel</span><span class="devsite-syntax-p">::</span><span class="devsite-syntax-n">class</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">java</span><span class="devsite-syntax-p">)</span>
</code></pre></devsite-code>
<p>Let&#39;s get back to <code translate="no" dir="ltr">GithubRepository</code>. First, to be able to search for repos by name, we&#39;ll have to add <code translate="no" dir="ltr">%</code> to the beginning and end of the query string. Then, when calling the <code translate="no" dir="ltr">reposDao.reposByName</code>, we get a <code translate="no" dir="ltr">PagingSource</code>. Because the <code translate="no" dir="ltr">PagingSource</code> is invalidated every time we make a change in the database, we need to tell Paging how to get a new instance of the <code translate="no" dir="ltr">PagingSource</code>. To do this, we just create a function that calls the database query:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Genshi"><code translate="no" dir="ltr">//<span class="devsite-syntax-w"> </span>appending<span class="devsite-syntax-w"> </span>'%'<span class="devsite-syntax-w"> </span>so<span class="devsite-syntax-w"> </span>we<span class="devsite-syntax-w"> </span>can<span class="devsite-syntax-w"> </span>allow<span class="devsite-syntax-w"> </span>other<span class="devsite-syntax-w"> </span>characters<span class="devsite-syntax-w"> </span>to<span class="devsite-syntax-w"> </span>be<span class="devsite-syntax-w"> </span>before<span class="devsite-syntax-w"> </span>and<span class="devsite-syntax-w"> </span>after<span class="devsite-syntax-w"> </span>the<span class="devsite-syntax-w"> </span>query<span class="devsite-syntax-w"> </span>string
val<span class="devsite-syntax-w"> </span>dbQuery<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w"> </span>"%<span class="devsite-syntax-cp">${</span><span class="devsite-syntax-n">query</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">replace</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-s1">' '</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-s1">'%'</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-cp">}</span>%"
val<span class="devsite-syntax-w"> </span>pagingSourceFactory<span class="devsite-syntax-w"> </span>=<span class="devsite-syntax-w">  </span>{<span class="devsite-syntax-w"> </span>database.reposDao().reposByName(dbQuery)}
</code></pre></devsite-code>
<p>Now we can change the <code translate="no" dir="ltr">Pager</code> builder, to use a <code translate="no" dir="ltr">GithubRemoteMediator</code> and the <code translate="no" dir="ltr">pagingSourceFactory</code>. The <code translate="no" dir="ltr">Pager</code> is an experimental API so we&#39;ll have to annotate it with <code translate="no" dir="ltr">@OptIn</code>:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Transact-SQL"><code translate="no" dir="ltr"><span class="devsite-syntax-nv">@OptIn</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-nl">ExperimentalPagingApi</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-err">:</span><span class="devsite-syntax-k">class</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Pager</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">config</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">PagingConfig</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">pageSize</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">NETWORK_PAGE_SIZE</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">enablePlaceholders</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">false</span>
<span class="devsite-syntax-w">         </span><span class="devsite-syntax-p">),</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">remoteMediator</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">GithubRemoteMediator</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">query</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">service</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-k">database</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">),</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">pagingSourceFactory</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">pagingSourceFactory</span>
<span class="devsite-syntax-p">).</span><span class="devsite-syntax-n">flow</span>
</code></pre></devsite-code>
<p>That&#39;s it! Let&#39;s run the app!</p>
<h2 is-upgraded id="reacting-to-load-states-when-using-a-remotemediator" data-text="Reacting to load states when using a RemoteMediator" tabindex="-1"><strong>Reacting to load states when using a RemoteMediator</strong></h2>
<p>Until now, when reading from <code translate="no" dir="ltr">CombinedLoadStates</code>, we&#39;ve always read from <code translate="no" dir="ltr">CombinedLoadStates.source</code>. When using a <code translate="no" dir="ltr">RemoteMediator</code> however, accurate loading information can only be obtained by checking both <code translate="no" dir="ltr">CombinedLoadStates.source</code> and <code translate="no" dir="ltr">CombinedLoadStates.mediator</code>. In particular, we currently trigger a scroll  to the top of the list on new queries when the <code translate="no" dir="ltr">source</code> <code translate="no" dir="ltr">LoadState</code> is <code translate="no" dir="ltr">NotLoading</code>. We also have to make sure that our newly-added <code translate="no" dir="ltr">RemoteMediator</code> has a <code translate="no" dir="ltr">LoadState</code> of <code translate="no" dir="ltr">NotLoading</code> as well.</p>
<p>To do this, we define an enum that summarizes the presentation states of our list as fetched by the <code translate="no" dir="ltr">Pager</code>:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="GDScript"><code translate="no" dir="ltr"><span class="devsite-syntax-k">enum</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">class</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RemotePresentationState</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">INITIAL</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">REMOTE_LOADING</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">SOURCE_LOADING</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">PRESENTED</span>
<span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<p>With the above definition, we can then compare consecutive emissions of <code translate="no" dir="ltr">CombinedLoadStates</code>, and use them to determine the exact state of the items in the list.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="GDScript"><code translate="no" dir="ltr"><span class="devsite-syntax-err">@</span><span class="devsite-syntax-n">OptIn</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">ExperimentalCoroutinesApi</span><span class="devsite-syntax-p">::</span><span class="devsite-syntax-k">class</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Flow&lt;CombinedLoadStates&gt;</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">asRemotePresentationState</span><span class="devsite-syntax-p">():</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Flow&lt;RemotePresentationState&gt;</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">scan</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">RemotePresentationState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">INITIAL</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">state</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">when</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">state</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">RemotePresentationState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">PRESENTED</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">when</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">mediator</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Loading</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RemotePresentationState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">REMOTE_LOADING</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-k">else</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">state</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">RemotePresentationState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">INITIAL</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">when</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">mediator</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Loading</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RemotePresentationState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">REMOTE_LOADING</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-k">else</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">state</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">RemotePresentationState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">REMOTE_LOADING</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">when</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">source</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Loading</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RemotePresentationState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">SOURCE_LOADING</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-k">else</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">state</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">RemotePresentationState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">SOURCE_LOADING</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">when</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">source</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">NotLoading</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RemotePresentationState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">PRESENTED</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-k">else</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">state</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">distinctUntilChanged</span><span class="devsite-syntax-p">()</span>
</code></pre></devsite-code>
<p>The above lets us update the definition of the <code translate="no" dir="ltr">notLoading</code> <code translate="no" dir="ltr">Flow</code> we use to check whether we can scroll to the top of the list:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="GDScript"><code translate="no" dir="ltr"><span class="devsite-syntax-w">       </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">notLoading</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">repoAdapter</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">loadStateFlow</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">asRemotePresentationState</span><span class="devsite-syntax-p">()</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">map</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">it</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">==</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">RemotePresentationState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">PRESENTED</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<p>Similarly, when it comes to displaying a loading spinner during the initial page load (in the <code translate="no" dir="ltr">bindList</code> extension in <code translate="no" dir="ltr">SearchRepositoriesActivity</code>) , the app still relies on <code translate="no" dir="ltr">LoadState.source</code>. What we want right now is to show a loading spinner only for loads from <code translate="no" dir="ltr">RemoteMediator</code>. Other UI elements whose visibility depends on the <code translate="no" dir="ltr">LoadStates</code> also share this concern. We therefore update the binding of the <code translate="no" dir="ltr">LoadStates</code> to the UI elements as follows:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="GDScript"><code translate="no" dir="ltr"><span class="devsite-syntax-n">private</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ActivitySearchRepositoriesBinding</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">bindList</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">header</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ReposLoadStateAdapter</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">repoAdapter</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ReposAdapter</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">uiState</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">StateFlow&lt;UiState&gt;</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">onScrollChanged</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">UiAction</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Scroll</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Unit</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-o">...</span>

<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">lifecycleScope</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">launch</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">repoAdapter</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">loadStateFlow</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">collect</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-o">...</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">val</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">isListEmpty</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">NotLoading</span><span class="devsite-syntax-w"> &amp;&amp; </span><span class="devsite-syntax-n">repoAdapter</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">itemCount</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">==</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">0</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">show</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">empty</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">list</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">emptyList</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">isVisible</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">isListEmpty</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Only</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">show</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">list</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">succeeds</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">either</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">from</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">local</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">db</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-ow">or</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">remote</span><span class="devsite-syntax-o">.</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">list</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">isVisible</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w">  </span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">source</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">NotLoading</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">||</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">mediator</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">NotLoading</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Show</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">loading</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">spinner</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">during</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">initial</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb">load</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-ow">or</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-o">.</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">progressBar</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">isVisible</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">mediator</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Loading</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Show</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">retry</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">state</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">initial</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb">load</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-ow">or</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fails</span><span class="devsite-syntax-o">.</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">retryButton</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">isVisible</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">mediator</span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">refresh</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Error</span><span class="devsite-syntax-w"> &amp;&amp; </span><span class="devsite-syntax-n">repoAdapter</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">itemCount</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">==</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">0</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<p>Furthermore, because we have the database as the single source of truth, it is possible to launch the app in a state where we have data in the database, but a refresh with the <code translate="no" dir="ltr">RemoteMediator</code> fails. This is an interesting edge case, but one we can easily handle. To do this, we can keep a reference to the header <code translate="no" dir="ltr">LoadStateAdapter</code> and override its <code translate="no" dir="ltr">LoadState</code> to be that of the RemoteMediator&#39;s if and only if its refresh state has an error. Otherwise, we go with the default.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="GDScript"><code translate="no" dir="ltr"><span class="devsite-syntax-n">private</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">fun</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ActivitySearchRepositoriesBinding</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">bindList</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">header</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ReposLoadStateAdapter</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">repoAdapter</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ReposAdapter</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">uiState</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">StateFlow&lt;UiState&gt;</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">onScrollChanged</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">UiAction</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Scroll</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Unit</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-o">...</span>

<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">lifecycleScope</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">launch</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-n">repoAdapter</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">loadStateFlow</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">collect</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">-</span>&gt;
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Show</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">a</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">retry</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">header</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">there</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">was</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">an</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">error</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">refreshing</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-ow">and</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">items</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">were</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">previously</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-o">//</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">cached</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">OR</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">default</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">to</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">default</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">prepend</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">state</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">header</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">mediator</span>
<span class="devsite-syntax-w">                    </span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">refresh</span>
<span class="devsite-syntax-w">                    </span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">takeIf</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">it</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">is</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">LoadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">Error</span><span class="devsite-syntax-w"> &amp;&amp; </span><span class="devsite-syntax-n">repoAdapter</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">itemCount</span><span class="devsite-syntax-w"> &gt; </span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">                    </span><span class="devsite-syntax-err">?</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">loadState</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">prepend</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-o">...</span>
<span class="devsite-syntax-w">            </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<p>You can find the full code for the all the steps done in this codelab in the  <a href="https://github.com/android/codelab-android-paging/tree/main/advanced/end" target="_blank">end</a> folder..</p>


        </google-codelab-step>
      
        <google-codelab-step label="Wrap up" duration="2" step="19">
          
          <h2 class="step-title" id="19" data-text="Wrap up" tabindex="-1">
              20. Wrap up
          </h2>
          <p>Now that we have added all the components, let&#39;s recap what we&#39;ve learned!</p>
<ul>
<li>The <code translate="no" dir="ltr">PagingSource</code> asynchronously loads the data from a source you define.</li>
<li>The <code translate="no" dir="ltr">Pager.flow</code> creates a <code translate="no" dir="ltr">Flow&lt;PagingData&gt;</code> based on a configuration and a function that defines how to instantiate the <code translate="no" dir="ltr">PagingSource</code>.</li>
<li>The <code translate="no" dir="ltr">Flow</code> emits a new <code translate="no" dir="ltr">PagingData</code> whenever new data is loaded by the <code translate="no" dir="ltr">PagingSource</code>.</li>
<li>The UI observes the changed <code translate="no" dir="ltr">PagingData</code> and uses a <code translate="no" dir="ltr">PagingDataAdapter</code> to update the <code translate="no" dir="ltr">RecyclerView</code> that presents the data.</li>
<li>To retry a failed load from the UI, use the <code translate="no" dir="ltr">PagingDataAdapter.retry</code> method. Under the hood, the Paging library will trigger the <code translate="no" dir="ltr">PagingSource.load()</code> method.</li>
<li>To add separators to your list, create a high-level type with separators as one of  the supported types. Then use the <code translate="no" dir="ltr">PagingData.insertSeparators()</code> method to implement your separator generation logic.</li>
<li>To display the load state as header or footer, use <code translate="no" dir="ltr">PagingDataAdapter.withLoadStateHeaderAndFooter()</code> method and implement a <code translate="no" dir="ltr">LoadStateAdapter</code>. If you want to execute other actions based on the load state, use the <code translate="no" dir="ltr">PagingDataAdapter.addLoadStateListener()</code> callback.</li>
<li>To work with the network and database, implement a <code translate="no" dir="ltr">RemoteMediator</code>.</li>
<li>Adding a <code translate="no" dir="ltr">RemoteMediator</code> causes updates to the <code translate="no" dir="ltr">mediator</code> field in the <code translate="no" dir="ltr">LoadStatesFlow</code>.</li>
</ul>


        </google-codelab-step>
      
    </google-codelab>
  
  

  
</div>

  
    
    
    
  

  <div class="devsite-floating-action-buttons"></div></article>


<devsite-content-footer class="nocontent">
  <p>Except as otherwise noted, the content of this page is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 License</a>, and code samples are licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>. For details, see the <a href="https://developers.google.com/site-policies">Google Developers Site Policies</a>. Java is a registered trademark of Oracle and/or its affiliates.</p>
  
</devsite-content-footer>


<devsite-notification
>
</devsite-notification>


  
<div class="devsite-content-data">
  
  
    <template class="devsite-content-data-template">
      [[["Easy to understand","easyToUnderstand","thumb-up"],["Solved my problem","solvedMyProblem","thumb-up"],["Other","otherUp","thumb-up"]],[["Missing the information I need","missingTheInformationINeed","thumb-down"],["Too complicated / too many steps","tooComplicatedTooManySteps","thumb-down"],["Out of date","outOfDate","thumb-down"],["Samples / code issue","samplesCodeIssue","thumb-down"],["Other","otherDown","thumb-down"]],[],[],[],null,[]]
    </template>
  
</div>
            
          </devsite-content>
        </main>
        <devsite-footer-promos class="devsite-footer">
          
            

<nav class="devsite-footer-promos nocontent" aria-label="Promotions">
  <ul class="devsite-footer-promos-list">
    
    <li class="devsite-footer-promo">
      <a href="//x.com/AndroidDev"
         class="devsite-footer-promo-title gc-analytics-event"
         data-category="Site-Wide Custom Events"
       
       
         data-label="Footer X Promo"
       >
        
        
        <picture>
          
          <source class="devsite-dark-theme"
                  srcset="https://developer.android.com/_static/android/images/logo-x_dt.svg"
                  media="(prefers-color-scheme: dark)">
          
          <img class="devsite-footer-promo-icon"
                src="/_static/android/images/logo-x.svg"
                loading="lazy"
                alt="X">
        </picture>
        
        <span class="devsite-footer-promo-label">
          X
        </span>
      </a>
      <div class="devsite-footer-promo-description">Follow @AndroidDev on X</div>
    </li>
    
    <li class="devsite-footer-promo">
      <a href="//www.youtube.com/user/androiddevelopers"
         class="devsite-footer-promo-title gc-analytics-event"
         data-category="Site-Wide Custom Events"
       
       
         data-label="Footer YouTube Promo"
       >
        
        
        <picture>
          
          <source class="devsite-dark-theme"
                  srcset="https://developer.android.com/_static/android/images/logo-youtube_dt.svg"
                  media="(prefers-color-scheme: dark)">
          
          <img class="devsite-footer-promo-icon"
                src="//www.gstatic.com/images/icons/material/product/2x/youtube_48dp.png"
                loading="lazy"
                alt="YouTube">
        </picture>
        
        <span class="devsite-footer-promo-label">
          YouTube
        </span>
      </a>
      <div class="devsite-footer-promo-description">Check out Android Developers on YouTube</div>
    </li>
    
    <li class="devsite-footer-promo">
      <a href="//www.linkedin.com/showcase/androiddev"
         class="devsite-footer-promo-title gc-analytics-event"
         data-category="Site-Wide Custom Events"
       
       
         data-label="Footer LinkedIn Promo"
       >
        
        
        <picture>
          
          <source class="devsite-dark-theme"
                  srcset="https://developer.android.com/_static/android/images/logo-linkedin_dt.svg"
                  media="(prefers-color-scheme: dark)">
          
          <img class="devsite-footer-promo-icon"
                src="/_static/android/images/logo-linkedin.svg"
                loading="lazy"
                alt="LinkedIn">
        </picture>
        
        <span class="devsite-footer-promo-label">
          LinkedIn
        </span>
      </a>
      <div class="devsite-footer-promo-description">Connect with the Android Developers community on LinkedIn</div>
    </li>
    
  </ul>
</nav>

          
        </devsite-footer-promos>
        <devsite-footer-linkboxes class="devsite-footer">
          
            
<nav class="devsite-footer-linkboxes nocontent" aria-label="Footer links">
  
  <ul class="devsite-footer-linkboxes-list">
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">More Android</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//www.android.com"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 1)"
            >
            
          
            Android
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//www.android.com/enterprise/"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 2)"
            >
            
          
            Android for Enterprise
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//www.android.com/security-center/"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 3)"
            >
            
          
            Security
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//source.android.com"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 4)"
            >
            
          
            Source
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/news"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 5)"
            >
            
          
            News
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//android-developers.googleblog.com/"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 6)"
            >
            
          
            Blog
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/podcasts"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 7)"
            >
            
              
              
            
          
            Podcasts
          
          </a>
          
          
        </li>
        
      </ul>
    </li>
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">Discover</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/games"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 1)"
            >
            
          
            Gaming
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/ml"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 2)"
            >
            
          
            Machine Learning
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/health-and-fitness"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 3)"
            >
            
          
            Health & Fitness
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/media"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 4)"
            >
            
          
            Camera & Media
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/privacy"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 5)"
            >
            
          
            Privacy
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/training/connectivity/5g"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 6)"
            >
            
              
              
            
          
            5G
          
          </a>
          
          
        </li>
        
      </ul>
    </li>
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">Android Devices</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/large-screens"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 1)"
            >
            
          
            Large screens
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/wear"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 2)"
            >
            
          
            Wear OS
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/chrome-os"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 3)"
            >
            
          
            ChromeOS devices
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/cars"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 4)"
            >
            
          
            Android for cars
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/tv"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 5)"
            >
            
              
              
            
          
            Android TV
          
          </a>
          
          
        </li>
        
      </ul>
    </li>
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">Releases</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/about/versions/15"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 1)"
            >
            
          
            Android 15
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/about/versions/14"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 2)"
            >
            
          
            Android 14
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/about/versions/13"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 3)"
            >
            
          
            Android 13
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/about/versions/12"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 4)"
            >
            
          
            Android 12
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/about/versions/11"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 5)"
            >
            
          
            Android 11
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/about/versions/10"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 6)"
            >
            
          
            Android 10
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/about/versions/pie"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 7)"
            >
            
              
              
            
          
            Pie
          
          </a>
          
          
        </li>
        
      </ul>
    </li>
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">Documentation and Downloads</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/studio/intro"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 1)"
            >
            
          
            Android Studio guide
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/guide"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 2)"
            >
            
          
            Developers guides
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/reference"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 3)"
            >
            
          
            API reference
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/studio"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 4)"
            >
            
          
            Download Studio
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/ndk"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 5)"
            >
            
              
              
            
          
            Android NDK
          
          </a>
          
          
        </li>
        
      </ul>
    </li>
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">Support</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//issuetracker.google.com/issues/new?component=190923&amp;template=841312"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 1)"
            >
            
          
            Report platform bug
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//issuetracker.google.com/issues/new?component=192697"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 2)"
            >
            
          
            Report documentation bug
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//support.google.com/googleplay/android-developer"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 3)"
            >
            
          
            Google Play support
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="https://g.co/userresearch/androiddeveloperfooter"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 4)"
            >
            
              
              
            
          
            Join research studies
          
          </a>
          
          
        </li>
        
      </ul>
    </li>
    
  </ul>
  
</nav>
          
        </devsite-footer-linkboxes>
        <devsite-footer-utility class="devsite-footer">
          
            

<div class="devsite-footer-utility nocontent">
  
  
  <nav class="devsite-footer-sites" aria-label="Other Google Developers websites">
    <a href="https://developers.google.com/"
       class="devsite-footer-sites-logo-link gc-analytics-event"
       data-category="Site-Wide Custom Events"
       data-label="Footer Google Developers Link">
      <picture>
        
        <source srcset="https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/images/lockup-google-for-developers-dark-theme.svg"
                media="(prefers-color-scheme: none)"
                class="devsite-dark-theme">
        
        <img class="devsite-footer-sites-logo"
             src="https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/images/lockup-google-for-developers.svg"
             loading="lazy"
             alt="Google Developers">
      </picture>
    </a>
    <ul class="devsite-footer-sites-list">
      
      <li class="devsite-footer-sites-item">
        <a href="//developer.android.com"
           class="devsite-footer-sites-link
                  gc-analytics-event"
           data-category="Site-Wide Custom Events"
         
           data-label="Footer Android Link"
         
         >
          Android
        </a>
      </li>
      
      <li class="devsite-footer-sites-item">
        <a href="//developer.chrome.com/home"
           class="devsite-footer-sites-link
                  gc-analytics-event"
           data-category="Site-Wide Custom Events"
         
           data-label="Footer Chrome Link"
         
         >
          Chrome
        </a>
      </li>
      
      <li class="devsite-footer-sites-item">
        <a href="//firebase.google.com"
           class="devsite-footer-sites-link
                  gc-analytics-event"
           data-category="Site-Wide Custom Events"
         
           data-label="Footer Firebase Link"
         
         >
          Firebase
        </a>
      </li>
      
      <li class="devsite-footer-sites-item">
        <a href="//cloud.google.com"
           class="devsite-footer-sites-link
                  gc-analytics-event"
           data-category="Site-Wide Custom Events"
         
           data-label="Footer Google Cloud Platform Link"
         
         >
          Google Cloud Platform
        </a>
      </li>
      
      <li class="devsite-footer-sites-item">
        <a href="//developers.google.com/products/"
           class="devsite-footer-sites-link
                  gc-analytics-event"
           data-category="Site-Wide Custom Events"
         
           data-label="Footer All products Link"
         
         >
          All products
        </a>
      </li>
      
    </ul>
  </nav>
  

  
  <nav class="devsite-footer-utility-links" aria-label="Utility links">
    
    <ul class="devsite-footer-utility-list">
      
      <li class="devsite-footer-utility-item
                 ">
        
        
        <a class="devsite-footer-utility-link gc-analytics-event"
           href="//policies.google.com/privacy"
           data-category="Site-Wide Custom Events"
           data-label="Footer Privacy link"
         >
          Privacy
        </a>
        
      </li>
      
      <li class="devsite-footer-utility-item
                 ">
        
        
        <a class="devsite-footer-utility-link gc-analytics-event"
           href="/license"
           data-category="Site-Wide Custom Events"
           data-label="Footer License link"
         >
          License
        </a>
        
      </li>
      
      <li class="devsite-footer-utility-item
                 ">
        
        
        <a class="devsite-footer-utility-link gc-analytics-event"
           href="/distribute/marketing-tools/brand-guidelines"
           data-category="Site-Wide Custom Events"
           data-label="Footer Brand guidelines link"
         >
          Brand guidelines
        </a>
        
      </li>
      
      <li class="devsite-footer-utility-item
                 glue-cookie-notification-bar-control">
        
        
        <a class="devsite-footer-utility-link gc-analytics-event"
           href="#"
           data-category="Site-Wide Custom Events"
           data-label="Footer Manage cookies link"
         
           aria-hidden="true"
         >
          Manage cookies
        </a>
        
      </li>
      
      <li class="devsite-footer-utility-item
                 devsite-footer-utility-button">
        
        <span class="devsite-footer-utility-description">Get news and tips by email</span>
        
        
        <a class="devsite-footer-utility-link gc-analytics-event"
           href="/updates"
           data-category="Site-Wide Custom Events"
           data-label="Footer Subscribe link"
         >
          Subscribe
        </a>
        
      </li>
      
    </ul>
    
    
<devsite-language-selector>
  <ul role="presentation">
    
    
    <li role="presentation">
      <a role="menuitem" lang="en"
        >English</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="de"
        >Deutsch</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="es_419"
        >Español – América Latina</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="fr"
        >Français</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="id"
        >Indonesia</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="pl"
        >Polski</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="pt_br"
        >Português – Brasil</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="vi"
        >Tiếng Việt</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="zh_cn"
        >中文 – 简体</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="ja"
        >日本語</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="ko"
        >한국어</a>
    </li>
    
  </ul>
</devsite-language-selector>

  </nav>
</div>
          
        </devsite-footer-utility>
        <devsite-panel>
          
        </devsite-panel>
        
      </section></section>
    <devsite-sitemask></devsite-sitemask>
    <devsite-snackbar></devsite-snackbar>
    <devsite-tooltip ></devsite-tooltip>
    <devsite-heading-link></devsite-heading-link>
    <devsite-analytics>
      
        <script type="application/json" analytics>[]</script>
<script type="application/json" tag-management>{&#34;at&#34;: &#34;True&#34;, &#34;ga4&#34;: [{&#34;id&#34;: &#34;G-QFRN08RN6E&#34;, &#34;purpose&#34;: 0}], &#34;ga4p&#34;: [{&#34;id&#34;: &#34;G-QFRN08RN6E&#34;, &#34;purpose&#34;: 0}], &#34;gtm&#34;: [], &#34;parameters&#34;: {&#34;internalUser&#34;: &#34;False&#34;, &#34;language&#34;: {&#34;machineTranslated&#34;: &#34;False&#34;, &#34;requested&#34;: &#34;en&#34;, &#34;served&#34;: &#34;en&#34;}, &#34;pageType&#34;: &#34;codelab&#34;, &#34;projectName&#34;: null, &#34;signedIn&#34;: &#34;False&#34;, &#34;tenant&#34;: &#34;android&#34;, &#34;recommendations&#34;: {&#34;sourcePage&#34;: &#34;&#34;, &#34;sourceType&#34;: 0, &#34;sourceRank&#34;: 0, &#34;sourceIdenticalDescriptions&#34;: 0, &#34;sourceTitleWords&#34;: 0, &#34;sourceDescriptionWords&#34;: 0, &#34;experiment&#34;: &#34;&#34;}, &#34;experiment&#34;: {&#34;ids&#34;: &#34;&#34;}}}</script>
      
    </devsite-analytics>
    
      <devsite-badger></devsite-badger>
    
    
    
<android-fully-clickable
    target="
        .android-case-study .devsite-landing-row-item,
        .android-editorial-and-updates-cards .devsite-card-content-wrapper,
        .android-editorial-and-updates-cards .devsite-landing-row-item,
        .android-grouped-resources .devsite-landing-row-item,
        .android-grouped-resources-contained--primary .devsite-landing-row-item,
        .android-grouped-resources-contained--secondary .devsite-landing-row-item,
        .android-grouped-resources-contained--tertiary .devsite-landing-row-item,
        .android-grouped-resources-uncontained--primary .devsite-landing-row-item,
        .android-grouped-resources-uncontained--secondary .devsite-landing-row-item,
        .android-grouped-resources-uncontained--tertiary .devsite-landing-row-item,
        .android-guide-cards .devsite-landing-row-item,
        .android-illustrated-resources-index .devsite-landing-row-item,
        .android-illustrated-resources-primary .devsite-landing-row-item,
        .android-illustrated-resources-secondary .devsite-landing-row-item,
        .android-illustrated-resources-secondary-small .devsite-landing-row-item,
        .android-illustrated-resources-tertiary .devsite-landing-row-item,
        .android-illustrated-resources-tertiary-small .devsite-landing-row-item,
        .android-promo .devsite-landing-row-item,
        .android-quick-link,
        .android-samples .devsite-card-wrapper,
        .fully-clickable"
    watch=".android-editorial-and-updates-cards, .android-samples, devsite-content"></android-fully-clickable>
    
<script nonce="4CwIlmbOcpcQJLK8LgIwHn8aIDb0t0">
  
  (function(d,e,v,s,i,t,E){d['GoogleDevelopersObject']=i;
    t=e.createElement(v);t.async=1;t.src=s;E=e.getElementsByTagName(v)[0];
    E.parentNode.insertBefore(t,E);})(window, document, 'script',
    'https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/js/app_loader.js', '[3,"en",null,"/js/devsite_app_module.js","https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9","https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android","https://android-dot-devsite-v2-prod.appspot.com",1,null,["/_pwa/android/manifest.json","https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/images/video-placeholder.svg","https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/images/favicon.svg","https://www.gstatic.com/devrel-devsite/prod/vc12d84b6edb3e25e1619b575cf813e1849a1c95098b711a6c56ab3968c9a4fa9/android/images/lockup.png","https://fonts.googleapis.com/css?family=Google+Sans:400,500,600,700|Google+Sans+Text:400,400italic,500,500italic,600,600italic,700,700italic|Roboto+Mono:400,500,700&display=swap"],1,null,[1,6,8,12,14,17,21,25,50,52,63,70,75,76,80,87,91,92,93,97,98,100,101,102,103,104,105,107,108,109,110,112,113,117,118,120,122,124,125,126,127,129,130,131,132,133,134,135,136,138,140,141,147,148,149,151,152,156,157,158,159,161,163,164,168,169,170,179,180,182,183,186,191,193,196],"AIzaSyAP-jjEJBzmIyKR4F-3XITp8yM9T1gEEI8","AIzaSyB6xiKGDR5O3Ak2okS4rLkauxGUG7XP0hg","developer.android.com","AIzaSyAQk0fBONSGUqCNznf6Krs82Ap1-NV6J4o","AIzaSyCCxcqdrZ_7QMeLCRY20bh_SXdAYqy70KY",null,null,null,["DevPro__remove_eu_tax_intake_form","MiscFeatureFlags__enable_firebase_utm","EngEduTelemetry__enable_engedu_telemetry","TpcFeatures__enable_unmirrored_page_left_nav","Profiles__enable_page_saving","BookNav__enable_tenant_cache_key","MiscFeatureFlags__developers_footer_dark_image","Profiles__enable_callout_notifications","DevPro__enable_devpro_offers","MiscFeatureFlags__enable_view_transitions","Profiles__enable_release_notes_notifications","Cloud__enable_free_trial_server_call","Analytics__enable_clearcut_logging","Profiles__require_profile_eligibility_for_signin","MiscFeatureFlags__enable_appearance_cookies","Experiments__reqs_query_experiments","Profiles__enable_dashboard_curated_recommendations","MiscFeatureFlags__enable_variable_operator","Search__enable_ai_search_summaries_for_all","MiscFeatureFlags__enable_variable_operator_index_yaml","DevPro__enable_developer_subscriptions","CloudShell__cloud_code_overflow_menu","Profiles__enable_complete_playlist_endpoint","Profiles__enable_stripe_subscription_management","Cloud__cache_serialized_dynamic_content","Cloud__fast_free_trial","Profiles__enable_profile_collections","MiscFeatureFlags__gdp_dashboard_reskin_enabled","Profiles__enable_developer_profiles_callout","Cloud__enable_legacy_calculator_redirect","Search__enable_dynamic_content_confidential_banner","Profiles__enable_completequiz_endpoint","MiscFeatureFlags__enable_framebox_badge_methods","Profiles__enable_purchase_prompts","Concierge__enable_actions_menu","Cloud__enable_cloudx_experiment_ids","Profiles__enable_recognition_badges","Cloud__enable_llm_concierge_chat","MiscFeatureFlags__emergency_css","DevPro__enable_firebase_workspaces_card","Profiles__enable_join_program_group_endpoint","DevPro__enable_google_payments_buyflow","Search__enable_suggestions_from_borg","MiscFeatureFlags__developers_footer_image","Profiles__enable_public_developer_profiles","CloudShell__cloud_shell_button","Profiles__enable_awarding_url","Cloud__enable_cloud_dlp_service","Significatio__enable_by_tenant","Cloud__enable_cloud_shell","MiscFeatureFlags__enable_project_variables","MiscFeatureFlags__enable_dark_theme","Concierge__enable_remove_info_panel_tags","Profiles__enable_playlist_community_acl","DevPro__enable_enterprise","DevPro__enable_google_one_card","Profiles__enable_user_type","MiscFeatureFlags__enable_explicit_template_dependencies","Profiles__enable_completecodelab_endpoint","DevPro__enable_cloud_innovators_plus","DevPro__enable_free_benefits","Search__enable_page_map","DevPro__enable_nvidia_credits_card","Cloud__enable_cloud_shell_fte_user_flow","TpcFeatures__proxy_prod_host","Search__enable_ai_eligibility_checks","DevPro__enable_code_assist","DevPro__enable_vertex_credit_card","DevPro__enable_embed_profile_creation","MiscFeatureFlags__enable_project_body_class","Concierge__enable_pushui","Profiles__enable_developer_profile_benefits_ui_redesign"],null,null,"AIzaSyBLEMok-5suZ67qRPzx0qUtbnLmyT_kCVE","https://developerscontentserving-pa.googleapis.com","AIzaSyCM4QpTRSqP5qI4Dvjt4OAScIN8sOUlO-k","https://developerscontentsearch-pa.googleapis.com",2,4,null,"https://developerprofiles-pa.googleapis.com",[3,"android","Android Developers","developer.android.com",null,"android-dot-devsite-v2-prod.appspot.com",null,null,[null,1,null,null,null,null,null,null,null,null,null,[1],null,null,null,null,null,null,[1],[1,null,null,[1,20],"/recommendations"],null,null,null,[1,null,1],[1,1,null,1,1]],null,[18,null,null,null,null,null,"/images/lockup.png","/images/touchicon-180.png",null,null,null,null,null,null,null,null,null,null,null,null,null,2,null,null,null,"/images/lockup-dark-theme.png",[]],[],null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,[6,1,14,15,20,22,23,28,29,37,43],null,[[null,null,1],[1,1]],[[null,null,null,null,null,null,null,[["G-QFRN08RN6E"],null,null,[["G-QFRN08RN6E",1]]],null,null,null,null,1],null,[[1,1],[2,2]]],null,4,null,null,null,null,null,null,null,null,null,null,null,null,null,"android.devsite.google"],null,"pk_live_5170syrHvgGVmSx9sBrnWtA5luvk9BwnVcvIi7HizpwauFG96WedXsuXh790rtij9AmGllqPtMLfhe2RSwD6Pn38V00uBCydV4m",1,null,"https://developerscontentinsights-pa.googleapis.com","AIzaSyCg-ZUslalsEbXMfIo9ZP8qufZgo3LSBDU","AIzaSyDxT0vkxnY_KeINtA4LSePJO-4MAZPMRsE","https://developers.googleapis.com",null,null,"AIzaSyBQom12tzI-rybN7Sf-KfeL4nwm-Rf7PmI\n",null,"https://developerslogging.googleapis.com"]')
  
</script>

    <devsite-a11y-announce></devsite-a11y-announce>
  </body>
</html>